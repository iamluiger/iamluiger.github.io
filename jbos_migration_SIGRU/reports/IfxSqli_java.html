<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <title>Source Report for IfxSqli.java</title>
    <link href="resources/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="resources/css/font-awesome.min.css" rel="stylesheet" />
    <link href="resources/css/windup.css" rel="stylesheet" media="screen"/>
    <link rel="stylesheet" type="text/css" href="resources/libraries/snippet/jquery.snippet.min.css" />
    <link rel="stylesheet" type="text/css" href="resources/css/windup-source.css" />
    <link rel="stylesheet" type="text/css" href="resources/libraries/sausage/sausage.css" />
    <link rel="shortcut icon" href="resources/img/rhamt-icon-128.png" type="image/x-icon"/>
</head>
<body role="document" class="source-report">

    <div class="navbar navbar-default navbar-fixed-top" id="main-navbar" style="display: none">
        <div class="wu-navbar-header navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <span class="wu-navbar-header">
              <strong class="wu-navbar-header">Red Hat Application Migration Toolkit</strong>
            </span>        </div>


                <div class="navbar-collapse collapse navbar-responsive-collapse project-specific" data-project-id="21667888">
    <ul class="nav navbar-nav">
            <li class="">
                <a href="../index.html"><i class="glyphicon glyphicon-home"></i> All Applications</a>
            </li>



                <li class="">
                    <a href="report_index_SIGRU_ear.html">
                        <i class="glyphicon glyphicon-dashboard"></i>
                      Dashboard
                    </a>
                </li>


                <li class="">
                    <a href="migration_issues.html">
                        <i class="glyphicon glyphicon-warning-sign"></i>
                      Issues
                    </a>
                </li>


                <li class="">
                    <a href="ApplicationDetails_SIGRU_ear.html">
                        <i class="glyphicon glyphicon-th-list"></i>
                      Application Details
                    </a>
                </li>


                <li class="">
                    <a href="techReport_SIGRU_ear.html">
                        <i class="fa fa-rocket"></i>
                      Technologies
                    </a>
                </li>


                <li class="">
                    <a href="dependency_graph_report.html">
                        <i class="glyphicon glyphicon-tree-deciduous"></i>
                      Dependencies Graph
                    </a>
                </li>


                <li class="">
                    <a href="Unparsable_SIGRU_ear.html">
                        <i class="glyphicon glyphicon-warning-sign"></i>
                      Unparsable
                    </a>
                </li>


                <li class="">
                    <a href="dependency_report_SIGRU_ear.html">
                        <i class="glyphicon glyphicon-retweet"></i>
                      Dependencies
                    </a>
                </li>


                <li class="">
                    <a href="remotereport_SIGRU_ear.html">
                        <i class="glyphicon service-nav-logo"></i>
                      Remote Services
                    </a>
                </li>


                <li class="">
                    <a href="tattletale_SIGRU_ear.html">
                        <i class="glyphicon tattletale-nav-logo"></i>
                      Tattletale
                    </a>
                </li>


                <li class="">
                    <a href="hardcoded_ipsSIGRU_ear.html">
                        <i class="glyphicon glyphicon-map-marker"></i>
                      Hard-coded IP Addresses
                    </a>
                </li>


                <li class="">
                    <a href="ignoredfiles_SIGRU_ear.html">
                        <i class="glyphicon glyphicon-eye-close"></i>
                      Ignored Files
                    </a>
                </li>


                <li class="">
                    <a href="about_SIGRU_ear.html">
                        <i class="fa fa-question-circle"></i>
                      About
                    </a>
                </li>
    </ul>
    <ul class="nav navbar-nav navbar-right">
<li>
    <a href="#" class="feedback-nav-btn jiraFeedbackTrigger"><i class="glyphicon glyphicon-comment"></i> Send Feedback </a>
</li>


    <script type="text/javascript" src="https://issues.jboss.org/s/f215932e68571747ac58d0f5d554396f-T/en_US-r7luaf/6346/82/1.4.16/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-US&amp;collectorId=8b9e338b"></script>

    <script type="text/javascript">

    var FEEDBACK_JS_ADDED = false;
    var FEEDBACK_FORM_TRIGGER = null;

    function displayFeedbackForm() {
        FEEDBACK_FORM_TRIGGER();
    }

    window.ATL_JQ_PAGE_PROPS = {
        "triggerFunction": function(showCollectorDialog) {
            FEEDBACK_FORM_TRIGGER = showCollectorDialog;
        }
    };

    document.addEventListener("DOMContentLoaded", function(event) {
            jQuery(".jiraFeedbackTrigger").click(function(e) {
                e.preventDefault();
                displayFeedbackForm();
            });
    });
    </script>
    </ul>
                </div><!-- /.nav-collapse -->
    </div>


    <div class="container-fluid" role="main">
        <div class="row">
            <div class="page-header page-header-no-border">
                <h1>
                    <div class="main">Source Report
                    <i class="glyphicon glyphicon-info-sign" data-toggle="tooltip" data-placement=right title="This report displays what Red Hat Application Migration Toolkit found in individual files. Each item is shown below the line it was found on, and next to it, you may find a link to the rule which it was found by."></i></div>

                        <div class="path project-specific" data-project-id="21667888">
                            SIGRU.ear/AdminCU.war/WEB-INF/lib/jdbc-4.50.1.jar/com/informix/jdbc/IfxSqli.java
                        </div>
                </h1>
            </div>
        </div>

        <div class="row">
            <div class="container-fluid theme-showcase" role="main">

                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <h3 class="panel-title">Information</h3>
                    </div>
                    <div class="panel-body" style="overflow: auto;">

                        <!--<div style="height: 120pt; float:left;"></div> Keeps the minimal height. -->
                        <div class="points" style="text-align: center; color: #00254b; padding-bottom: 1ex;">
                            <div class="number">0</div>
                            <div>Story Points</div>
                        </div>

                        <div class="info" style="margin-left: 95pt;">


                                <h4>Technologies</h4>
                                <div class="technologies" style="overflow: auto"><!-- "auto" to contain all the tags. -->
                                        <span class="label label-info" title="INFORMATIONAL">Decompiled Java File</span>
                                        <span class="label label-info" title="classloader">classloader</span>
                                </div>



                            <div style="clear: both;"/><!-- Snaps under the height keeper. Yes, the same effect could be achieved by a table. -->
                        </div><!-- .info -->
                    </div>
                </div>



                <pre id="source">
package com.informix.jdbc;

import com.informix.asf.IfxDataInputStream;
import com.informix.asf.IfxDataOutputStream;
import com.informix.asf.SqliDbg;
import com.informix.jdbc.IfxFParam.FPTypeInfo;
import com.informix.lang.IfxTypes;
import com.informix.lang.Interval;
import com.informix.lang.IntervalDF;
import com.informix.lang.IntervalYM;
import com.informix.lang.JavaToIfxType;
import com.informix.util.IfxErrMsg;
import com.informix.util.IfxWarnMsg;
import com.informix.util.Trace;
import com.informix.util.TraceFlag;
import com.informix.util.stringUtil;
import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.DataInputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.OutputStream;
import java.io.OutputStreamWriter;
import java.io.RandomAccessFile;
import java.io.Reader;
import java.io.Writer;
import java.sql.ResultSetMetaData;
import java.sql.SQLException;
import java.sql.SQLIntegrityConstraintViolationException;
import java.sql.SQLWarning;
import java.sql.Statement;
import java.sql.Time;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Enumeration;
import java.util.List;
import java.util.Properties;
import java.util.StringTokenizer;
import java.util.Vector;

public class IfxSqli implements IfxProtocol {
   private static final Object logger = Trace.getLoggerForClass(IfxSqli.class);
   private String routineDbName = null;
   private boolean descTrue = false;
   IfxResultSetMetaData desc;
   IfxResultSetMetaData idesc;
   private OutputStream BlobFd;
   private byte[] BlobBuffer;
   private short BufferOrStream;
   private int BlobWriteFailure;
   private int BlobWriteOffset;
   private int BlobRequestSize;
   private int amountRW;
   private String copyToFileName;
   private int copyToFileFlags;
   private int copyToFileMode;
   private int copyToFileOffset;
   private File copyToFileFd;
   private RandomAccessFile loFile;
   private short statementID = -1;
   private short statementType;
   protected final IfxSqliConnect conn;
   protected final Trace trace;
   protected final Trace protoTrace;
   protected final SqliDbg sqliTrace;
   private String dbEncoding;
   private boolean isText;
   private boolean convText;
   private long serial8Inserted;
   private long bigSerialInserted;
   private short xcEvent = -1;
   private short xcNewLevel = -1;
   private short xcOldLevel = -1;
   private boolean isReleased = true;
   private int tupleBufferSize = -1;
   private boolean typeSent = false;
   private int sqlcode;
   private int isamcode;
   private String SQLState;
   private String message;
   private SQLWarning warn;
   private SQLException exception;
   private String sqlerrm;
   private int[] sqlerrd = new int[10];
   private StringBuffer serverWarningsString = new StringBuffer(&quot;        &quot;);
   private short serverWarningsShort;
   private boolean OpenDBStmt;
   private String serverVersion;
   private byte[] serverProtocol = null;
   private final Vector&lt;Integer&gt; offsetVector = new Vector(500);
   private int totalTupleSize;
   private int curOffset;
   private int totalTuples;
   private int firstTuple;
   private int lastTuple;
   private int curRow = -1;
   private boolean doneCommit;
   private int Tupid;
   private int numberOfFetches = 0;
   private int numberOfTuplesReceived = 0;
   private int tupleSizeReceived = 0;
   private int fpHandle;
   private Vector&lt;IfxObject&gt; fpRet;
   private Vector&lt;IfxObject&gt; fpInput;
   private IfxFParam fparam;
   private boolean partialFParam;
   private int totalOutValues = 0;
   private int totalOutParams = 0;
   static final int IN = 0;
   static final int OUT = 1;
   static final int INOUT = 2;
   private short TxStmt;
   private static final short NON_TX_STMT = 0;
   private static final short BEG_TX_STMT = 1;
   private static final short END_TX_STMT = 2;
   protected static final int INFX_BUFSIZE = 4096;
   protected static final int INFX_MAXBUFSIZE = 32767;
   protected static final int INFX_MAX_BIGBUFSIZE = Integer.MAX_VALUE;
   private static final int INFX_MAXQUOTEDSTRINGSIZE = 65535;
   private IfxRowColumn rowColumn;
   private short SGK_statementType;
   private short SGK_statementID = -1;
   private short SGK_TxStmt;
   private IfxResultSetMetaData SGK_desc = null;
   protected IfxRowColumn SGK_rowColumn;
   private final Vector&lt;Integer&gt; SGK_offsetVector = new Vector();
   private int SGK_totalTupleSize;
   private int SGK_curOffset;
   private int SGK_totalTuples;
   private int SGK_curRow = -1;
   protected final IfxDataOutputStream os;
   protected final IfxDataInputStream is;
   protected boolean SQ_CLOSERecvd;
   private boolean SQ_CLOSESent;
   private boolean first = true;
   private Vector&lt;String&gt; DBList;
   boolean executeBatchInProgress;
   public ArrayList&lt;Integer&gt; batchRowStatus;
   private int batchCount;
   private boolean userPAMAuthorized = false;
   private int putErrRowCount = 0;

   public IfxSqli(IfxSqliConnect connection) {
      this.conn = connection;
      this.sqliTrace = this.conn.asfconn.sqliTrace;
      this.trace = this.conn.getTrace();
      this.protoTrace = this.conn.getProtoTrace();
      this.os = this.conn.Ifxproto_send();
      this.is = this.conn.Ifxproto_receive();
      this.dbEncoding = this.conn.getdbEncoding();
      this.convText = this.conn.isConvText();
   }

   public ResultSetMetaData getMetaData() {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: getMetaData() called&quot;);
         this.trace.writeTrace(logger, 2, &quot;   return desc&quot;);
      }

      return this.desc;
   }

   ResultSetMetaData getSGK_metaData() {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: getSGK_metaData() called&quot;);
         this.trace.writeTrace(logger, 2, &quot;   return SGK_desc&quot;);
      }

      return this.SGK_desc;
   }

   public int getStatementType() {
      return this.statementType;
   }

   public void clearBatch() {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: clearBatch() called&quot;);
      }

      this.batchCount = 0;
      this.batchRowStatus = null;
      this.executeBatchInProgress = false;
   }

   public void clear() {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: clear() called&quot;);
      }

      this.serial8Inserted = 0L;
      this.bigSerialInserted = 0L;
      this.xcEvent = -1;
      this.xcNewLevel = -1;
      this.xcOldLevel = -1;
      this.sqlcode = 0;
      this.isamcode = 0;
      this.SQLState = null;
      this.message = null;
      this.OpenDBStmt = false;
      this.sqlerrm = null;

      for(short i = 0; i &lt; 10; ++i) {
         this.sqlerrd[i] = 0;
         if (i &lt; 8) {
            this.serverWarningsString.setCharAt(i, &#39; &#39;);
         }
      }

      this.serverWarningsShort = 0;
      this.tupleBufferSize = -1;
      this.resetTuples();
      this.doneCommit = false;
      this.warn = null;
      if (this.rowColumn != null) {
         this.rowColumn.clear();
         this.rowColumn = null;
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: clear() exited&quot;);
      }

   }

   private void resetTuples() {
      this.offsetVector.removeAllElements();
      this.offsetVector.setSize(500);
      this.offsetVector.setElementAt(Integer.valueOf(0), 0);
      this.totalTupleSize = 0;
      this.curOffset = 0;
      this.curRow = -1;
      this.totalTuples = 0;
      this.Tupid = 0;
      if (this.rowColumn != null) {
         this.rowColumn.reset();
      }

   }

   private void resetSGKTuples() {
      this.SGK_offsetVector.removeAllElements();
      this.SGK_offsetVector.setSize(10);
      this.SGK_offsetVector.setElementAt(Integer.valueOf(0), 0);
      this.SGK_totalTupleSize = 0;
      this.SGK_curOffset = 0;
      this.SGK_curRow = -1;
      this.SGK_totalTuples = 0;
      if (this.SGK_rowColumn != null) {
         this.SGK_rowColumn.reset();
      }

   }

   private void clearAll() {
      this.clear();
      this.isReleased = true;
      this.desc = null;
      this.idesc = null;
   }

   public void executeBegin() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeBegin() called&quot;);
      }

      this.conn.lockSession();

      try {
         this.sendBegin();
         this.receiveMessage();
      } catch (SQLException var6) {
         throw var6;
      } catch (Exception var7) {
         throw this.handleSocketException(var7, this.conn);
      } finally {
         this.conn.unlockSession();
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeBegin() exited&quot;);
      }

   }

   private void sendBegin() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendBegin() called&quot;);
      }

      try {
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_BEGIN&quot;);
         }

         this.os.writeSmallInt((short)35);
      } catch (Exception var2) {
         throw this.handleSocketException(var2, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeBegin() exited&quot;);
      }

   }

   public void executeCommit() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeCommit() called&quot;);
      }

      this.conn.lockSession();

      try {
         this.sendCommit();
         this.receiveMessage();
      } catch (SQLException var6) {
         throw var6;
      } catch (Exception var7) {
         throw this.handleSocketException(var7, this.conn);
      } finally {
         this.conn.unlockSession();
      }

      this.conn.markCursorsToClosed(true);
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeCommit() exited&quot;);
      }

   }

   private void sendCommit() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendCommit() called&quot;);
      }

      try {
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_CMMTWORK&quot;);
         }

         this.os.writeSmallInt((short)19);
      } catch (Exception var2) {
         throw this.handleSocketException(var2, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendCommit() exited&quot;);
      }

   }

   public void executeSavepoint(String savepointname, boolean uniqflag) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeSavepoint() called&quot;);
      }

      this.conn.lockSession();

      try {
         if (!this.conn.autoCommit) {
            this.initiateTransaction();
         }

         this.sendSavepoint(savepointname, uniqflag);
         this.receiveMessage();
      } catch (SQLException var8) {
         throw var8;
      } catch (Exception var9) {
         throw this.handleSocketException(var9, this.conn);
      } finally {
         this.conn.unlockSession();
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeSavepoint() exited&quot;);
      }

   }

   private void sendSavepoint(String savepointname, boolean uniqflag) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendSavepoint() called&quot;);
      }

      try {
         byte[] savePointNameBytes = this.os.getJavaToIfxChar(savepointname, this.dbEncoding);
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_SQLISETSVPT&quot;);
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tSavepoint Name: &quot; + savepointname);
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tUnique Flag : &quot; + uniqflag);
         }

         this.os.writeSmallInt((short)137);
         this.os.writeChar(savePointNameBytes);
         if (uniqflag) {
            this.os.writeSmallInt((short)1);
         } else {
            this.os.writeSmallInt((short)0);
         }
      } catch (Exception var4) {
         if (var4 instanceof SQLException) {
            throw (SQLException)var4;
         }

         throw this.handleSocketException(var4, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendSavepoint() exited&quot;);
      }

   }

   public void executeReleaseSavepoint(String savepointname) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeSavepoint() called&quot;);
      }

      if (!this.conn.lockSession()) {
         throw IfxErrMsg.getSQLMinorException(-79748, -80033, this.conn);
      } else {
         if (!this.conn.autoCommit) {
            this.initiateTransaction();
         }

         try {
            this.sendReleaseSavepoint(savepointname);
            this.receiveMessage();
         } catch (SQLException var3) {
            this.conn.unlockSession();
            throw var3;
         } catch (Exception var4) {
            this.conn.unlockSession();
            throw this.handleSocketException(var4, this.conn);
         }

         this.conn.unlockSession();
         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeReleaseSavepoint() exited&quot;);
         }

      }
   }

   private void sendReleaseSavepoint(String savepointname) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendReleaseSavepoint() called&quot;);
      }

      try {
         byte[] savePointNameBytes = this.os.getJavaToIfxChar(savepointname, this.dbEncoding);
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;\n\tSQ_SQLIRELSVPT&quot;);
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tSavepoint Name: &quot; + savepointname);
         }

         this.os.writeSmallInt((short)138);
         this.os.writeChar(savePointNameBytes);
      } catch (Exception var3) {
         if (var3 instanceof SQLException) {
            throw (SQLException)var3;
         }

         throw this.handleSocketException(var3, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendReleaseSavepoint() exited&quot;);
      }

   }

   public void executeRollbackSavepoint(String savepointname) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeRollbackSavepoint() called&quot;);
      }

      if (!this.conn.lockSession()) {
         throw IfxErrMsg.getSQLMinorException(-79748, -80033, this.conn);
      } else {
         if (!this.conn.autoCommit) {
            this.initiateTransaction();
         }

         try {
            this.sendRollbackSavepoint(savepointname);
            this.receiveMessage();
         } catch (SQLException var3) {
            this.conn.unlockSession();
            throw var3;
         } catch (Exception var4) {
            this.conn.unlockSession();
            throw this.handleSocketException(var4, this.conn);
         }

         this.conn.unlockSession();
         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeRollbackSavepoint() exited&quot;);
         }

      }
   }

   private void sendRollbackSavepoint(String savepointname) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendRollbackSavepoint() called&quot;);
      }

      try {
         byte[] savePointNameBytes = this.os.getJavaToIfxChar(savepointname, this.dbEncoding);
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_SQLIRBACKSVPT&quot;);
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tSavepoint Name: &quot; + savepointname);
         }

         this.os.writeSmallInt((short)139);
         this.os.writeChar(savePointNameBytes);
      } catch (SQLException var3) {
         throw var3;
      } catch (Exception var4) {
         throw this.handleSocketException(var4, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendRollbackSavepoint() exited&quot;);
      }

   }

   public void executeRollback() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeRollback() called&quot;);
      }

      if (!this.conn.lockSession()) {
         throw IfxErrMsg.getSQLMinorException(-79748, -80033, this.conn);
      } else {
         try {
            this.sendRollback();
            this.receiveMessage();
         } catch (SQLException var2) {
            this.conn.unlockSession();
            throw var2;
         } catch (Exception var3) {
            this.conn.unlockSession();
            throw this.handleSocketException(var3, this.conn);
         }

         this.conn.unlockSession();
         this.conn.markCursorsToClosed(false);
         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeRollback() exited&quot;);
         }

      }
   }

   public void executeGetDBList() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeDBList() called&quot;);
      }

      if (!this.conn.lockSession()) {
         throw IfxErrMsg.getSQLMinorException(-79748, -80033, this.conn);
      } else {
         try {
            this.sendGetDBList();
            this.receiveMessage();
         } catch (SQLException var2) {
            this.conn.unlockSession();
            throw var2;
         } catch (Exception var3) {
            this.conn.unlockSession();
            throw this.handleSocketException(var3, this.conn);
         }

         this.conn.unlockSession();
         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeDBList() exited&quot;);
         }

      }
   }

   public Vector&lt;String&gt; getDBList() {
      return this.DBList;
   }

   private void sendGetDBList() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendGetDbList() called&quot;);
      }

      try {
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_DBLIST&quot;);
         }

         this.os.writeSmallInt((short)26);
      } catch (Exception var2) {
         throw this.handleSocketException(var2, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendGetDbList() exited&quot;);
      }

   }

   private void receiveDBList() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveDBList() called&quot;);
      }

      try {
         this.DBList = new Vector();

         while(true) {
            String dbName = this.is.readChar(this.dbEncoding);
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\tName: &quot;, &quot;&#39;&quot; + dbName + &quot;&#39;&quot;);
            }

            if (dbName.length() == 0) {
               break;
            }

            boolean inserted = false;

            for(int i = 0; i &lt; this.DBList.size(); ++i) {
               String lastDBname = (String)this.DBList.get(i);
               if (dbName.compareToIgnoreCase(lastDBname) &lt; 0) {
                  this.DBList.insertElementAt(dbName, i);
                  inserted = true;
                  break;
               }
            }

            if (!inserted) {
               this.DBList.insertElementAt(dbName, this.DBList.size());
            }
         }
      } catch (Exception var5) {
         throw this.handleSocketException(var5, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveDBList() exited&quot;);
      }

   }

   private void sendRollback() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendRollback() called&quot;);
      }

      try {
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_RBWORK&quot;);
         }

         this.os.writeSmallInt((short)20);
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\tSavepoint: &quot;, (short)0);
         }

         this.os.writeSmallInt((short)0);
      } catch (Exception var2) {
         throw this.handleSocketException(var2, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendRollback() exited&quot;);
      }

   }

   public void executeCommand(Statement stmt) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeCommand() called&quot;);
      }

      this.conn.lockSession();

      try {
         if (stmt instanceof IfxPreparedStatement &amp;&amp; ((IfxPreparedStatement)stmt).usePut()) {
            this.initiateTransaction();
            this.sendPut((IfxPreparedStatement)stmt);
         } else {
            this.sendCommand((IfxStatement)stmt);
         }
      } catch (SQLException var6) {
         this.conn.unlockSession();
         if (this.TxStmt == 2) {
            if (TraceFlag.isTraceEnabled()) {
               this.trace.writeTrace(logger, 2, &quot;IfxSqli: END_TX_STMT, return error&quot;);
               this.trace.writeTrace(logger, 3, &quot;IfxSqli.executeCommand.sqlcode&quot;, this.sqlcode);
            }

            if (this.sqlcode != -255) {
               this.conn.setTxEndState();
            }
         } else if (stmt instanceof IfxPreparedStatement &amp;&amp; ((IfxPreparedStatement)stmt).usePut() &amp;&amp; this.conn.TxState == 2 &amp;&amp; this.conn.autoCommit) {
            if (TraceFlag.isTraceEnabled()) {
               this.trace.writeTrace(logger, 2, &quot;IfxSqli: END_TX_STMT with IFX_USEPUT, return error&quot;);
               this.trace.writeTrace(logger, 3, &quot;IfxSqli.executeCommand.sqlcode&quot;, this.sqlcode);
            }

            if (this.sqlcode != -255) {
               this.sendCommit();
               this.conn.setTxEndState();
            }
         }

         throw var6;
      }

      try {
         this.receiveMessage();
         if (this.SGK_desc != null) {
            String SGK_tabnm = IfxResultSetMetaData.parseTableName(((IfxStatement)stmt).commandString);

            for(int i = 1; i &lt;= this.SGK_desc.getColumnCount(); ++i) {
               this.SGK_desc.setTableName(i, SGK_tabnm);
            }
         }
      } catch (SQLException var5) {
         this.conn.unlockSession();
         if (this.TxStmt == 2) {
            if (TraceFlag.isTraceEnabled()) {
               this.trace.writeTrace(logger, 2, &quot;IfxSqli: END_TX_STMT, return error&quot;);
               this.trace.writeTrace(logger, 3, &quot;IfxSqli.executeCommand.sqlcode&quot;, this.sqlcode);
            }

            if (this.sqlcode != -255) {
               this.conn.setTxEndState();
            }
         } else if (!this.conn.inXATransaction() &amp;&amp; this.conn.db_use_log &amp;&amp; this.conn.autoCommit) {
            try {
               this.executeCommit();
               this.conn.setTxEndState();
            } catch (Exception var4) {
               throw var5;
            }
         }

         throw var5;
      }

      this.conn.unlockSession();
      this.callsetDatabaseOpen(this.parseDbName(stmt));
      if (this.TxStmt == 1) {
         this.conn.setTxBeginState();
      } else if (this.TxStmt == 2) {
         this.conn.setTxEndState();
      } else if (!this.conn.inXATransaction() &amp;&amp; (this.conn.isCommitNeeded() || this.conn.db_use_log &amp;&amp; this.conn.autoCommit &amp;&amp; stmt instanceof IfxPreparedStatement &amp;&amp; ((IfxPreparedStatement)stmt).usePut())) {
         this.executeCommit();
         this.conn.setTxEndState();
         this.doneCommit = true;
      }

      if (this.desc != null) {
         this.desc.parseSetTableName(((IfxStatement)stmt).commandString);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeCommand() exited&quot;);
      }

   }

   private void sendCommand(IfxStatement stmt) throws SQLException {
      boolean tmpFlag = true;
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendCommand() called&quot;);
      }

      if (!this.conn.autoCommit &amp;&amp; !stmt.commandString.trim().toLowerCase().startsWith(&quot;begin&quot;)) {
         this.initiateTransaction();
      }

      int batchRowSize = stmt.BatchVector.size();
      if (stmt.executeBatchInProgress) {
         this.executeBatchInProgress = true;
      }

      if (stmt instanceof IfxPreparedStatement) {
         this.sendExecute(stmt);
      } else {
         String[] str = null;
         int j;
         if (this.conn.isBatchUpdatePerSpec() &amp;&amp; batchRowSize &gt; 0 &amp;&amp; this.executeBatchInProgress) {
            str = new String[batchRowSize];

            for(j = 0; j &lt; batchRowSize; ++j) {
               str[j] = (String)stmt.BatchVector.get(j);
            }
         } else {
            str = new String[]{stmt.commandString};
            tmpFlag = false;
         }

         try {
            if (!this.conn.isRemove64KLimitSupported() &amp;&amp; stmt.commandString.length() &gt; 65535) {
               throw IfxErrMsg.getSQLException(-79864, this.conn);
            }

            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
               this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
            }

            j = 0;

            do {
               String cmdString = str[j];
               byte[] b = this.getJavaToIfxCharBytes(str[j++]);
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_COMMAND&quot;);
               }

               this.os.writeSmallInt((short)1);
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t# of values: &quot;, 0);
               }

               this.os.writeSmallInt((short)0);
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\tCommand: &quot; + cmdString);
               }

               this.os.writeChar(b);
               this.SGK_desc = null;
               this.SGK_rowColumn = null;
               if (stmt.SGK_returnGeneratedKeys != 0) {
                  this.sendSGKPrepare(stmt);
               }

               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_NDESCRIBE&quot;);
               }

               this.os.writeSmallInt((short)22);
               this.resetSGKTuples();
               if (j == 1 &amp;&amp; this.conn.isSQBatchSupported() &amp;&amp; this.conn.isANSI() &amp;&amp; tmpFlag) {
                  this.sendSQBatchStart();
               }

               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_EXECUTE&quot;);
               }

               this.os.writeSmallInt((short)7);
               if (j == batchRowSize &amp;&amp; this.conn.isSQBatchSupported() &amp;&amp; this.conn.isANSI() &amp;&amp; tmpFlag) {
                  this.sendSQBatchEnd();
               }

               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_RELEASE&quot;);
               }

               this.os.writeSmallInt((short)11);
               this.isReleased = true;
            } while(this.conn.isBatchUpdatePerSpec() &amp;&amp; j &lt; batchRowSize &amp;&amp; this.executeBatchInProgress);
         } catch (SQLException var8) {
            throw var8;
         } catch (Exception var9) {
            throw this.handleSocketException(var9, this.conn);
         }
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendCommand() exited&quot;);
      }

   }

   private boolean sendBind(List&lt;IfxObject&gt; vector, ResultSetMetaData pmd, int inputvals, int si, int ei) throws SQLException {
      int blobCount = 0;
      int ord = false;
      boolean sentIMPEXP = false;
      boolean checkIfxValException = false;
      Exception IfxValException = null;
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendBind(Vector) called&quot;);
      }

      try {
         if (TraceFlag.isTraceEnabled()) {
            if (si == 0) {
               this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
               this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
            }

            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_BIND&quot;);
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tCount: &quot;, inputvals);
         }

         this.os.writeSmallInt((short)5);
         this.os.writeSmallInt((short)inputvals);
         int i = si;

         while(true) {
            if (i &gt;= ei) {
               if (!checkIfxValException) {
                  break;
               }

               throw IfxValException;
            }

            IfxObject ival = null;
            if (i &lt; vector.size()) {
               ival = (IfxObject)vector.get(i);
            }

            short type;
            if (ival == null) {
               int ord = i % inputvals + 1;
               short type = false;
               if (pmd == null || !((IfxResultSetMetaData)pmd).hasDefaultValue(ord)) {
                  if (pmd != null) {
                     throw IfxErrMsg.getSQLException(-79823, ((IfxResultSetMetaData)pmd).getArgumentName(ord), this.conn);
                  }

                  throw IfxErrMsg.getSQLException(-79823, this.conn);
               }

               type = (short)((IfxResultSetMetaData)pmd).getIfxColumnType(ord);
               this.os.writeSmallInt(type);
               if (TraceFlag.isTraceEnabled()) {
                  this.trace.writeTrace(logger, 2, &quot; sendBind(): SQL type: &quot; + type);
                  if (i &gt; 0) {
                     this.protoTrace.writeTrace(logger, 2, &quot;&quot;);
                  }

                  this.protoTrace.writeTrace(logger, 2, &quot;\t\tColumn #: &quot;, i + 1);
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\tType: &quot;, type);
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\tIndicator: &quot;, -2);
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\tPrecision: &quot;, (short)0);
               }

               this.os.writeSmallInt((short)-2);
               this.os.writeSmallInt((short)0);
            } else {
               type = (short)ival.getIfxType();
               if (type == 11 || type == 12) {
                  if (((IfxBlob)ival).isIfxTextType()) {
                     type = 12;
                  }

                  if (!ival.isNull()) {
                     ++blobCount;
                  }
               }

               if (type == 46) {
                  sentIMPEXP = true;
               }

               this.os.writeSmallInt(type);
               if (TraceFlag.isTraceEnabled()) {
                  this.trace.writeTrace(logger, 2, &quot; sendBind(): SQL type: &quot; + type);
                  if (i &gt; 0) {
                     this.protoTrace.writeTrace(logger, 2, &quot;&quot;);
                  }

                  this.protoTrace.writeTrace(logger, 2, &quot;\t\tColumn #: &quot;, i + 1);
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\tType: &quot;, type);
               }

               String s;
               if (this.conn.isUSVER() &amp;&amp; type &gt; 18 &amp;&amp; type != 52 &amp;&amp; type != 53) {
                  String owner = null;
                  s = null;
                  owner = ival.getExtendedOwner();
                  s = ival.getExtendedTypeName();
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\tExtendedOwner: &quot;, owner);
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\tExtendedTypeName: &quot;, s);
                  }

                  if (owner == null) {
                     this.os.writeSmallInt((short)0);
                  } else {
                     this.os.writeChar(this.os.getJavaToIfxChar(owner));
                  }

                  this.os.writeChar(this.os.getJavaToIfxChar(s));
               }

               if (ival.isNull()) {
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\tIndicator: &quot;, -1);
                  }

                  this.os.writeSmallInt((short)-1);
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\tPrecision: &quot;, (short)0);
                  }

                  this.os.writeSmallInt((short)0);
               } else {
                  label242: {
                     byte[] bData = null;

                     try {
                        bData = ival.toIfx();
                     } catch (Exception var18) {
                        if (var18 instanceof SQLException) {
                           SQLException e1 = (SQLException)var18;
                           if (e1.getErrorCode() != -79783 &amp;&amp; e1.getErrorCode() != -23103) {
                              throw var18;
                           }

                           this.os.writeSmallInt((short)-1);
                           this.os.writeSmallInt((short)0);
                           checkIfxValException = true;
                           IfxValException = var18;
                           break label242;
                        }
                     }

                     if (TraceFlag.isTraceEnabled()) {
                        this.protoTrace.writeTrace(logger, 2, &quot;\t\tIndicator: &quot;, (short)0);
                     }

                     this.os.writeSmallInt((short)0);
                     short shortVal;
                     if (ival.getIfxType() == 5 &amp;&amp; (ival.getIfxType() != 5 || !(ival instanceof IfxDistinct))) {
                        shortVal = (short)((IfxDecimal)ival).getScale();
                     } else {
                        shortVal = ival.getEncodedLength();
                     }

                     if (TraceFlag.isTraceEnabled()) {
                        this.protoTrace.writeTrace(logger, 2, &quot;\t\tPrecision: &quot;, shortVal);
                     }

                     this.os.writeSmallInt(shortVal);
                     if (TraceFlag.isTraceEnabled()) {
                        s = ival.getClass().getName();
                        this.trace.writeTrace(logger, 2, &quot;Classname: &quot;, s);
                     }

                     if (TraceFlag.isTraceEnabled()) {
                        if (type != 11 &amp;&amp; type != 12 &amp;&amp; type != 40 &amp;&amp; type != 41) {
                           if (type == 44) {
                              this.protoTrace.writeTrace(logger, 2, &quot;\t\tData (&quot; + bData.length + &quot; bytes): &quot;);
                              this.protoTrace.writeTrace(logger, 2, bData, &#39;B&#39;);
                           } else {
                              s = ival.toString();
                              this.protoTrace.writeTrace(logger, 2, &quot;\t\tData: &quot;, s);
                           }
                        } else {
                           this.protoTrace.writeTrace(logger, 2, &quot;\t\tData (&quot; + bData.length + &quot; bytes): &quot;);
                           this.protoTrace.writeTrace(logger, 2, bData, &#39;H&#39;);
                        }
                     }

                     this.os.writePadded(bData);
                     if (this.statementType == 1 || this.statementType == 12 || this.statementType == 38) {
                        this.conn.setDbName(ival.toString());
                     }

                     if (this.statementType == 31) {
                        this.conn.setDbName((String)null);
                     }
                  }
               }
            }

            ++i;
         }
      } catch (SQLException var19) {
         throw var19;
      } catch (Exception var20) {
         throw this.handleSocketException(var20, this.conn);
      }

      if (blobCount &gt; 0 &amp;&amp; sentIMPEXP) {
         this.receiveMessage();
      }

      if (blobCount &gt; 0) {
         this.sendBlob(vector, blobCount, si, inputvals);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendBind() exited&quot;);
      }

      return sentIMPEXP;
   }

   public void executePrepare(Statement stmt) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executePrepare() called&quot;);
      }

      if (!this.conn.lockSession()) {
         throw IfxErrMsg.getSQLMinorException(-79748, -80033, this.conn);
      } else {
         try {
            this.sendPrepare((IfxStatement)stmt);
            this.receiveMessage();
            ((IfxStatement)stmt).setStatementType(this.statementType);
            if (this.SGK_desc != null) {
               this.SGK_desc.parseSetTableName(((IfxStatement)stmt).commandString);
            }
         } catch (SQLException var3) {
            this.conn.unlockSession();
            throw var3;
         } catch (Exception var4) {
            this.conn.unlockSession();
            throw this.handleSocketException(var4, this.conn);
         }

         this.conn.unlockSession();
         if (this.desc != null) {
            this.desc.parseSetTableName(((IfxStatement)stmt).commandString);
         }

         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 1, &quot;IfxSqli: executePrepare() exited&quot;);
         }

      }
   }

   private void sendPrepare(IfxStatement stmt) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendPrepare() called&quot;);
      }

      String s = stmt.commandString;

      try {
         byte[] b = this.conn.isOnLine5SER() ? this.os.getJavaToIfxChar(s, &quot;NOENCODING&quot;) : this.getJavaToIfxCharBytes(s);
         if (!this.conn.isRemove64KLimitSupported() &amp;&amp; s.length() &gt; 65535) {
            throw IfxErrMsg.getSQLException(-79864, this.conn);
         }

         if (this.conn.db_use_log &amp;&amp; !this.conn.autoCommit &amp;&amp; this.conn.isBatchUpdatePerSpec() &amp;&amp; stmt instanceof IfxPreparedStatement) {
            IfxPreparedStatement pstmt = (IfxPreparedStatement)stmt;
            if (pstmt.BatchVector.size() &gt; 0 &amp;&amp; !pstmt.usePut()) {
               this.initiateTransaction();
            }
         }

         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_PREPARE&quot;);
         }

         this.os.writeSmallInt((short)2);
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\t# qmarks: &quot;, stmt.numqmarks);
         }

         this.os.writeSmallInt((short)stmt.numqmarks);
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tCommand: &quot; + s);
         }

         this.os.writeChar(b);
         this.SGK_desc = null;
         this.SGK_rowColumn = null;
         if (stmt.SGK_returnGeneratedKeys != 0) {
            this.sendSGKPrepare(stmt);
         }

         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_NDESCRIBE&quot;);
         }

         this.os.writeSmallInt((short)22);
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_WANTDONE&quot;);
         }

         this.os.writeSmallInt((short)49);
         this.isReleased = false;
      } catch (Exception var5) {
         if (var5 instanceof SQLException) {
            throw (SQLException)var5;
         }

         throw this.handleSocketException(var5, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendPrepare() exited&quot;);
      }

   }

   private void sendStatementExecute(IfxStatement stmt) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendStatementExecute() called&quot;);
      }

      this.sendExecute(stmt);
      this.receiveMessage();
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendStatementExecute() exited&quot;);
      }

   }

   private void sendExecute(IfxStatement stmt) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendExecute() called&quot;);
      }

      try {
         this.sendStatementID();
         if (!(stmt instanceof IfxPreparedStatement)) {
            this.resetSGKTuples();
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_EXECUTE&quot;);
            }

            this.os.writeSmallInt((short)7);
            return;
         }

         IfxPreparedStatement pstmt = (IfxPreparedStatement)stmt;
         IfxResultSetMetaData pmd = pstmt.inputParamMeta;
         int qmarks = pstmt.getqmarks();
         boolean tmpFlag = true;
         if (this.conn.isBatchUpdatePerSpec() &amp;&amp; stmt.executeBatchInProgress || pstmt.BatchVector.size() &gt; 0 &amp;&amp; !pstmt.executeBatchInProgress) {
            if (this.conn.isBatchUpdatePerSpec() &amp;&amp; stmt.executeBatchInProgress) {
               int batchCnt = pstmt.BatchVector.size();

               for(int j = 0; j &lt; batchCnt; ++j) {
                  int startIdx = j * qmarks;
                  int endIdx = startIdx + qmarks;
                  boolean sentIMPEXP = false;
                  if (qmarks &gt; 0) {
                     sentIMPEXP = this.sendBind(pstmt.BatchParamVector, pmd, qmarks, startIdx, endIdx);
                  }

                  if (j == 0 &amp;&amp; this.conn.isSQBatchSupported() &amp;&amp; this.conn.isANSI() &amp;&amp; tmpFlag) {
                     this.sendSQBatchStart();
                  }

                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_EXECUTE&quot;);
                  }

                  this.os.writeSmallInt((short)7);
                  if (j == batchCnt - 1 &amp;&amp; this.conn.isSQBatchSupported() &amp;&amp; this.conn.isANSI() &amp;&amp; tmpFlag) {
                     this.sendSQBatchEnd();
                  }

                  if (sentIMPEXP) {
                     this.receiveMessage();
                  }

                  if (this.executeBatchInProgress &amp;&amp; this.os.getBytesSentSinceLastEOT() &gt;= 32767) {
                     this.receiveMessage();
                     this.sendStatementID();
                  }
               }

               return;
            }

            int numVals = pstmt.BatchParamVector.size();
            this.sendBind(pstmt.BatchParamVector, pmd, 0, numVals, numVals);
         } else {
            List&lt;IfxObject&gt; setValues = null;
            if (pstmt.BatchVector.isEmpty()) {
               setValues = pstmt.getVector();
               tmpFlag = false;
            } else {
               setValues = pstmt.BatchParamVector;
            }

            int i = 0;

            while(true) {
               if (i &gt;= qmarks || !pstmt.BatchVector.isEmpty()) {
                  if (qmarks &gt; 0) {
                     this.sendBind(setValues, pmd, qmarks, 0, qmarks);
                  }
                  break;
               }

               IfxObject ival = null;
               if (i &lt; setValues.size()) {
                  ival = (IfxObject)setValues.get(i);
               }

               if (ival == null) {
                  int ord = i % qmarks + 1;
                  if (pmd == null || !pmd.hasDefaultValue(ord)) {
                     throw IfxErrMsg.getSQLException(-79823, pstmt.namedCalls == 0L ? &quot; index = &quot; + ord : pmd.getArgumentName(ord), this.conn);
                  }
               }

               ++i;
            }
         }

         this.resetSGKTuples();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_EXECUTE&quot;);
         }

         this.os.writeSmallInt((short)7);
      } catch (SQLException var13) {
         throw var13;
      } catch (Exception var14) {
         throw this.handleSocketException(var14, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendExecute() exited&quot;);
      }

   }

   public void executeStatementQuery(Statement stmt) throws SQLException {
      this.executeStatementQuery(stmt, false, false, (ResultSetMetaData)null);
   }

   public void executeStatementQuery(Statement stmt, boolean withHold, boolean withReOptimization) throws SQLException {
      this.executeStatementQuery(stmt, withHold, withReOptimization, (ResultSetMetaData)null);
   }

   public void executeStatementQuery(Statement stmt, boolean withHold, boolean withReOptimization, ResultSetMetaData outputDesc) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeStatementQuery() called&quot;);
      }

      this.resetTuples();
      this.doneCommit = false;
      if (!this.conn.lockSession()) {
         throw IfxErrMsg.getSQLMinorException(-79748, -80033, this.conn);
      } else {
         if (!(stmt instanceof IfxPreparedStatement)) {
            try {
               this.sendPrepare((IfxStatement)stmt);
               this.receiveMessage();
               if (this.desc != null) {
                  this.desc.parseSetTableName(((IfxStatement)stmt).commandString);
               }
            } catch (SQLException var7) {
               this.conn.unlockSession();
               throw var7;
            } catch (Exception var8) {
               this.conn.unlockSession();
               throw this.handleSocketException(var8, this.conn);
            }
         }

         int outputNumber = 0;
         if (this.desc != null) {
            outputNumber = this.desc.getColumnCount();
         }

         if (this.statementType == 2 || this.statementType == 56 &amp;&amp; outputNumber &gt; 0) {
            try {
               if (!this.conn.autoCommit) {
                  this.initiateTransaction();
               }

               this.sendStatementQuery((IfxStatement)stmt, withHold, withReOptimization, (IfxResultSetMetaData)outputDesc);
            } catch (SQLException var9) {
               this.conn.unlockSession();
               throw var9;
            } catch (Exception var10) {
               this.conn.unlockSession();
               throw this.handleSocketException(var10, this.conn);
            }

            this.conn.unlockSession();
            if (TraceFlag.isTraceEnabled()) {
               this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeStatementQuery() exited&quot;);
            }

         } else {
            this.conn.unlockSession();
            throw IfxErrMsg.getSQLException(-79750, this.conn);
         }
      }
   }

   private void sendStatementQuery(IfxStatement stmt, boolean withHold, boolean withReOptimization, IfxResultSetMetaData outputDesc) throws SQLException {
      if (stmt.currentResult != null) {
         stmt.currentResult.withHold = withHold;
      }

      this.sendQuery(stmt, withHold, withReOptimization, outputDesc);
      if (stmt.getResultSetType() == 1003) {
         boolean useOptofc = stmt instanceof IfxPreparedStatement &amp;&amp; this.conn.optofc &amp;&amp; stmt.getStatementType() == 2;
         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 2, &quot;IfxSqli: resultset type is forward_only&quot;);
         }

         IfxResultSetMetaData fetchRsmd = null;
         if (stmt instanceof IfxPreparedStatement) {
            IfxPreparedStatement pstmt = (IfxPreparedStatement)stmt;
            fetchRsmd = (IfxResultSetMetaData)((IfxResultSetMetaData)pstmt.getOutPutMetaData());
         }

         if (this.desc.hasVariableLengthColumns &amp;&amp; !useOptofc) {
            if (TraceFlag.isTraceEnabled()) {
               this.trace.writeTrace(logger, 2, &quot;IfxSqli: desc HAS variable length columns&quot;);
            }

            this.receiveMessage();
         }

         if (fetchRsmd != null) {
            if (TraceFlag.isTraceEnabled()) {
               this.trace.writeTrace(logger, 2, &quot;IfxSqli: fetchRsmd is not null&quot;);
            }

            this.sendFetch(this.desc.hasVariableLengthColumns, fetchRsmd, stmt);
         } else if (useOptofc) {
            if (TraceFlag.isTraceEnabled()) {
               this.trace.writeTrace(logger, 2, &quot;IfxSqli: sendStatementQuery() OPTOFC set for PreparedStatement, skipping fetch.&quot;);
            }
         } else {
            this.sendFetch(this.desc.hasVariableLengthColumns, this.desc, stmt);
         }

         stmt.cursorOpen = true;
      }

      this.receiveMessage();
   }

   private void sendType(IfxResultSetMetaData outputDesc, short direction, boolean typeSentCheck) throws SQLException {
      if (!typeSentCheck || !this.typeSent) {
         try {
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
               this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
               this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_RET_TYPE&quot;);
            }

            this.os.writeSmallInt((short)100);
            this.os.writeSmallInt(direction);
            this.os.writeSmallInt((short)this.desc.getColumnCount());
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;\tdirection: (1-FETCH, 0-PUT)&quot;, direction);
               this.protoTrace.writeTrace(logger, 2, &quot;\tCount: &quot;, this.desc.getColumnCount());
            }

            for(int i = 1; i &lt;= this.desc.getColumnCount(); ++i) {
               IfxResultSetMetaData md;
               if (outputDesc != null &amp;&amp; outputDesc != this.desc &amp;&amp; outputDesc.getColumnCount() &gt;= i &amp;&amp; outputDesc.getIfxColumnType(i) != 49) {
                  if (TraceFlag.isTraceEnabled()) {
                     this.trace.writeTrace(logger, 99, &quot;sendType(): from output parameter; i = &quot; + i);
                     this.trace.writeTrace(logger, 99, &quot;Type is &quot; + outputDesc.getIfxColumnType(i));
                     this.trace.writeTrace(logger, 99, &quot;Extended id is &quot; + outputDesc.getColumnExtendedId(i));
                  }

                  md = outputDesc;
                  this.desc.setIfxColumnType(i, outputDesc.getIfxColumnType(i));
                  this.desc.setExtendedName(i, outputDesc.getExtendedName(i));
                  this.desc.setColumnExtendedId(i, outputDesc.getColumnExtendedId(i));
                  this.desc.setEncodedLength(i, outputDesc.getEncodedLength(i));
               } else {
                  if (TraceFlag.isTraceEnabled()) {
                     this.trace.writeTrace(logger, 99, &quot;sendType(): from describe; i = &quot; + i);
                  }

                  md = this.desc;
               }

               short sqltype = (short)md.getIfxColumnType(i);
               boolean isVariableLength = md.isVariableLengthType(i);
               if (isVariableLength &amp;&amp; sqltype != 13 &amp;&amp; sqltype != 16) {
                  short xid;
                  if (md.isDistinct(i)) {
                     xid = (short)md.getSourceType(i);
                  } else {
                     xid = (short)md.getColumnExtendedId(i);
                  }

                  if (xid == 3) {
                     sqltype = 46;
                  } else if (xid == 4) {
                     sqltype = 47;
                  } else if (xid == 1) {
                     sqltype = 43;
                  } else if (xid == 5) {
                     sqltype = 45;
                  } else {
                     sqltype = 44;
                  }
               }

               if (TraceFlag.isTraceEnabled()) {
                  this.trace.writeTrace(logger, 99, &quot;sendType(): i = &quot; + i + &quot;; sqltype = &quot; + sqltype);
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tColumn #: &quot;, i);
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t\t\tType: &quot;, sqltype);
               }

               this.os.writeSmallInt(sqltype);
               if (isVariableLength &amp;&amp; sqltype != 13 &amp;&amp; sqltype != 16) {
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\t\tExtendedOwnerName: &quot;, md.getExtendedOwnerName(i));
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\t\tExtendedTypeName: &quot;, md.getExtendedName(i));
                  }

                  this.os.writeChar(this.os.getJavaToIfxChar(md.getExtendedOwnerName(i)));
                  this.os.writeChar(this.os.getJavaToIfxChar(md.getExtendedName(i)));
               } else if (isVariableLength &amp;&amp; sqltype == 43) {
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\t\tExtendedOwnerName: &quot;, md.getExtendedOwnerName(i));
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\t\tExtendedTypeName: &quot;, md.getExtendedName(i));
                  }

                  this.os.writeChar(this.os.getJavaToIfxChar(&quot;&quot;));
                  this.os.writeChar(this.os.getJavaToIfxChar(&quot;&quot;));
               }

               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t\t\tLength: &quot;, md.getEncodedLength(i));
               }

               this.os.writeInt(md.getEncodedLength(i));
            }

            this.typeSent = true;
         } catch (Exception var9) {
            throw this.handleSocketException(var9, this.conn);
         }
      }
   }

   private void sendQuery(IfxStatement stmt, boolean withHold, boolean withReOptimization, IfxResultSetMetaData outputDesc) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendQuery() called&quot;);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 3, &quot;tupleBufferSize: &quot; + this.tupleBufferSize);
      }

      try {
         String cursorname = stmt.getCursorName();
         byte[] cursorNameBytes = this.os.getJavaToIfxChar(cursorname, this.dbEncoding);
         this.sendStatementID();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_CURNAME&quot;);
         }

         this.os.writeSmallInt((short)3);
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tCursor name: &quot; + cursorname);
         }

         this.os.writeChar(cursorNameBytes);
         if (stmt instanceof IfxPreparedStatement) {
            IfxPreparedStatement pstmt = (IfxPreparedStatement)stmt;
            if (!pstmt.usePut() &amp;&amp; pstmt.inputvals &gt; 0) {
               if (pstmt.inputvals != pstmt.numqmarks) {
                  throw IfxErrMsg.getSQLException(-79823, this.conn);
               }

               this.sendBind(pstmt.getVector(), pstmt.inputParamMeta, pstmt.numqmarks, 0, pstmt.numqmarks);
            }
         }

         this.SQ_CLOSERecvd = false;
         this.SQ_CLOSESent = false;
         this.first = true;
         if (stmt.getAutoFree()) {
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_AUTOFREE&quot;);
            }

            this.os.writeSmallInt((short)108);
         }

         int curstype = stmt.getResultSetType();
         if (curstype == 1004) {
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_SCROLL&quot;);
            }

            this.os.writeSmallInt((short)24);
         }

         if (withHold &amp;&amp; this.statementType != 56) {
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_HOLD&quot;);
            }

            this.os.writeSmallInt((short)43);
         }

         if (withReOptimization) {
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(1, &quot;\tSQ_REOPTOPEN&quot;);
            }

            this.os.writeSmallInt((short)87);
         } else {
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_OPEN&quot;);
            }

            this.os.writeSmallInt((short)6);
         }

         if (this.conn.optofc &amp;&amp; stmt instanceof IfxPreparedStatement &amp;&amp; stmt.getStatementType() == 2 &amp;&amp; curstype == 1003 &amp;&amp; stmt.getResultSetConcurrency() == 1007) {
            if (this.statementType != 0 &amp;&amp; this.statementID != -1) {
               this.os.writeSmallInt((short)4);
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\tSQ_ID: &quot;, this.statementID);
               }

               this.os.writeSmallInt(this.statementID);
            }

            if (this.desc.hasVariableLengthColumns) {
               this.sendType(this.desc, (short)1, true);
            }

            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_NFETCH&quot;);
            }

            this.os.writeSmallInt((short)9);
            int tupleBufferSize = this.getTupleBufferSize(stmt.getFetchBufferSize());
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\tTuple Buffer Size: &quot;, tupleBufferSize);
            }

            if (!this.conn.isXPSVER8_40() &amp;&amp; !this.conn.is2GBFetchBufferSupported()) {
               this.os.writeSmallInt((short)tupleBufferSize);
            } else {
               this.os.writeInt(tupleBufferSize);
            }

            if (this.conn.isFetchArr()) {
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\tFetch Array Size: &quot;, (short)0);
               }

               this.os.writeSmallInt((short)0);
            }

            if (this.rowColumn == null &amp;&amp; this.desc != null) {
               this.rowColumn = new IfxRowColumn(this.conn, this.desc, tupleBufferSize);
               if (TraceFlag.isTraceEnabled()) {
                  this.rowColumn.setTrace(this.trace);
               }
            }
         }
      } catch (Exception var9) {
         if (var9 instanceof SQLException) {
            throw (SQLException)var9;
         }

         throw this.handleSocketException(var9, this.conn);
      }

      stmt.cursorOpen = true;
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendQuery() exited&quot;);
      }

   }

   public void executeOpenDatabase(String dbName, int flags) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeOpenDatabase() called&quot;);
      }

      if (dbName != null) {
         if (!this.conn.lockSession()) {
            throw IfxErrMsg.getSQLMinorException(-79748, -80033, this.conn);
         } else {
            try {
               byte[] dbNameBytes = this.os.getJavaToIfxChar(dbName, this.dbEncoding);
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
                  this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
                  this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_DBOPEN&quot;);
               }

               this.os.writeSmallInt((short)36);
               this.os.writeChar(dbNameBytes);
               this.os.writeSmallInt((short)flags);
               this.statementType = 1;
               this.receiveMessage();
            } catch (Exception var4) {
               this.conn.unlockSession();
               if (var4 instanceof SQLException) {
                  throw (SQLException)var4;
               }

               throw this.handleSocketException(var4, this.conn);
            }

            this.conn.unlockSession();
            this.callsetDatabaseOpen(dbName);
            if (TraceFlag.isTraceEnabled()) {
               this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeOpenDatabase() exitted&quot;);
            }

         }
      }
   }

   public void executeClose(Statement stmt) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeClose() called&quot;);
      }

      if (this.conn.isCommitNeeded() &amp;&amp; !this.doneCommit) {
         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 2, &quot;next call executeCommit()&quot;);
         }

         this.executeCommit();
         this.doneCommit = true;
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 3, &quot;stmt cursorOpen was &quot; + ((IfxStatement)stmt).cursorOpen);
      }

      if (((IfxStatement)stmt).cursorOpen) {
         this.conn.lockSession();

         try {
            ((IfxStatement)stmt).cursorOpen = false;
            if (!this.SQ_CLOSERecvd) {
               try {
                  this.sendClose((IfxStatement)stmt);
                  this.receiveMessage();
               } catch (SQLException var7) {
                  throw var7;
               } catch (Exception var8) {
                  throw this.handleSocketException(var8, this.conn);
               }
            }
         } finally {
            this.conn.unlockSession();
         }
      }

      if (((IfxStatement)stmt).getAutoFree()) {
         this.clearAll();
      } else {
         this.clear();
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeClose() exited&quot;);
      }

   }

   public void executeRelease(int id) throws SQLException {
      this.statementID = (short)id;
      this.conn.lockSession();

      try {
         if (this.statementID != -1) {
            this.sendRelease((IfxStatement)null);
            this.receiveMessage();
         }
      } catch (SQLException var7) {
         throw var7;
      } catch (Exception var8) {
         throw this.handleSocketException(var8, this.conn);
      } finally {
         this.conn.unlockSession();
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeRelease(int) exited&quot;);
      }

   }

   public void executeRelease(Statement stmt) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeRelease() called&quot;);
      }

      if (!this.conn.lockSession()) {
         throw IfxErrMsg.getSQLMinorException(-79748, -80033, this.conn);
      } else {
         if (!((IfxStatement)stmt).getAutoFree() || this.conn.getAutoFree() &amp;&amp; !this.SQ_CLOSERecvd &amp;&amp; !this.SQ_CLOSESent || ((IfxStatement)stmt).getAutoFree() &amp;&amp; !this.SQ_CLOSERecvd &amp;&amp; !this.SQ_CLOSESent) {
            try {
               if (!this.isReleased &amp;&amp; this.statementID != -1) {
                  this.sendRelease((IfxStatement)stmt);
                  this.statementID = -1;
                  this.receiveMessage();
               }
            } catch (SQLException var3) {
               this.conn.unlockSession();
               throw var3;
            } catch (Exception var4) {
               this.conn.unlockSession();
               throw this.handleSocketException(var4, this.conn);
            }
         }

         this.conn.unlockSession();
         ((IfxStatement)stmt).cursorOpen = false;
         this.clearAll();
         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeRelease() exited&quot;);
         }

      }
   }

   void executeFetch(Statement stmt) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeFetch() called&quot;);
      }

      this.resetTuples();
      this.conn.lockSession();

      try {
         this.sendFetch(false, this.desc, stmt);
         this.receiveMessage();
      } catch (SQLException var7) {
         throw var7;
      } catch (Exception var8) {
         throw this.handleSocketException(var8, this.conn);
      } finally {
         this.conn.unlockSession();
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeFetch() exited&quot;);
      }

   }

   private void sendFetch(boolean sendRetType, IfxResultSetMetaData desc, Statement stmt) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendFetch() called&quot;);
      }

      int tupleBufferSize = this.getTupleBufferSize(((IfmxStatement)stmt).getFetchBufferSize());
      ++this.numberOfFetches;

      try {
         this.sendStatementID();
         if (sendRetType) {
            this.sendType(desc, (short)1, stmt instanceof IfxPreparedStatement);
         }

         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_NFETCH&quot;);
         }

         this.os.writeSmallInt((short)9);
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tTuple Buffer Size: &quot;, tupleBufferSize);
         }

         if (!this.conn.isXPSVER8_40() &amp;&amp; !this.conn.is2GBFetchBufferSupported()) {
            this.os.writeSmallInt((short)tupleBufferSize);
         } else {
            this.os.writeInt(tupleBufferSize);
         }

         if (this.conn.isFetchArr()) {
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\tFetch Array Size: &quot;, (short)0);
            }

            this.os.writeSmallInt((short)0);
         }

         if (this.rowColumn == null) {
            this.rowColumn = new IfxRowColumn(this.conn, desc, tupleBufferSize);
            if (TraceFlag.isTraceEnabled()) {
               this.rowColumn.setTrace(this.trace);
            }
         }
      } catch (SQLException var6) {
         throw var6;
      } catch (Exception var7) {
         throw this.handleSocketException(var7, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendFetch() exited&quot;);
      }

   }

   private void sendClose(IfxStatement stmt) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendClose() called&quot;);
      }

      try {
         this.sendStatementID();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\tSQ_CLOSE&quot;);
         }

         this.os.writeSmallInt((short)10);
         this.SQ_CLOSESent = true;
      } catch (Exception var3) {
         throw this.handleSocketException(var3, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendClose() exited&quot;);
      }

   }

   private void sendRelease(IfxStatement stmt) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendRelease() called&quot;);
      }

      try {
         this.sendStatementID();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\tSQ_RELEASE&quot;);
         }

         this.os.writeSmallInt((short)11);
      } catch (Exception var3) {
         throw this.handleSocketException(var3, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendRelease() exited&quot;);
      }

   }

   public void executeCloseDatabase() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeCloseDatabase() called&quot;);
      }

      String dbName = this.conn.getConnectionDbName();
      if (dbName == null || dbName.length() == 0) {
         try {
            this.conn.lockSession();
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
               this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
               this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_DBCLOSE&quot;);
            }

            this.os.writeSmallInt((short)37);
            this.receiveMessage();
            this.conn.databaseClosed();
         } catch (SQLException var7) {
            throw var7;
         } catch (Exception var8) {
            throw this.handleSocketException(var8, this.conn);
         } finally {
            this.conn.unlockSession();
         }

         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeCloseDatabase() exited&quot;);
         }

      }
   }

   public void executeExecute(Statement stmt, boolean holdable, boolean withReOptimization) throws SQLException {
      this.executeExecute(stmt, holdable, withReOptimization, (ResultSetMetaData)null);
   }

   public void executeExecute(Statement stmt, boolean holdable, boolean withReOptimization, ResultSetMetaData outputDesc) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeExecute() called&quot;);
      }

      this.resetTuples();
      this.doneCommit = false;
      this.conn.lockSession();

      try {
         if (!(stmt instanceof IfxPreparedStatement)) {
            this.sendPrepare((IfxStatement)stmt);
            this.receiveMessage();
            if (this.desc != null) {
               this.desc.parseSetTableName(((IfxStatement)stmt).commandString);
            }
         }

         if (!this.conn.autoCommit) {
            this.initiateTransaction();
         }

         try {
            if (this.statementType != 2 &amp;&amp; (this.statementType != 56 || this.desc == null || this.desc.getColumnCount() &lt;= 0)) {
               this.sendStatementExecute((IfxStatement)stmt);
            } else {
               this.sendStatementQuery((IfxStatement)stmt, holdable, withReOptimization, (IfxResultSetMetaData)outputDesc);
            }
         } catch (SQLException var9) {
            if (this.TxStmt == 2) {
               if (TraceFlag.isTraceEnabled()) {
                  this.trace.writeTrace(logger, 2, &quot;IfxSqli: END_TX_STMT, return err&quot;);
                  this.trace.writeTrace(logger, 3, &quot;IfxSqli.executeExecute.sqlcode&quot;, this.sqlcode);
               }

               if (this.sqlcode != -255) {
                  this.conn.setTxEndState();
               }
            }

            throw var9;
         }
      } finally {
         this.conn.unlockSession();
      }

      this.callsetDatabaseOpen(this.parseDbName(stmt));
      if (this.TxStmt == 1) {
         this.conn.setTxBeginState();
      } else if (this.TxStmt == 2) {
         this.conn.setTxEndState();
      } else if (this.conn.isCommitNeeded() &amp;&amp; !this.isResultSet()) {
         this.executeCommit();
         this.doneCommit = true;
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeExecute() exited&quot;);
      }

   }

   public void receiveMessage() throws SQLException {
      int msg = false;
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveMessage() called&quot;);
      }

      this.clearExceptions();

      try {
         this.flip();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;S-&gt;C&quot;);
         }

         short msg;
         try {
            do {
               msg = this.is.readSmallInt();
               if (msg == 56 &amp;&amp; this.conn != null) {
                  this.conn.unlockSession();
               }
            } while(this.dispatchMsg(msg) &amp;&amp; msg != 12 &amp;&amp; msg != 56);
         } finally {
            if (this.sqliTrace != null) {
               this.sqliTrace.recordS2C();
            }

         }
      } catch (SQLException var7) {
         this.addException(var7);
      } catch (Exception var8) {
         this.addException(this.handleSocketException(var8, this.conn));
      }

      if (this.exception != null) {
         throw this.exception;
      } else {
         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveMessage() exited&quot;);
         }

      }
   }

   public boolean dispatchMsg(int msg) throws Exception {
      boolean retval = true;
      switch(msg) {
      case 8:
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_DESCRIBE&quot;);
         }

         this.descTrue = true;
         this.receiveDescribe();
         break;
      case 10:
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_CLOSE&quot;);
         }

         this.SQ_CLOSERecvd = true;
         break;
      case 12:
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_EOT&quot;);
         }
         break;
      case 13:
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_ERR&quot;);
         }

         this.receiveError();
         break;
      case 14:
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_TUPLE&quot;);
         }

         this.receiveTuple();
         break;
      case 15:
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_DONE&quot;);
         }

         this.receiveDone();
         break;
      case 18:
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_PUTERR&quot;);
         }

         this.receivePutErr();
         break;
      case 25:
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_TUPID&quot;);
         }

         this.receiveTupleId();
         break;
      case 26:
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_DBLIST&quot;);
         }

         this.receiveDBList();
         break;
      case 39:
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_BLOB&quot;);
         }

         if (this.isText &amp;&amp; this.convText) {
            this.receiveText();
         } else {
            this.receiveBlob();
         }
         break;
      case 53:
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_VERSION&quot;);
         }

         this.receiveVersion();
         break;
      case 55:
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_COST&quot;);
         }

         this.receiveCost();
         break;
      case 56:
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_EXIT&quot;);
         }

         this.sendExit();
         break;
      case 81:
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_INFO&quot;);
         }

         this.receiveInfo();
      case 86:
         break;
      case 94:
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_INSERTDONE&quot;);
         }

         this.receiveInsertDone();
         break;
      case 97:
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_LODATA&quot;);
         }

         this.receiveLODATA();
         break;
      case 98:
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_FILE&quot;);
         }

         this.receiveSQFILE();
         break;
      case 99:
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_XACTSTAT&quot;);
         }

         this.receiveXactstat();
         break;
      case 101:
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_GETROUTINE&quot;);
         }

         this.receiveHandle();
         break;
      case 103:
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_FPROUTINE&quot;);
         }

         this.receiveFastPath();
         break;
      case 104:
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_FPARAM&quot;);
         }

         this.receiveFParam();
         break;
      case 125:
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_IDESCRIBE&quot;);
         }

         this.receiveIDescribe();
         break;
      case 126:
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_PROTOCOLS&quot;);
         }

         this.receiveProtocols();
         break;
      case 132:
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_IFPDESCRIBE&quot;);
         }

         this.receiveIFPDescribe();
         break;
      case 135:
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_SGKDESCRIBE&quot;);
         }

         this.receiveSGKDescribe();
         break;
      case 136:
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_SGKTUPLE&quot;);
         }

         this.receiveSGKTuple();
         break;
      default:
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\t*** UNknown error message: &quot; + msg + &quot; ***\n&quot;);
         }

         this.setError(-408);
         retval = false;
      }

      return retval;
   }

   protected void flip() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: flip() called&quot;);
      }

      try {
         this.sendEOT();
         if (this.sqliTrace != null) {
            this.sqliTrace.recordC2S();
         }
      } catch (Exception var2) {
         throw this.handleSocketException(var2, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: flip() exited&quot;);
      }

   }

   private void sendEOT(int traceLevelNum) throws IOException {
      if (TraceFlag.isTraceEnabled()) {
         this.protoTrace.writeTrace(logger, traceLevelNum, &quot;\tSQ_EOT&quot;);
      }

      this.os.writeSmallInt((short)12);
      this.os.flush();
      this.os.setByteCntAtEOT();
   }

   private void sendEOT() throws IOException {
      this.sendEOT(1);
   }

   private void sendACK() throws IOException {
      if (TraceFlag.isTraceEnabled()) {
         this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
         this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
         this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_ACK&quot;);
      }

      this.os.writeSmallInt((short)128);
   }

   private boolean receiveEOT() throws IOException {
      boolean rv = true;
      short msg = this.is.readSmallInt();
      if (msg != 12) {
         rv = false;
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\t*** UNEXPECTED SQLI MESSAGE: &quot; + msg + &quot; ***\n&quot;);
         }
      } else if (TraceFlag.isTraceEnabled()) {
         this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_EOT&quot;);
      }

      return rv;
   }

   private void sendStatementID() throws IOException {
      if (TraceFlag.isTraceEnabled()) {
         this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
         this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
         this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_ID&quot;);
      }

      if (this.statementType != 0 || this.statementID != -1) {
         this.os.writeSmallInt((short)4);
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tID: &quot;, this.statementID);
         }

         this.os.writeSmallInt(this.statementID);
      }
   }

   public void sendSQBatchStart() throws IOException {
      if (this.conn != null &amp;&amp; this.conn.isSQBatchSupported()) {
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_BATCHSTART&quot;);
         }

         this.os.writeSmallInt((short)141);
      }

   }

   public void sendSQBatchEnd() throws IOException {
      if (this.conn != null &amp;&amp; this.conn.isSQBatchSupported()) {
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_BATCHEND&quot;);
         }

         this.os.writeSmallInt((short)142);
      }

   }

   private void sendExit() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendExit() called&quot;);
      }

      if (this.conn != null) {
         this.conn.unlockSession();
      }

      if (this.conn != null &amp;&amp; !this.conn.isASF()) {
         this.conn.setDatabaseOpen(false, this.serverWarningsShort);
      }

      this.conn.close();
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendExit() exited&quot;);
      }

   }

   private void callsetDatabaseOpen(String dbname) throws SQLException {
      if (this.OpenDBStmt) {
         this.conn.setDbName(dbname);
         this.conn.setDatabaseOpen(this.OpenDBStmt, this.serverWarningsShort);
         this.dbEncoding = this.conn.getdbEncoding();
      }

   }

   private void setError(int errcode) throws SQLException {
      throw IfxErrMsg.getSQLException(errcode, this.conn);
   }

   private void receiveDescribe() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveDescribe() called&quot;);
      }

      int nfields = false;
      int intVal = false;
      String strtab = null;
      int ifxType = false;
      int ifxExType = 0;
      int encLen = false;
      Object var11 = null;

      short nfields;
      try {
         this.statementType = this.is.readSmallInt();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tStatement Type: &quot;, this.statementType);
         }

         this.statementID = this.is.readSmallInt();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tStatement ID: &quot;, this.statementID);
         }

         int intVal = this.is.readInt();
         this.setSQLerrd((short)3, intVal);
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tEstimated Cost: &quot;, intVal);
         }

         int tupleSize = this.is.readSmallInt();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tTuplesize: &quot;, tupleSize);
         }

         nfields = this.is.readSmallInt();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\t# of fields: &quot;, nfields);
         }

         this.desc = new IfxResultSetMetaData(nfields, this.conn);
         this.desc.setTupleSize((short)tupleSize);
         int stringTableSize;
         if (this.conn.is4ByteOffsetSupported()) {
            stringTableSize = this.is.readInt();
         } else {
            stringTableSize = this.is.readSmallInt();
         }

         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tString table: &quot;, stringTableSize);
         }

         this.TxStmt = 0;
         if (this.statementType == 34) {
            this.TxStmt = 1;
         } else if (this.statementType == 35 || this.statementType == 36) {
            this.TxStmt = 2;
         }

         if (nfields &gt; 0) {
            int[] fieldIndex = new int[nfields];

            for(short i = 1; i &lt;= nfields; ++i) {
               if (this.conn.is4ByteOffsetSupported()) {
                  fieldIndex[i - 1] = this.is.readInt();
               } else {
                  fieldIndex[i - 1] = this.is.readSmallInt();
               }

               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t    Field Index: &quot;, fieldIndex[i - 1]);
               }

               short shortVal;
               if (this.conn.isUSVER()) {
                  intVal = this.is.readInt();
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tColumn Start Pos: &quot;, intVal);
                  }

                  this.desc.setColumnStartPosition(i, intVal);
               } else {
                  shortVal = this.is.readSmallInt();
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tColumn Start Pos: &quot;, shortVal);
                  }

                  this.desc.setColumnStartPosition(i, shortVal);
               }

               shortVal = this.is.readSmallInt();
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tColumn type: (&quot; + IfxTypes.IfxTypeToName(shortVal) + &quot;) &quot;, shortVal);
               }

               this.desc.setIfxColumnType(i, shortVal);
               int ifxType = this.desc.getIfxColumnType(i);
               int encLen;
               if (this.conn.isUSVER()) {
                  intVal = this.is.readInt();
                  if (TraceFlag.isTraceEnabled()) {
                     if (intVal &lt;= 26) {
                        this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tColumn Extended Builtin Id: (&quot; + IfxTypes.IfxExTypeToName(intVal) + &quot;) &quot;, intVal);
                     } else {
                        this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tColumn Extended Id: &quot;, intVal);
                     }
                  }

                  this.desc.setColumnExtendedId(i, intVal);
                  ifxExType = intVal;
                  String stringData = new String(this.is.readChar(this.dbEncoding));
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tOwner name: &quot; + stringData);
                  }

                  this.desc.setExtendedOwnerName(i, stringData);
                  stringData = new String(this.is.readChar());
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tExtended name: &quot; + stringData);
                  }

                  this.desc.setExtendedName(i, stringData);
                  shortVal = this.is.readSmallInt();
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tReference: &quot;, shortVal);
                  }

                  this.desc.setReference(i, shortVal);
                  shortVal = this.is.readSmallInt();
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tAlignment: &quot;, shortVal);
                  }

                  this.desc.setAlignment(i, shortVal);
                  intVal = this.is.readInt();
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tSource type: &quot;, intVal);
                  }

                  this.desc.setSourceType(i, intVal);
                  intVal = this.is.readInt();
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tLength: &quot;, intVal);
                  }

                  this.desc.setEncodedLength(i, intVal);
                  encLen = intVal;
               } else {
                  shortVal = this.is.readSmallInt();
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tLength: &quot;, shortVal);
                  }

                  this.desc.setEncodedLength(i, shortVal);
                  encLen = intVal;
               }

               intVal = IfxTypes.IfxTypeToDecDigits(ifxType, ifxExType, encLen);
               this.desc.setDecimalDigits(i, intVal);
               intVal = IfxTypes.IfxTypeToRightDecimal(ifxType, ifxExType, encLen);
               this.desc.setRightDecimal(i, intVal);
            }

            this.desc.setTextByteColumnCount();
         }

         if (stringTableSize &gt; 0) {
            byte[] b = new byte[stringTableSize];
            this.is.readPadded(b);
            strtab = this.conn.ifxtojava.IfxToJavaChar(b, this.dbEncoding, this.conn.encoption);
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\tData in String table: &quot;, strtab);
            }
         }
      } catch (SQLException var15) {
         throw var15;
      } catch (Exception var16) {
         throw this.handleSocketException(var16, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;Describe packet received&quot;);
      }

      if (strtab != null) {
         String colName = null;
         StringTokenizer itok = new StringTokenizer(strtab, &quot;\u0000&quot;);

         for(short i = 0; i &lt; nfields; ++i) {
            if (itok.hasMoreTokens()) {
               colName = itok.nextToken();
               this.desc.setColumnName(i + 1, colName);
            } else {
               this.desc.setColumnName(i + 1, (String)null);
            }
         }
      }

      if (this.conn != null) {
         this.desc.setDelimIdent(this.conn.isDelimIdentSet());
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveDescribe() exited&quot;);
      }

   }

   void setSQLerrd(short i, int val) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: setSQLerrd() called&quot;);
      }

      try {
         this.sqlerrd[i] = val;
      } catch (Exception var4) {
         throw this.handleSocketException(var4, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: setSQLerrd() exited&quot;);
      }

   }

   private void receiveInsertDone() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveInsertDone() called&quot;);
      }

      try {
         this.serial8Inserted = this.is.readLongInt();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tSerial8: &quot;, this.serial8Inserted);
         }

         if (this.conn.isBigintSupported()) {
            this.bigSerialInserted = this.is.readLongBigint();
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\tBigserial: &quot;, this.bigSerialInserted);
            }
         }
      } catch (Exception var2) {
         throw this.handleSocketException(var2, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveInsertDone() exited&quot;);
      }

   }

   String getServerWarningsString() {
      return this.serverWarningsString.toString();
   }

   public long getBigSerialInserted() {
      return this.bigSerialInserted;
   }

   public long getSerial8Inserted() {
      return this.serial8Inserted;
   }

   private void receiveDone() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveDone() called&quot;);
      }

      this.OpenDBStmt = false;

      try {
         if (this.executeBatchInProgress &amp;&amp; this.batchRowStatus == null) {
            this.batchRowStatus = new ArrayList();
         }

         if (this.statementType == 1 || this.statementType == 12 || this.statementType == 38) {
            this.OpenDBStmt = true;
         }

         if (this.statementType == 31) {
            this.conn.databaseClosed();
         }

         short warnings = this.is.readSmallInt();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tWarning: &quot;, warnings);
         }

         this.setWarnings(warnings, this.OpenDBStmt);
         int intVal = this.is.readInt();
         if (this.executeBatchInProgress) {
            this.batchRowStatus.add(this.batchCount++, intVal);
         }

         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\t# rows: &quot;, intVal);
         }

         this.setSQLerrd((short)2, intVal);
         intVal = this.is.readInt();
         if (intVal == 0 &amp;&amp; this.statementType == 2 &amp;&amp; !this.descTrue) {
            this.SQLState = IfxErrMsg.getSQLSTATE(100);
            this.message = IfxErrMsg.getMessage(36007, this.conn.getclLocale());
            this.addWarning(100, this.message);
         }

         this.descTrue = false;
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tRowid: &quot;, intVal);
         }

         this.setSQLerrd((short)5, intVal);
         intVal = this.is.readInt();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tSerial id: &quot;, intVal);
         }

         this.setSQLerrd((short)1, intVal);
         if (!this.OpenDBStmt &amp;&amp; this.statementType == 31) {
            this.conn.setDatabaseOpen(this.OpenDBStmt, this.serverWarningsShort);
         }
      } catch (SQLException var4) {
         throw var4;
      } catch (Exception var5) {
         throw this.handleSocketException(var5, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveDone() exited&quot;);
      }

   }

   public int getEstimateNumberofRow() {
      return this.sqlerrd[0];
   }

   public int getSerialInsert() {
      return this.sqlerrd[1];
   }

   int getISAMCode() {
      return this.isamcode;
   }

   public int getNumberOfRowsProcessed() {
      return this.sqlerrd[2];
   }

   int getEstimatedCode() {
      return this.sqlerrd[3];
   }

   int getSQLStatementOffset() {
      return this.sqlerrd[4];
   }

   int getRowID() {
      return this.sqlerrd[5];
   }

   private void receiveCost() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveCost() called&quot;);
      }

      try {
         int intVal = this.is.readInt();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tEstimated #rows: &quot;, intVal);
         }

         this.setSQLerrd((short)0, intVal);
         intVal = this.is.readInt();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tEstimated i/o: &quot;, intVal);
         }

         this.setSQLerrd((short)3, intVal);
      } catch (SQLException var3) {
         throw var3;
      } catch (Exception var4) {
         throw this.handleSocketException(var4, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveCost() exited&quot;);
      }

   }

   private void receiveXactstat() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveXactstat() called&quot;);
      }

      try {
         this.xcEvent = this.is.readSmallInt();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\txcEvent: &quot;, this.xcEvent);
         }

         this.xcNewLevel = this.is.readSmallInt();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\txcNewLevel: &quot;, this.xcNewLevel);
         }

         this.xcOldLevel = this.is.readSmallInt();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\txcOldLevel: &quot;, this.xcOldLevel);
         }
      } catch (Exception var2) {
         throw this.handleSocketException(var2, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;XA State package received&quot;);
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveXactstat() exited&quot;);
      }

   }

   int getXCEvent() {
      return this.xcEvent;
   }

   int getNewLevel() {
      return this.xcNewLevel;
   }

   int getOldLevel() {
      return this.xcOldLevel;
   }

   private void receiveTuple() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveTuple() called&quot;);
         this.trace.writeTrace(logger, 2, &quot;    totalTupleSize = &quot; + this.totalTupleSize);
         this.trace.writeTrace(logger, 2, &quot;    totalTuples = &quot; + this.totalTuples);
      }

      ++this.numberOfTuplesReceived;

      try {
         short warn = this.is.readSmallInt();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tWarning: &quot;, warn);
         }

         int size;
         if (this.conn.isUSVER()) {
            size = this.is.readInt();
         } else {
            size = this.is.readSmallInt();
         }

         if (size &gt; 0) {
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\tTuple Size :&quot;, size);
            }

            this.rowColumn.readTuple(this.is, this.totalTupleSize, size);
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\tTuple data: &quot;);
               this.protoTrace.writeTrace(logger, 2, this.rowColumn.getTupleData(), this.totalTupleSize, &#39;B&#39;, size);
            }

            this.totalTupleSize += size;
            this.tupleSizeReceived = Math.max(size, this.tupleSizeReceived);
            if (++this.totalTuples &gt;= this.offsetVector.size()) {
               this.offsetVector.setSize(this.totalTuples + 100);
            }

            this.offsetVector.setElementAt(this.totalTupleSize, this.totalTuples);
            if (TraceFlag.isTraceEnabled()) {
               this.trace.writeTrace(logger, 2, &quot;IfxSqli:receiveTuple(): tuple size = &quot; + size);
               this.trace.writeTrace(logger, 2, &quot;IfxSqli:receiveTuple(): totalTupleSize = &quot; + this.totalTupleSize);
               this.trace.writeTrace(logger, 2, &quot;IfxSqli:receiveTuple(): totalTuples = &quot; + this.totalTuples);
            }
         }
      } catch (SQLException var3) {
         throw var3;
      } catch (Exception var4) {
         throw this.handleSocketException(var4, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveTuple() exited&quot;);
      }

   }

   public void addException(SQLException e) {
      if (this.exception == null) {
         this.exception = e;
      } else {
         this.exception.setNextException(e);
      }

   }

   private void addException(int sqlcode, String sqlerrm) {
      String locale = this.conn.getclLocale();
      SQLException e = null;
      String isamMessage = &quot;&quot;;
      if (this.conn.appendIsam &amp;&amp; this.isamcode != 0) {
         isamMessage = &quot;(&quot; + sqlcode + &quot;) &quot; + IfxErrMsg.getMessage(this.isamcode, locale) + &quot;(&quot; + this.isamcode + &quot;)&quot;;
      }

      if (sqlcode == -9752 &amp;&amp; this.conn.isNamedParametersSupported()) {
         String detailHandle = IfxErrMsg.getMessage(sqlcode, locale, new Object[]{sqlerrm}) + &quot;:&quot; + sqlerrm + isamMessage;
         e = new SQLException(detailHandle, IfxErrMsg.getSQLSTATE(sqlcode), sqlcode);
      } else if (sqlcode == -268) {
         e = new SQLIntegrityConstraintViolationException(IfxErrMsg.getMessage(sqlcode, locale, new Object[]{sqlerrm}) + isamMessage, IfxErrMsg.getSQLSTATE(sqlcode), sqlcode);
      } else if (sqlerrm != null &amp;&amp; sqlerrm.length() &gt; 0) {
         e = new SQLException(IfxErrMsg.getMessage(sqlcode, locale, new Object[]{sqlerrm}) + isamMessage, IfxErrMsg.getSQLSTATE(sqlcode), sqlcode);
      } else {
         e = IfxErrMsg.getSQLException(sqlcode, this.conn);
      }

      this.addException((SQLException)e);
   }

   private void addException(String reason, String SQLState, int sqlcode) {
      String locale = this.conn.getclLocale();
      SQLException e = null;
      String isamMessage = &quot;&quot;;
      if (this.conn.appendIsam &amp;&amp; this.isamcode != 0) {
         isamMessage = &quot;(&quot; + sqlcode + &quot;) &quot; + IfxErrMsg.getMessage(this.isamcode, locale) + &quot;(&quot; + this.isamcode + &quot;)&quot;;
      }

      if (reason != null &amp;&amp; !reason.trim().isEmpty()) {
         if (SQLState != null &amp;&amp; !SQLState.trim().isEmpty()) {
            e = new SQLException(reason + isamMessage, SQLState, sqlcode);
         } else {
            e = new SQLException(reason + isamMessage, &quot;U0001&quot;, sqlcode);
         }
      } else if (SQLState != null &amp;&amp; !SQLState.trim().isEmpty()) {
         e = new SQLException(IfxErrMsg.getMessage(sqlcode, locale) + isamMessage, SQLState, sqlcode);
      } else {
         e = new SQLException(IfxErrMsg.getMessage(sqlcode, locale) + isamMessage, IfxErrMsg.getSQLSTATE(sqlcode), sqlcode);
      }

      this.addException(e);
   }

   public SQLException getExceptions() {
      return this.exception;
   }

   private void addWarning(SQLWarning w) {
      if (this.warn == null) {
         this.warn = w;
      } else {
         this.warn.setNextException(w);
      }

   }

   private void addWarning(int sqlcode, String message) {
      SQLWarning w = null;
      w = new SQLWarning(message, IfxErrMsg.getSQLSTATE(sqlcode), sqlcode);
      this.addWarning(w);
   }

   private void addWarning(String message, String sqlstate) {
      SQLWarning w = null;
      if (sqlstate != null) {
         w = IfxWarnMsg.getSQLWarning(sqlstate, message, this.conn);
      } else {
         w = IfxWarnMsg.getSQLWarning(message, this.conn);
      }

      this.addWarning(w);
   }

   private void setWarnings(short w, boolean OpenDBStmt) {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: setWarnings() called&quot;);
      }

      int set = false;
      this.SQLState = null;
      if (this.conn.Noansiwarn) {
         w = (short)(w &amp; -17);
      }

      this.serverWarningsShort = w;

      for(short i = 1; i &lt;= 6; ++i) {
         int set = w &amp; 1;
         if (set == 1) {
            this.serverWarningsString.setCharAt(i, &#39;W&#39;);
            switch(i) {
            case 1:
               if (OpenDBStmt) {
                  this.addWarning((String)null, &quot;01I01&quot;);
               } else {
                  this.addWarning((String)null, &quot;01006&quot;);
               }
               break;
            case 2:
               if (OpenDBStmt) {
                  this.addWarning((String)null, &quot;01I03&quot;);
               } else {
                  this.addWarning((String)null, &quot;01003&quot;);
               }
               break;
            case 3:
               if (OpenDBStmt) {
                  this.addWarning((String)null, &quot;01I04&quot;);
               } else {
                  this.addWarning((String)null, &quot;01003&quot;);
               }
               break;
            case 4:
               this.addWarning((String)null, &quot;01I05&quot;);
               break;
            case 5:
               this.addWarning((String)null, &quot;01I06&quot;);
               break;
            case 6:
               if (OpenDBStmt) {
                  this.addWarning((String)null, &quot;01I10&quot;);
               } else {
                  this.addWarning((String)null, &quot;01I11&quot;);
               }
            }
         } else {
            this.serverWarningsString.setCharAt(i, &#39; &#39;);
         }

         w = (short)(w &gt;&gt; 1);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: setWarnings() exited&quot;);
      }

   }

   public void chainWarnings(SQLWarning cwarn) {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: chainWarnings() called&quot;);
      }

      if (cwarn != null) {
         if (this.warn != null) {
            this.warn.setNextWarning(cwarn);
         } else {
            this.warn = cwarn;
         }
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: chainWarnings() exited&quot;);
      }

   }

   public void clearExceptions() {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: clearExceptions() called&quot;);
      }

      this.sqlcode = 0;
      this.isamcode = 0;
      this.SQLState = null;
      this.message = null;
      this.exception = null;
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: clearExceptions() exited&quot;);
      }

   }

   public void clearWarnings() {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: clearWarnings() called&quot;);
      }

      this.SQLState = null;
      this.message = null;
      this.sqlcode = 0;
      this.isamcode = 0;
      this.warn = null;
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: clearWarnings() exited&quot;);
      }

   }

   public SQLWarning getWarnings() {
      return this.warn;
   }

   private void receivePutErr() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receivePutErr() called&quot;);
      }

      try {
         this.putErrRowCount = this.is.readInt();
      } catch (Exception var2) {
         throw this.handleSocketException(var2, this.conn);
      }

      this.receiveError();
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receivePutErr() exited&quot;);
      }

   }

   private void receiveError() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveError() called&quot;);
      }

      try {
         this.sqlcode = this.is.readSmallInt();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tSQLcode: &quot;, this.sqlcode);
         }

         if (this.sqlcode == -619) {
            this.gobbleSmallInts(2);
            if (this.conn.isRemove64KLimitSupported()) {
               this.gobbleSmallInts(1);
            }

            this.is.readChar();
            if (TraceFlag.isTraceEnabled()) {
               this.trace.writeTrace(logger, 2, &quot;Error Code 619, resyncing data&quot;);
            }

            this.addException(this.sqlcode, (String)null);
            return;
         }

         this.isamcode = this.is.readSmallInt();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tISAM/RSAM error: &quot;, this.isamcode);
         }

         this.setSQLerrd((short)1, this.isamcode);
         int shortVal;
         if (this.conn.isRemove64KLimitSupported()) {
            shortVal = this.is.readInt();
         } else {
            shortVal = this.is.readSmallInt();
         }

         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tOffset into statement: &quot;, shortVal);
         }

         this.setSQLerrd((short)4, shortVal);
         this.conn.setSQLStatementOffset(shortVal);
         if (this.sqlcode != -368) {
            this.sqlerrm = this.is.readChar(this.dbEncoding).trim();
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\tsqlerrm: &quot; + this.sqlerrm);
            }
         }

         if (this.sqlcode == 0 &amp;&amp; !this.conn.isUSVER()) {
            this.sqlcode = -407;
            this.isamcode = 0;
            this.addException(this.sqlcode, (String)null);
         } else if (this.sqlcode == 100) {
            this.SQLState = IfxErrMsg.getSQLSTATE(this.sqlcode);
            this.message = IfxErrMsg.getMessage(36007, this.conn.getclLocale());
            this.addWarning(this.sqlcode, this.message);
            if (this.conn.AnsiDb) {
               this.setSQLerrd((short)2, 0);
               if (this.batchRowStatus == null) {
                  this.batchRowStatus = new ArrayList();
               }
            }
         } else if (this.sqlcode != 0 &amp;&amp; this.sqlcode != -937) {
            this.addException(this.sqlcode, this.sqlerrm);
            if (this.isamcode != 0) {
               this.addException(this.isamcode, (String)null);
            }

            SQLException causeException = IfxErrMsg.getSQLException(this.isamcode, this.conn);
            IfxErrMsg.setSQLExceptionCause(this.exception, causeException);
         } else {
            byte[] b = new byte[5];
            this.is.readPadded(b);
            this.SQLState = this.conn.ifxtojava.IfxToJavaChar(b, this.conn.encoption);
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\tSQLState: &quot;, this.SQLState);
            }

            this.message = this.is.readChar(this.dbEncoding);
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\tMI message:&quot;, this.message);
            }

            this.sqlerrm = null;
            if (this.sqlcode == 0) {
               this.isamcode = 0;
               this.addWarning(this.message, this.SQLState);
            } else {
               this.addException(this.message, this.SQLState, this.sqlcode);
               if (this.isamcode != 0) {
                  this.addException(this.isamcode, (String)null);
               }
            }
         }
      } catch (SQLException var3) {
         throw var3;
      } catch (Exception var4) {
         this.addException(-79716, (String)null);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveError() exited&quot;);
      }

   }

   public int getSQLCode() {
      return this.sqlcode;
   }

   String getSQLErrm() {
      return this.sqlerrm;
   }

   String getSQLState() {
      return this.SQLState;
   }

   String getMessage() {
      return this.message;
   }

   private void receiveTupleId() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveTupleId() called&quot;);
      }

      try {
         this.Tupid = this.is.readInt();
         if (this.getTupleCount() &gt; 0) {
            this.firstTuple = this.Tupid;
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\tTuple ID: &quot;, this.firstTuple);
            }

            this.lastTuple = this.firstTuple + this.getTupleCount() - 1;
         } else {
            int var1 = this.Tupid;
         }
      } catch (Exception var3) {
         throw this.handleSocketException(var3, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveTupleId() exited&quot;);
      }

   }

   void executeInfo(short regflag) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeInfo() called&quot;);
      }

      if (!this.conn.lockSession()) {
         throw IfxErrMsg.getSQLMinorException(-79748, -80033, this.conn);
      } else {
         try {
            this.sendInfo(regflag);
            this.receiveMessage();
         } catch (SQLException var3) {
            this.conn.unlockSession();
            throw var3;
         } catch (Exception var4) {
            this.conn.unlockSession();
            throw this.handleSocketException(var4, this.conn);
         }

         this.conn.unlockSession();
         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeInfo() exited&quot;);
         }

      }
   }

   private void sendInfo(short regflag) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendInfo() called&quot;);
      }

      try {
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_INFO &quot;, (short)81);
         }

         this.os.writeSmallInt((short)81);
         if (regflag != 0) {
            this.os.writeSmallInt((short)1);
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\tINFO_REQUEST&quot;);
            }

            this.os.writeSmallInt((short)0);
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tData: &quot;, (short)0);
            }
         }

         this.os.writeSmallInt((short)0);
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tINFO_DONE&quot;);
         }
      } catch (Exception var3) {
         throw this.handleSocketException(var3, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendInfo() called&quot;);
      }

   }

   private void receiveInfo() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveInfo() called&quot;);
      }

      short message;
      try {
         while((message = this.is.readSmallInt()) &gt; 0) {
            int length = this.is.readSmallInt();
            int intVal;
            int CapList;
            switch(message) {
            case 2:
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\tINFO_VERSION&quot;);
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tLength: &quot;, length);
               }

               if (length &lt; 4) {
                  this.setError(-408);
               } else {
                  int var9 = length - 4;
               }
               break;
            case 3:
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\tINFO_TYPE&quot;);
               }

               int TypeList = 0;

               for(CapList = 0; CapList &lt; length / 4; ++CapList) {
                  intVal = this.is.readInt();
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tData:  &quot;, intVal);
                  }

                  TypeList |= intVal;
               }

               this.conn.setTypeList(TypeList);
               break;
            case 4:
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\tINFO_CAPABILITY&quot;);
               }

               CapList = 0;

               for(int i = 0; i &lt; length / 4; ++i) {
                  intVal = this.is.readInt();
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tData:  &quot;, intVal);
                  }

                  CapList |= intVal;
               }

               this.conn.setCapList(CapList);
               break;
            default:
               this.gobbleChars(length);
            }
         }
      } catch (SQLException var7) {
         throw var7;
      } catch (Exception var8) {
         throw this.handleSocketException(var8, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveInfo() exited&quot;);
      }

   }

   public void executeEnv(Properties EnvVars) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeEnv() called&quot;);
      }

      if (!this.conn.lockSession()) {
         throw IfxErrMsg.getSQLMinorException(-79748, -80033, this.conn);
      } else {
         try {
            this.sendEnv(EnvVars);
            this.receiveMessage();
         } catch (SQLException var3) {
            this.conn.unlockSession();
            throw var3;
         } catch (Exception var4) {
            this.conn.unlockSession();
            throw this.handleSocketException(var4, this.conn);
         }

         this.conn.unlockSession();
         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeEnv() exited&quot;);
         }

      }
   }

   private void sendEnv(Properties EnvVars) throws SQLException {
      short totLen = false;
      short nameLen = false;
      short valueLen = false;
      short LongNameLen = 0;
      short LongValueLen = 0;
      String name = null;
      String value = null;
      int len = false;
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendEnv() called&quot;);
      }

      IfxDataOutputStream os = this.conn.Ifxproto_send();
      if (this.conn.isASF()) {
         short totLen = 4;
         Enumeration e = EnvVars.propertyNames();

         while(e.hasMoreElements()) {
            name = (String)e.nextElement();
            value = EnvVars.getProperty(name);
            short nameLen = (short)name.length();
            short valueLen = (short)value.length();
            int len = nameLen &amp; 1;
            if (len == 1) {
               ++nameLen;
            }

            len = valueLen &amp; 1;
            if (len == 1) {
               ++valueLen;
            }

            totLen = (short)(totLen + nameLen + valueLen + 4);
            if (nameLen &gt; LongNameLen) {
               LongNameLen = nameLen;
            }

            if (valueLen &gt; LongValueLen) {
               LongValueLen = valueLen;
            }
         }

         totLen = (short)(totLen + 2);

         try {
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
               this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
               this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_INFO &quot;, (short)81);
            }

            os.writeSmallInt((short)81);
            os.writeSmallInt((short)6);
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\tINFO_ENV&quot;);
            }

            os.writeSmallInt(totLen);
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tTotal Length: &quot;, totLen);
            }

            os.writeSmallInt(LongNameLen);
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tLong Name Length: &quot;, LongNameLen);
            }

            os.writeSmallInt(LongValueLen);
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tLong Value Length: &quot;, LongValueLen);
            }

            e = EnvVars.propertyNames();

            while(true) {
               if (!e.hasMoreElements()) {
                  os.writeSmallInt((short)0);
                  os.writeSmallInt((short)0);
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\tINFO_DONE&quot;);
                  }
                  break;
               }

               name = (String)e.nextElement();
               value = EnvVars.getProperty(name);
               byte[] nameBytes = null;
               Object var13 = null;

               byte[] nameBytes;
               byte[] valueBytes;
               try {
                  nameBytes = os.getJavaToIfxChar(name, this.dbEncoding);
                  valueBytes = os.getJavaToIfxChar(value, this.dbEncoding);
               } catch (Exception var15) {
                  os.writeSmallInt((short)0);
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tNull Terminator: &quot;, (short)0);
                  }

                  os.writeSmallInt((short)0);
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\tINFO_DONE&quot;);
                  }

                  throw var15;
               }

               os.writeChar(nameBytes);
               os.writeChar(valueBytes);
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t\t\&quot;&quot;, name + &quot;\&quot;=\&quot;&quot; + value + &quot;\&quot;&quot;);
               }
            }
         } catch (Exception var16) {
            if (var16 instanceof SQLException) {
               throw (SQLException)var16;
            }

            throw this.handleSocketException(var16, this.conn);
         }

         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendEnv() called&quot;);
         }

      }
   }

   private void gobbleChars(int length) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: gobbleChars() called&quot;);
      }

      try {
         byte[] b = new byte[length];
         this.is.readPadded(b);
      } catch (Exception var3) {
         throw this.handleSocketException(var3, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: gobbleChars() exited&quot;);
      }

   }

   private void gobbleSmallInts(int number) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: gobbleSmallInts() called&quot;);
      }

      try {
         for(int i = 0; i &lt; number; ++i) {
            this.is.readSmallInt();
         }
      } catch (Exception var4) {
         throw this.handleSocketException(var4, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: gobbleSmallInts() exited&quot;);
      }

   }

   public void executeVersion() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeVersion() called&quot;);
      }

      if (!this.conn.lockSession()) {
         throw IfxErrMsg.getSQLMinorException(-79748, -80033, this.conn);
      } else {
         try {
            this.sendVersion();
            this.receiveMessage();
         } catch (SQLException var2) {
            this.conn.unlockSession();
            throw var2;
         } catch (Exception var3) {
            this.conn.unlockSession();
            throw this.handleSocketException(var3, this.conn);
         }

         this.conn.unlockSession();
         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeVersion() exited&quot;);
         }

      }
   }

   private void sendVersion() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendVersion() called&quot;);
      }

      try {
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_VERSION&quot;);
         }

         this.os.writeSmallInt((short)53);
      } catch (Exception var2) {
         throw this.handleSocketException(var2, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendVersion() exited&quot;);
      }

   }

   private void receiveVersion() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveVersion() called&quot;);
      }

      try {
         this.serverVersion = new String(this.is.readChar());
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tServer Version: &quot; + this.serverVersion);
         }
      } catch (Exception var2) {
         throw this.handleSocketException(var2, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveVersion() exited&quot;);
      }

   }

   public String getServerVersion() {
      return this.serverVersion;
   }

   int getTupleBufferSize(int fetchBufferSize) {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: getTupleBufferSize() called&quot;);
      }

      if (fetchBufferSize &gt; 0) {
         return Math.min(fetchBufferSize, this.conn.getMaxFetchBufSize());
      } else if (this.tupleBufferSize != -1) {
         return this.tupleBufferSize;
      } else {
         if (this.desc.getTupleSize() &lt;= 2048) {
            this.tupleBufferSize = 4096;
         } else if (this.desc.getTupleSize() &lt;= 4096) {
            this.tupleBufferSize = 8192;
         } else {
            this.tupleBufferSize = this.desc.getTupleSize();
         }

         if (this.conn.fetchBufSize &gt; this.tupleBufferSize) {
            this.tupleBufferSize = this.conn.getCorrectedFetchBufSize();
         }

         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 1, &quot;IfxSqli: getTupleBufferSize() exited&quot;);
         }

         return this.tupleBufferSize;
      }
   }

   public boolean isResultSet() throws SQLException {
      int outputNumber = 0;
      if (this.desc != null) {
         outputNumber = this.desc.getColumnCount();
      }

      return this.statementType == 2 || this.statementType == 56 &amp;&amp; outputNumber &gt; 0;
   }

   public int getTupleCount() {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: getTupleCount() called&quot;);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 3, &quot;IfxSqli.getTupleCount(): size&quot;, this.totalTuples - (this.curRow + 1));
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: getTupleCount() exited&quot;);
      }

      return this.totalTuples;
   }

   public boolean getaRow(int direction, int count, int scrolltype, int isscrollcurs, Statement stmt) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: getaRow() called&quot;);
      }

      if (direction != 1000 &amp;&amp; count != 1) {
         throw IfxErrMsg.getSQLException(-79751, this.conn);
      } else {
         if (stmt.getResultSetType() == 1003) {
            this.conn.closeFinalizedBlobsOnServer();
         }

         if (isscrollcurs == 1 &amp;&amp; (scrolltype == 6 || scrolltype == 1)) {
            if (this.getTupleCount() != 0) {
               this.repositionIfInTupleBuffer(count);
            }

            if (count == 0) {
               this.curRow = -1;
               return false;
            }
         }

         int tcount = this.getTupleCount() - (this.curRow + 1);
         if (isscrollcurs == 1) {
            if (!this.SQ_CLOSERecvd &amp;&amp; (this.getNumberOfTuplesReceived() != 0 || this.first) &amp;&amp; (tcount == 0 || scrolltype != 1 &amp;&amp; scrolltype != 6)) {
               IfxResultSet currentRS = ((IfxStatement)stmt).currentResult;
               int fetchBufferSize = 0;
               if (currentRS.getFetchSize() != 0) {
                  fetchBufferSize = currentRS.calculateFetchBufferSize();
               }

               if (fetchBufferSize != 0) {
                  fetchBufferSize = Math.min(fetchBufferSize, this.conn.getMaxFetchBufSize());
               }

               this.executeScrollFetch(scrolltype, count, stmt, fetchBufferSize);
               tcount = this.getTupleCount() - (this.curRow + 1);
            }
         } else {
            if (!this.SQ_CLOSERecvd &amp;&amp; !this.first) {
               return false;
            }

            if (!this.SQ_CLOSERecvd &amp;&amp; this.first &amp;&amp; tcount == 0) {
               this.executeFetch(stmt);
               ((IfxStatement)stmt).cursorOpen = true;
               tcount = this.getTupleCount() - (this.curRow + 1);
            }
         }

         if (tcount == 0) {
            if (isscrollcurs != 1 &amp;&amp; this.conn.isCommitNeeded() &amp;&amp; !this.doneCommit) {
               this.executeCommit();
               this.doneCommit = true;
            }

            this.first = false;
            return false;
         } else {
            ++this.curRow;
            if (isscrollcurs == 1 &amp;&amp; count != this.getTupid() &amp;&amp; (scrolltype == 6 || scrolltype == 1)) {
               throw IfxErrMsg.getSQLException(-79716, this.conn);
            } else {
               this.curOffset = ((Integer)this.offsetVector.get(this.curRow)).intValue();
               if (TraceFlag.isTraceEnabled()) {
                  this.trace.writeTrace(logger, 1, &quot;curRow = &quot; + this.curRow);
                  this.trace.writeTrace(logger, 1, &quot;currOffset = &quot; + this.curOffset);
               }

               this.rowColumn.setOffsetInTuple(this.curOffset);
               if (TraceFlag.isTraceEnabled()) {
                  this.trace.writeTrace(logger, 1, &quot;IfxSqli: getaRow() exited&quot;);
               }

               return true;
            }
         }
      }
   }

   public int getTupleSize() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: getTupleSize() called&quot;);
      }

      return this.desc.getTupleSize();
   }

   private void repositionIfInTupleBuffer(int rowId) {
      if (rowId &gt;= this.firstTuple &amp;&amp; rowId &lt;= this.lastTuple) {
         this.curRow = rowId - this.firstTuple - 1;
      } else {
         this.curRow = this.totalTuples - 1;
      }

   }

   public IfxObject getColumnInRow(int colIndex) throws SQLException {
      if (this.rowColumn == null) {
         throw IfxErrMsg.getSQLException(-79739, this.conn);
      } else {
         return this.rowColumn.getColumn(colIndex, (Calendar)null);
      }
   }

   IfxObject getColumnInRow(int colIndex, Calendar cal) throws SQLException {
      if (this.rowColumn == null) {
         throw IfxErrMsg.getSQLException(-79739, this.conn);
      } else {
         return this.rowColumn.getColumn(colIndex, cal);
      }
   }

   public void loadColumnData(int colIndex, IfxObject val) throws SQLException {
      if (this.rowColumn == null) {
         throw IfxErrMsg.getSQLException(-79739, this.conn);
      } else {
         this.rowColumn.loadColumnData(colIndex, val);
      }
   }

   private void sendBlob(List&lt;IfxObject&gt; vector, int count, int si, int inputvals) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendBlob() called&quot;);
      }

      try {
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_BBIND&quot;);
         }

         this.os.writeSmallInt((short)41);
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\t\t# of blobs: &quot;, count);
         }

         this.os.writeSmallInt((short)count);
         this.os.flush();
      } catch (Exception var9) {
         throw this.handleSocketException(var9, this.conn);
      }

      for(int i = 0; i &lt; inputvals; ++i) {
         this.isText = false;
         IfxObject ival = (IfxObject)vector.get(si + i);
         short type = (short)ival.getIfxType();
         if (type == 12) {
            this.isText = true;
         }

         if (!ival.isNull() &amp;&amp; (type == 11 || type == 12)) {
            IfxBlob BlobObject = (IfxBlob)ival;
            if (type == 11 || this.isText &amp;&amp; !this.convText) {
               if (BlobObject.isBlobByteType()) {
                  this.sendBytesBlob(this.os, BlobObject.getBlobBuffer());
               } else {
                  this.sendStreamBlob(this.os, BlobObject.getBlobInputStream(), BlobObject.getBlobLength());
               }
            } else if (BlobObject.isBlobByteType()) {
               this.convTextBlobBuffer(BlobObject);
               this.sendBytesBlob(this.os, BlobObject.getBlobBuffer());
            } else {
               this.convTextBlobStream(BlobObject);
               this.sendStreamBlob(this.os, BlobObject.getBlobInputStream(), BlobObject.getBlobLength());
            }
         }

         this.isText = false;
      }

      this.isText = false;
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendBlob() exited&quot;);
      }

   }

   private void convTextBlobStream(IfxBlob blobObj) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: convTextBlobStream() called &quot;);
      }

      InputStream in = null;
      OutputStream out = null;
      IfxTmpFile tempBlobFile = null;
      String from = this.conn.getclEncoding();
      String to = this.conn.getdbEncoding();

      try {
         if (blobObj.getBlobLength() &lt;= this.conn.getCodesetLobSize()) {
            in = blobObj.getBlobInputStream();
            out = new ByteArrayOutputStream();
         } else {
            in = blobObj.getBlobInputStream();
            tempBlobFile = new IfxTmpFile(this.conn);
            out = tempBlobFile.getOutputStream();
         }

         Reader r = new BufferedReader(new InputStreamReader(in, from));
         Writer w = new BufferedWriter(new OutputStreamWriter((OutputStream)out, to));
         char[] buffer = new char[4096];

         int len;
         while((len = r.read(buffer)) != -1) {
            w.write(buffer, 0, len);
         }

         r.close();
         w.flush();
         w.close();
         in.close();
         if (tempBlobFile == null) {
            IfxByteArrayInputStream fin = new IfxByteArrayInputStream((ByteArrayOutputStream)out);
            blobObj.fromInputStream(fin, ((ByteArrayOutputStream)out).size());
         } else {
            ((OutputStream)out).close();
            int fileLength = tempBlobFile.length();
            blobObj.fromInputStream(tempBlobFile.getInputStream(), fileLength);
         }
      } catch (Exception var12) {
         throw this.handleSocketException(var12, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: convTextBlobStream() exited &quot;);
      }

   }

   private void convTextBlobBuffer(IfxBlob blobObj) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: convTextBlobBuffer() called &quot;);
      }

      InputStream in = null;
      OutputStream out = null;
      IfxTmpFile tempBlobFile = null;
      String from = this.conn.getclEncoding();
      String to = this.conn.getdbEncoding();

      try {
         in = new IfxByteArrayInputStream(blobObj.getBlobBuffer());
         if (blobObj.getBlobLength() &lt;= this.conn.getCodesetLobSize()) {
            out = new ByteArrayOutputStream();
         } else {
            tempBlobFile = new IfxTmpFile(this.conn);
            out = tempBlobFile.getOutputStream();
         }

         Reader r = new BufferedReader(new InputStreamReader(in, from));
         Writer w = new BufferedWriter(new OutputStreamWriter((OutputStream)out, to));
         char[] buffer = new char[4096];

         int len;
         while((len = r.read(buffer)) != -1) {
            w.write(buffer, 0, len);
         }

         r.close();
         w.flush();
         w.close();
         in.close();
         blobObj.blobBuffer = null;
         if (tempBlobFile == null) {
            blobObj.setBlobBuffer(((ByteArrayOutputStream)out).toByteArray());
         } else {
            ((OutputStream)out).close();
            InputStream fin = tempBlobFile.getInputStream();
            int fileLength = tempBlobFile.length();
            byte[] buf = new byte[fileLength];
            fin.read(buf, 0, fileLength);
            blobObj.setBlobBuffer(buf);
         }
      } catch (Exception var14) {
         throw this.handleSocketException(var14, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: convTextBlobBuffer() exited &quot;);
      }

   }

   private void sendBytesBlob(IfxDataOutputStream os, byte[] buffer) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendBytesBlob() called&quot;);
      }

      int dataLength = buffer.length;
      int dataOffset = 0;
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 99, &quot;IfxSqli.IfxBlob() : - 2&quot;);
         this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
         this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
         this.trace.writeTrace(logger, 3, &quot;  sendBytesBlob(): datalength = &quot;, dataLength);
      }

      while(dataLength &gt; 0) {
         try {
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_BLOB&quot;);
            }

            os.writeSmallInt((short)39);
            if (dataLength &gt; 1024) {
               if (TraceFlag.isTraceEnabled()) {
                  this.trace.writeTrace(logger, 99, &quot;IfxSqli.IfxBlob() : - 3.0&quot;);
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\tSize: &quot;, (short)1024);
               }

               os.writeSmallInt((short)1024);
               os.writePadded(buffer, dataOffset, 1024);
               dataLength -= 1024;
               dataOffset += 1024;
            } else {
               if (TraceFlag.isTraceEnabled()) {
                  this.trace.writeTrace(logger, 99, &quot;IfxSqli.IfxBlob() : - 3.1&quot;);
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\tSize: &quot;, dataLength);
               }

               os.writeSmallInt((short)dataLength);
               os.writePadded(buffer, dataOffset, dataLength);
               dataLength = 0;
            }
         } catch (Exception var6) {
            throw this.handleSocketException(var6, this.conn);
         }
      }

      try {
         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 99, &quot;IfxSqli.IfxBlob() : - 4&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_BLOB&quot;);
         }

         os.writeSmallInt((short)39);
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tSize: &quot;, 0);
         }

         os.writeSmallInt((short)0);
      } catch (Exception var7) {
         throw this.handleSocketException(var7, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendBytesBlob() exited&quot;);
      }

   }

   private void sendStreamBlob(IfxDataOutputStream os, InputStream fd, int length) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 99, &quot;IfxSqli.IfxBlob() : - 5&quot;);
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendStreamBlob() called&quot;);
      }

      int dataLength = length;
      byte[] buffer = new byte[1024];
      int readLength = false;
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 3, &quot;    sendStreamBlob():length = &quot;, length);
         this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
         this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
      }

      while(dataLength &gt; 0) {
         try {
            int readLength;
            if (dataLength &gt; 1024) {
               if (TraceFlag.isTraceEnabled()) {
                  this.trace.writeTrace(logger, 99, &quot;IfxSqli.IfxBlob() : - 6&quot;);
               }

               readLength = fd.read(buffer, 0, 1024);
               if (readLength &lt;= 0) {
                  break;
               }

               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_BLOB&quot;);
               }

               os.writeSmallInt((short)39);
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\tSize: &quot;, readLength);
               }

               os.writeSmallInt((short)readLength);
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\tData:&quot;);
                  this.protoTrace.writeTrace(logger, 2, buffer, &#39;H&#39;);
               }

               os.writePadded(buffer, 0, readLength);
               dataLength -= readLength;
            } else {
               if (TraceFlag.isTraceEnabled()) {
                  this.trace.writeTrace(logger, 99, &quot;IfxSqli.IfxBlob() : - 7&quot;);
               }

               readLength = fd.read(buffer, 0, dataLength);
               if (TraceFlag.isTraceEnabled()) {
                  this.trace.writeTrace(logger, 99, &quot;sendStreamBlob().readLength: &quot;, readLength);
               }

               if (readLength &lt;= 0) {
                  break;
               }

               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_BLOB&quot;);
               }

               os.writeSmallInt((short)39);
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\tSize: &quot;, readLength);
               }

               os.writeSmallInt((short)readLength);
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\tData:&quot;);
                  this.protoTrace.writeTrace(logger, 2, buffer, &#39;H&#39;);
               }

               os.writePadded(buffer, 0, readLength);
               dataLength -= readLength;
            }
         } catch (Exception var12) {
            break;
         }
      }

      try {
         os.flush();
         fd.close();
      } catch (Exception var10) {
         ;
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 99, &quot;sendStreamBlob().dataLength: &quot;, dataLength);
      }

      if (dataLength == 0) {
         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 99, &quot;IfxSqli.IfxBlob() : - 8&quot;);
         }

         try {
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_BLOB&quot;);
            }

            os.writeSmallInt((short)39);
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\tSize: &quot;, 0);
            }

            os.writeSmallInt((short)0);
         } catch (Exception var9) {
            throw this.handleSocketException(var9, this.conn);
         }
      } else {
         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 99, &quot;IfxSqli.IfxBlob() : - 9&quot;);
         }

         try {
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_FERR&quot;);
            }

            os.writeSmallInt((short)40);
         } catch (Exception var8) {
            ;
         }

         try {
            this.receiveMessage();
         } catch (SQLException var11) {
            if (this.TxStmt == 2) {
               if (TraceFlag.isTraceEnabled()) {
                  this.trace.writeTrace(logger, 2, &quot;IfxBlob: END_TX_STMT, return error&quot;);
               }

               if (this.sqlcode != -255) {
                  this.conn.setTxEndState();
               }
            }

            if (TraceFlag.isTraceEnabled()) {
               this.trace.writeTrace(logger, 99, &quot;IfxSqli.IfxBlob() : - 10&quot;);
            }

            throw IfxErrMsg.getSQLException(-79752, this.conn);
         }
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendStreamBlob() exited&quot;);
      }

   }

   public void executeFetchBlob(IfxObject blobDesc) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeFetchBlob() called&quot;);
      }

      int bufferSize;
      if (this.convText) {
         bufferSize = this.conn.getCodesetLobSize();
      } else {
         bufferSize = this.conn.getBlobCacheSize();
      }

      this.BlobFd = null;
      this.BlobBuffer = null;
      this.BlobWriteFailure = 0;
      this.BlobWriteOffset = 0;
      this.BufferOrStream = 0;
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 99, &quot;IfxSqli.IfxBlob() : - 10&quot;);
      }

      IfxBlob blobInfo = (IfxBlob)blobDesc;
      int blobLength = blobInfo.getBlobLength();
      short type = (short)blobDesc.getIfxType();
      if (type == 12) {
         this.isText = true;
      } else {
         this.isText = false;
      }

      if (bufferSize &lt; 0 || bufferSize &gt; 0 &amp;&amp; blobLength &lt;= bufferSize) {
         try {
            this.BlobBuffer = new byte[blobLength];
         } catch (Exception var23) {
            throw IfxErrMsg.getSQLException(var23, -79753, this.conn);
         }

         blobInfo.setBlobBuffer(this.BlobBuffer);
         blobInfo.setBlobFileName();
         this.BufferOrStream = 0;
      } else {
         blobInfo.tempBlobFile = new IfxTmpFile(this.conn);

         try {
            this.BlobFd = blobInfo.tempBlobFile.getOutputStream();
            this.BlobBuffer = null;
            this.BufferOrStream = 1;
         } catch (Exception var24) {
            if (bufferSize == 0) {
               throw IfxErrMsg.getSQLException(-79774, this.conn);
            }

            this.BlobBuffer = new byte[blobLength];
            blobInfo.setBlobBuffer(this.BlobBuffer);
            blobInfo.setBlobFileName();
            this.BufferOrStream = 0;
         }
      }

      this.conn.lockSession();

      try {
         this.sendFetchBlob((IfxBlob)blobDesc);
         this.receiveMessage();
      } catch (SQLException var20) {
         try {
            if (this.BlobFd != null) {
               this.BlobFd.close();
            }
         } catch (IOException var18) {
            this.isText = false;
         }

         throw var20;
      } catch (Exception var21) {
         try {
            this.BlobFd.close();
         } catch (IOException var17) {
            ;
         }

         this.isText = false;
         throw this.handleSocketException(var21, this.conn);
      } finally {
         this.conn.unlockSession();
      }

      if (this.BlobFd != null) {
         try {
            this.BlobFd.close();
         } catch (IOException var19) {
            this.isText = false;
            throw this.handleSocketException(var19, this.conn);
         }
      }

      if (this.BlobWriteFailure == 1) {
         this.isText = false;
         throw IfxErrMsg.getSQLException(-79754, this.conn);
      } else {
         if (this.isText &amp;&amp; this.convText) {
            this.fetchCodesetConvertedTextBlob(blobInfo);
         }

         this.isText = false;
         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeFetchBlob() exited&quot;);
         }

      }
   }

   private void fetchCodesetConvertedTextBlob(IfxBlob blobInfo) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: fetchCodesetConvertedTextBlob() called&quot;);
      }

      InputStream in = null;
      OutputStream out = null;
      String from = this.conn.getdbEncoding();
      String to = this.conn.getclEncoding();

      try {
         if (blobInfo.getBlobLength() &lt;= this.conn.getCodesetLobSize()) {
            in = new IfxByteArrayInputStream(blobInfo.blobBuffer);
            out = new ByteArrayOutputStream();
         } else {
            IfxTmpFile infile = blobInfo.tempBlobFile;
            in = infile.getInputStream();
            blobInfo.tempBlobFile = new IfxTmpFile(this.conn);
            out = blobInfo.tempBlobFile.getOutputStream();
         }

         Reader r = new BufferedReader(new InputStreamReader((InputStream)in, from));
         Writer w = new BufferedWriter(new OutputStreamWriter((OutputStream)out, to));
         char[] buffer = new char[4096];

         while(true) {
            int len;
            if ((len = r.read(buffer)) == -1) {
               r.close();
               w.flush();
               w.close();
               if (blobInfo.getBlobLength() &gt; this.conn.getCodesetLobSize()) {
                  ((OutputStream)out).close();
               } else {
                  this.BlobBuffer = ((ByteArrayOutputStream)out).toByteArray();
                  blobInfo.setBlobBuffer(this.BlobBuffer);
               }

               ((InputStream)in).close();
               break;
            }

            w.write(buffer, 0, len);
         }
      } catch (Exception var17) {
         throw this.handleSocketException(var17, this.conn);
      } finally {
         if (in != null) {
            try {
               ((InputStream)in).close();
            } catch (IOException var16) {
               ;
            }
         }

      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: fetchCodesetConvertedTextBlob() called&quot;);
      }

   }

   private void sendFetchBlob(IfxBlob blobDesc) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 99, &quot;IfxSqli.IfxBlob() : - 11&quot;);
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendFetchBlob() called&quot;);
      }

      try {
         this.sendStatementID();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_FETCHBLOB&quot;);
         }

         this.os.writeSmallInt((short)38);
      } catch (Exception var4) {
         throw this.handleSocketException(var4, this.conn);
      }

      try {
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tDescriptor:&quot;);
            this.protoTrace.writeTrace(logger, 2, blobDesc.toIfx(), &#39;H&#39;);
         }

         this.os.writePadded(blobDesc.toIfx());
      } catch (Exception var3) {
         throw this.handleSocketException(var3, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendFetchBlob() exited&quot;);
      }

   }

   private void receiveText() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 99, &quot;IfxSqli.IfxClob() : - 13&quot;);
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveText() called&quot;);
      }

      Object var3 = null;

      short datalen;
      try {
         datalen = this.is.readSmallInt();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tSize: &quot;, datalen);
         }
      } catch (Exception var9) {
         throw this.handleSocketException(var9, this.conn);
      }

      int strtab;
      byte[] blobBuffer;
      try {
         blobBuffer = new byte[datalen];
         strtab = this.is.readPadded(blobBuffer);
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tData:&quot;);
            this.protoTrace.writeTrace(logger, 2, blobBuffer, &#39;H&#39;);
         }
      } catch (Exception var10) {
         throw this.handleSocketException(var10, this.conn);
      }

      if (this.BlobWriteFailure == 0) {
         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 99, &quot;IfxSqli.IfxBlob() : - 13&quot;);
         }

         try {
            this.blobDataWrite(blobBuffer, this.BlobWriteOffset, strtab);
            this.BlobWriteOffset += strtab;
         } catch (Exception var8) {
            this.BlobWriteFailure = 1;
         }
      }

      int remaining;
      if (strtab &lt; datalen) {
         for(boolean var4 = false; strtab &lt; datalen; strtab += remaining) {
            try {
               blobBuffer = new byte[datalen - strtab];
               remaining = this.is.readPadded(blobBuffer);
            } catch (Exception var7) {
               throw this.handleSocketException(var7, this.conn);
            }

            if (this.BlobWriteFailure == 0) {
               try {
                  this.blobDataWrite(blobBuffer, this.BlobWriteOffset, remaining);
                  this.BlobWriteOffset += remaining;
               } catch (Exception var6) {
                  this.BlobWriteFailure = 1;
               }
            }
         }
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveText() exited&quot;);
      }

   }

   private void receiveBlob() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 99, &quot;IfxSqli.IfxBlob() : - 12&quot;);
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveBlob() called&quot;);
      }

      Object var3 = null;

      short datalen;
      try {
         datalen = this.is.readSmallInt();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tSize: &quot;, datalen);
         }
      } catch (Exception var9) {
         throw this.handleSocketException(var9, this.conn);
      }

      int strtab;
      byte[] blobBuffer;
      try {
         blobBuffer = new byte[datalen];
         strtab = this.is.readPadded(blobBuffer);
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tData:&quot;);
            this.protoTrace.writeTrace(logger, 2, blobBuffer, &#39;H&#39;);
         }
      } catch (Exception var10) {
         throw this.handleSocketException(var10, this.conn);
      }

      if (this.BlobWriteFailure == 0) {
         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 99, &quot;IfxSqli.IfxBlob() : - 13&quot;);
         }

         try {
            this.blobDataWrite(blobBuffer, this.BlobWriteOffset, strtab);
            this.BlobWriteOffset += strtab;
         } catch (Exception var8) {
            this.BlobWriteFailure = 1;
         }
      }

      int remaining;
      if (strtab &lt; datalen) {
         for(boolean var4 = false; strtab &lt; datalen; strtab += remaining) {
            try {
               blobBuffer = new byte[datalen - strtab];
               remaining = this.is.readPadded(blobBuffer);
            } catch (Exception var7) {
               throw this.handleSocketException(var7, this.conn);
            }

            if (this.BlobWriteFailure == 0) {
               try {
                  this.blobDataWrite(blobBuffer, this.BlobWriteOffset, remaining);
                  this.BlobWriteOffset += remaining;
               } catch (Exception var6) {
                  this.BlobWriteFailure = 1;
               }
            }
         }
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveBlob() exited&quot;);
      }

   }

   private int blobDataWrite(byte[] buffer, int BlobWriteOffset, int length) {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: blobDataWrite() called&quot;);
      }

      if (this.BufferOrStream == 1) {
         try {
            if (TraceFlag.isTraceEnabled()) {
               this.trace.writeTrace(logger, 99, &quot;IfxSqli.IfxBlob() : - 14&quot;);
            }

            this.BlobFd.write(buffer, 0, length);
         } catch (Exception var5) {
            return 1;
         }
      } else {
         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 99, &quot;IfxSqli.IfxBlob() : - 15&quot;);
         }

         if (length &gt; 0) {
            System.arraycopy(buffer, 0, this.BlobBuffer, BlobWriteOffset, length);
         }
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: blobDataWrite() exited&quot;);
      }

      return 0;
   }

   public void executeScrollFetch(int scrolltype, int index, Statement stmt, int fetchBufferSize) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeScrollFetch() called&quot;);
      }

      ++this.numberOfFetches;
      this.resetTuples();
      if (!this.conn.lockSession()) {
         throw IfxErrMsg.getSQLMinorException(-79748, -80033, this.conn);
      } else {
         try {
            IfxResultSetMetaData fetchRsmd = null;
            if (stmt != null &amp;&amp; stmt instanceof IfxPreparedStatement) {
               IfxPreparedStatement pstmt = (IfxPreparedStatement)stmt;
               fetchRsmd = (IfxResultSetMetaData)((IfxResultSetMetaData)pstmt.getOutPutMetaData());
            }

            boolean isPrepStmt = stmt instanceof IfxPreparedStatement;
            if (fetchRsmd != null) {
               if (TraceFlag.isTraceEnabled()) {
                  this.trace.writeTrace(logger, 2, &quot;IfxSqli: fetchRsmd is not null&quot;);
               }

               this.sendScrollFetch(scrolltype, index, fetchRsmd, fetchBufferSize, isPrepStmt);
            } else {
               this.sendScrollFetch(scrolltype, index, this.desc, fetchBufferSize, isPrepStmt);
            }

            ((IfxStatement)stmt).cursorOpen = true;
            this.receiveMessage();
         } catch (SQLException var7) {
            ((IfxStatement)stmt).cursorOpen = false;
            this.conn.unlockSession();
            throw var7;
         } catch (Exception var8) {
            this.conn.unlockSession();
            throw this.handleSocketException(var8, this.conn);
         }

         int i = this.tupleSizeReceived;
         this.conn.unlockSession();
         ((IfxStatement)stmt).currentResult.setTupleSizeReceived(i);
         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeScrollFetch() exited&quot;);
         }

      }
   }

   private void sendScrollFetch(int scrolltype, int index, IfxResultSetMetaData desc, int fetchBufferSize, boolean isPreparedStatement) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendScrollFetch() called&quot;);
      }

      int sendBufferSize = false;
      int sendBufferSize;
      if (fetchBufferSize != 0) {
         sendBufferSize = fetchBufferSize;
      } else {
         this.tupleBufferSize = this.getTupleBufferSize(-1);
         sendBufferSize = this.tupleBufferSize;
      }

      try {
         this.sendStatementID();
         if (desc.hasVariableLengthColumns) {
            this.sendType(desc, (short)1, isPreparedStatement);
         }

         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_SFETCH&quot;);
         }

         this.os.writeSmallInt((short)23);
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tDirection: &quot;, scrolltype);
         }

         this.os.writeSmallInt((short)scrolltype);
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tOffset: &quot;, index);
         }

         this.os.writeInt(index);
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tTuple Buffer Size: &quot;, sendBufferSize);
         }

         if (!this.conn.isXPSVER8_40() &amp;&amp; !this.conn.is2GBFetchBufferSupported()) {
            this.os.writeSmallInt((short)sendBufferSize);
         } else {
            this.os.writeInt(sendBufferSize);
         }

         if (this.rowColumn == null || this.rowColumn.getInitialSize() &lt; sendBufferSize) {
            this.rowColumn = new IfxRowColumn(this.conn, desc, sendBufferSize);
            this.rowColumn.setTrace(this.trace);
         }
      } catch (SQLException var8) {
         throw var8;
      } catch (Exception var9) {
         throw this.handleSocketException(var9, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendScrollFetch() exited&quot;);
      }

   }

   public int getTupid() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: getTupid() entered&quot;);
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: Tupid is  &quot; + this.Tupid);
      }

      return this.Tupid + this.curRow;
   }

   public InputStream toClobStream(IfxSmBlob obj) throws SQLException {
      InputStream fd = null;
      String from = this.conn.getdbEncoding();
      String to = this.conn.getclEncoding();
      InputStream in = null;
      OutputStream out = null;
      IfxTmpFile tempClobFile = null;

      try {
         IfxLobInputStream lobStream = (IfxLobInputStream)((IfxLobInputStream)obj.toAsciiStream());
         int size = (int)lobStream.getSize();
         int codesetSize = this.conn.getCodesetLobSize();
         if (size &lt;= codesetSize) {
            try {
               byte[] blobBuffer = new byte[size];
               lobStream.read(blobBuffer);
               in = new ByteArrayInputStream(blobBuffer);
               out = new ByteArrayOutputStream();
            } catch (Exception var16) {
               throw IfxErrMsg.getSQLException(var16, -79753, this.conn);
            }
         } else {
            try {
               in = lobStream.getStream();
               tempClobFile = new IfxTmpFile(this.conn);
               out = tempClobFile.getOutputStream();
            } catch (Exception var15) {
               throw this.handleSocketException(var15, this.conn);
            }
         }

         Reader r = new BufferedReader(new InputStreamReader((InputStream)in, from));
         Writer w = new BufferedWriter(new OutputStreamWriter((OutputStream)out, to));
         char[] buffer = new char[4096];

         int len;
         while((len = r.read(buffer)) != -1) {
            w.write(buffer, 0, len);
         }

         r.close();
         w.flush();
         w.close();
         ((InputStream)in).close();
         if (size &lt;= codesetSize) {
            fd = new IfxByteArrayInputStream((ByteArrayOutputStream)out);
         } else {
            ((OutputStream)out).close();
            fd = tempClobFile.getInputStream();
         }

         return (InputStream)fd;
      } catch (Exception var17) {
         throw this.handleSocketException(var17, this.conn);
      }
   }

   public Vector&lt;IfxObject&gt; executeFastPath(String signature, Vector&lt;IfxObject&gt; inParams, boolean request_fparam) throws SQLException {
      this.executeFastPath(signature, (ResultSetMetaData)null, inParams, false, request_fparam);
      return this.fpRet;
   }

   public void executeFastPath(String signature, Vector&lt;IfxObject&gt; inParams, boolean hasOutParameter, boolean request_fparam) throws SQLException {
      this.executeFastPath(signature, (ResultSetMetaData)null, inParams, hasOutParameter, request_fparam);
   }

   public void executeFastPath(String signature, ResultSetMetaData pmd, Vector&lt;IfxObject&gt; inParams, boolean hasOutParameter, boolean request_fparam) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli.executeFastPath() called&quot;);
         this.trace.writeTrace(logger, 2, &quot;    sign: &quot; + signature);
         this.trace.writeTrace(logger, 2, &quot;    hasOutParameter: &quot; + hasOutParameter);
         this.trace.writeTrace(logger, 2, &quot;    request_fparam: &quot; + request_fparam);
      }

      if (this.fpRet != null) {
         this.fpRet.removeAllElements();
         this.fpRet = null;
      }

      if (this.fpInput != null) {
         this.fpInput.removeAllElements();
         this.fpInput = null;
      }

      if (signature != null &amp;&amp; this.conn.isUSVER()) {
         if (!this.conn.lockSession()) {
            throw IfxErrMsg.getSQLMinorException(-79748, -80033, this.conn);
         } else {
            if (!this.conn.autoCommit) {
               try {
                  this.initiateTransaction();
               } catch (SQLException var8) {
                  this.conn.unlockSession();
                  throw var8;
               }
            }

            short xcNewLevelSave = this.xcNewLevel;
            if (TraceFlag.isTraceEnabled()) {
               this.trace.writeTrace(logger, 3, &quot;  eFP() xcNewLevelSave: &quot; + xcNewLevelSave);
            }

            try {
               this.getHandle(signature, request_fparam, hasOutParameter);
               this.checkFastPathExp(inParams, pmd);
               this.sendFastPath(this.fpHandle, pmd, inParams, request_fparam);
               this.receiveMessage();
            } catch (SQLException var9) {
               this.conn.unlockSession();
               if (this.conn.isCommitNeeded() &amp;&amp; xcNewLevelSave &lt; 1 &amp;&amp; this.xcNewLevel == 1) {
                  this.executeCommit();
                  this.doneCommit = true;
               }

               throw var9;
            } catch (Exception var10) {
               this.conn.unlockSession();
               if (this.conn.isCommitNeeded() &amp;&amp; xcNewLevelSave &lt; 1 &amp;&amp; this.xcNewLevel == 1) {
                  this.executeCommit();
                  this.doneCommit = true;
               }

               throw this.handleSocketException(var10, this.conn);
            }

            this.conn.unlockSession();
            if (TraceFlag.isTraceEnabled()) {
               this.trace.writeTrace(logger, 1, &quot;  exFP() conn.SendCommit: &quot; + this.conn.SendCommit);
               this.trace.writeTrace(logger, 3, &quot;  exFP() xcNewLevel: &quot; + this.xcNewLevel);
            }

            if (this.conn.isCommitNeeded() &amp;&amp; xcNewLevelSave &lt; 1 &amp;&amp; this.xcNewLevel == 1) {
               this.executeCommit();
               this.doneCommit = true;
            }

            if (TraceFlag.isTraceEnabled()) {
               this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeFastPath() exited&quot;);
            }

         }
      }
   }

   public Vector&lt;IfxObject&gt; getFPReturnVector() {
      return this.fpRet;
   }

   private void getHandle(String signature, boolean request_fparam, boolean hasOutParameter) throws SQLException {
      this.fpHandle = this.conn.getFPCacheRoutineId(signature);
      if (this.fpHandle != -1) {
         if (request_fparam) {
            this.fparam = this.conn.getFPCacheFParam(signature);
         } else {
            this.fparam = null;
         }

         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 2, &quot;\tSQ_GETROUTINE (cached locally)&quot;);
            this.trace.writeTrace(logger, 2, &quot;\t\tHandle (CACHED): &quot;, this.fpHandle);
         }
      } else {
         try {
            this.partialFParam = false;
            if (request_fparam) {
               this.fparam = new IfxFParam();
               this.fparam.hasOutParameter = hasOutParameter;
            }

            byte[] dbBytes;
            if (this.conn.isNamedParametersSupported()) {
               byte[] dbBytes = null;
               int handleIx = signature.indexOf(94);
               if (handleIx &gt; 0) {
                  dbBytes = this.getJavaToIfxCharBytes(signature.substring(0, handleIx));
               } else {
                  dbBytes = this.getJavaToIfxCharBytes(signature);
               }

               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
                  this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
                  this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_GETROUTINE&quot;);
               }

               this.os.writeSmallInt((short)101);
               if (handleIx &gt; 0) {
                  this.os.writeByte(1);
                  this.os.writeChar(dbBytes);
                  int handle = Integer.parseInt(signature.substring(handleIx + 1));
                  this.os.writeInt(handle);
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\tisRoutineById:  1&quot;);
                     this.protoTrace.writeTrace(logger, 2, &quot;\tDbName: &quot; + signature.substring(0, handleIx));
                     this.routineDbName = signature.substring(0, handleIx);
                     this.protoTrace.writeTrace(logger, 2, &quot;\thandle id: &quot; + handle);
                  }
               } else {
                  this.os.writeByte(0);
                  this.os.writeChar(dbBytes);
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\tisRoutineById:  0&quot;);
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\tSignature: &quot;, signature);
                  }
               }
            } else {
               dbBytes = this.getJavaToIfxCharBytes(signature);
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
                  this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
                  this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_GETROUTINE&quot;);
               }

               this.os.writeSmallInt((short)101);
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\tSignature: &quot;, signature);
               }

               this.os.writeChar(dbBytes);
            }

            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;\t\tfparam: &quot; + request_fparam);
            }

            if (request_fparam) {
               this.os.writeSmallInt((short)1);
            } else {
               this.os.writeSmallInt((short)0);
            }

            this.receiveMessage();
         } catch (Exception var7) {
            if (var7 instanceof SQLException) {
               throw (SQLException)var7;
            }

            throw this.handleSocketException(var7, this.conn);
         }

         this.conn.setFPCacheInfo(this.fpHandle, signature, this.fparam);
      }

   }

   private void sendFastPath(int handle, ResultSetMetaData pmd, Vector&lt;IfxObject&gt; inParams, boolean request_fparam) throws SQLException {
      int paramCount;
      if (this.conn.isNamedParametersSupported() &amp;&amp; pmd != null) {
         paramCount = pmd.getColumnCount();
      } else if (inParams != null) {
         paramCount = inParams.size();
      } else {
         paramCount = 0;
      }

      if (inParams != null) {
         this.fpInput = new Vector(inParams);
      }

      try {
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_EXFPROUTINE&quot;);
         }

         this.os.writeSmallInt((short)102);
         if (this.conn.isNamedParametersSupported()) {
            if (this.routineDbName != null) {
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\tDbName: &quot;, this.routineDbName);
               }

               this.os.writeChar(this.os.getJavaToIfxChar(this.routineDbName));
            } else {
               this.os.writeChar(this.os.getJavaToIfxChar(&quot;&quot;));
            }
         }

         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tFastPath Handle: &quot;, handle);
         }

         this.os.writeInt(handle);
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tParam Count: &quot;, paramCount);
         }

         this.os.writeSmallInt((short)paramCount);
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tfparam: &quot; + request_fparam);
         }

         if (request_fparam) {
            this.os.writeSmallInt((short)1);
         } else {
            this.os.writeSmallInt((short)0);
         }
      } catch (Exception var7) {
         throw this.handleSocketException(var7, this.conn);
      }

      if (paramCount != 0) {
         this.sendBind(inParams, pmd, paramCount, 0, paramCount);
      }

      if (request_fparam) {
         this.sendFParam();
      }

   }

   private void receiveFastPath() throws SQLException {
      this.fpRet = new Vector();

      try {
         short numParams = this.is.readSmallInt();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tReturn Count: &quot;, numParams);
         }

         if (this.fparam != null &amp;&amp; this.fparam.colInfoArray.length &lt; numParams) {
            throw IfxErrMsg.getSQLException(-79716, &quot;receiveFastPath colInfoArray too small&quot;, this.conn);
         } else {
            for(short count = 0; count &lt; numParams; ++count) {
               IfxColumnInfo colInfo = new IfxColumnInfo();
               if (this.fparam != null) {
                  this.fparam.colInfoArray[count] = colInfo;
               }

               int type = this.is.readSmallInt();
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\n&quot;);
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t    Return value #: &quot; + (count + 1));
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tType: &quot;, type);
               }

               if ((type &amp; 2048) &gt; 0) {
                  colInfo.IsDistinct = true;
               }

               int type;
               colInfo.SQLtype = type = type &amp; 255;
               if (type &gt;= 18 &amp;&amp; type != 52 &amp;&amp; type != 53 || colInfo.IsDistinct) {
                  colInfo.ExtendedOwner = new String(this.is.readChar());
                  colInfo.ExtendedName = new String(this.is.readChar());
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tOwner: &quot;, colInfo.ExtendedOwner);
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tExtended: &quot;, colInfo.ExtendedName);
                  }
               }

               type = this.cleanUpFPTypeInfo(count, type, colInfo);
               colInfo.Nullable = 1;
               short ind = this.is.readSmallInt();
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tIndicator: &quot;, ind);
               }

               short prec = this.is.readSmallInt();
               if (prec != 0 &amp;&amp; colInfo.ColLength == 0) {
                  colInfo.ColLength = prec;
               }

               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tPrecision: &quot;, prec);
               }

               IfxObject obj = IfxValue.makeInstance(this.conn, colInfo);
               obj.setConnection(this.conn);
               if (TraceFlag.isTraceEnabled()) {
                  this.trace.writeTrace(logger, 2, &quot;receiveFastPath() IfxObject instantiated: &quot; + obj.getClass().getName());
               }

               if (ind == -1) {
                  obj.nullify();
                  this.fpRet.addElement(obj);
               } else {
                  int datalen;
                  byte[] b;
                  byte[] descriptor;
                  switch(type) {
                  case 0:
                  case 13:
                  case 15:
                  case 16:
                     obj.fromString(this.is.readChar(this.dbEncoding));
                     break;
                  case 1:
                     obj.fromShort(this.is.readSmallInt());
                     break;
                  case 2:
                  case 6:
                     obj.fromInt(this.is.readInt());
                     break;
                  case 3:
                     obj.fromDouble(this.is.readDouble(prec));
                     break;
                  case 4:
                     obj.fromFloat(this.is.readReal(prec));
                     break;
                  case 5:
                  case 8:
                     obj.fromDecimal(this.is.readDecimal(prec));
                     break;
                  case 7:
                     obj.fromDate(this.is.readDate());
                     break;
                  case 9:
                  case 23:
                  case 24:
                  case 25:
                  case 26:
                  case 27:
                  case 28:
                  case 29:
                  case 30:
                  case 31:
                  case 32:
                  case 33:
                  case 34:
                  case 35:
                  case 36:
                  case 37:
                  case 38:
                  case 39:
                  case 42:
                  case 43:
                  case 45:
                  case 46:
                  case 47:
                  case 48:
                  case 49:
                  case 50:
                  case 51:
                  default:
                     if (TraceFlag.isTraceEnabled()) {
                        this.protoTrace.writeTrace(logger, 2, &quot; *** Unsupported data found: &quot; + type);
                     }
                     break;
                  case 10:
                     if (IfxDateTime.getStartCode(prec) &gt;= 6 &amp;&amp; IfxDateTime.getEndCode(prec) &lt;= 10) {
                        obj.fromTimestamp(this.is.readDateTime(prec));
                        Time tm = obj.toTime();
                        obj.fromTime(tm);
                     } else {
                        ((IfxDateTime)obj).fromIfx(this.is.readRawDateTime(prec), prec);
                     }
                     break;
                  case 11:
                  case 12:
                     descriptor = new byte[56];

                     for(int i = 0; i &lt; 56; ++i) {
                        descriptor[i] = this.is.readByte();
                     }

                     obj.fromIfx(descriptor);
                     break;
                  case 14:
                     byte startCode = Interval.getStartCode(prec);
                     if (startCode != 0 &amp;&amp; startCode != 2) {
                        obj.fromIntervalDF((IntervalDF)this.is.readInterval(prec));
                     } else {
                        obj.fromIntervalYM((IntervalYM)this.is.readInterval(prec));
                     }
                     break;
                  case 17:
                  case 18:
                     obj.fromLong(this.is.readLongInt());
                     break;
                  case 19:
                  case 20:
                  case 21:
                  case 22:
                     int datalen = this.is.readShort();
                     datalen = this.is.readInt();
                     if (datalen &gt; 0) {
                        descriptor = new byte[datalen + 4];
                        b = JavaToIfxType.JavaToIfxInt(datalen);
                        System.arraycopy(b, 0, descriptor, 0, 4);
                        this.is.read(descriptor, 4, datalen);
                        obj.fromIfx(descriptor);
                     }
                     break;
                  case 40:
                  case 41:
                  case 44:
                     datalen = this.is.readInt();
                     if (datalen &gt; 0) {
                        int udtOffSet = 5;
                        b = new byte[datalen + udtOffSet];
                        b[0] = 0;
                        byte[] bInt = JavaToIfxType.JavaToIfxInt(datalen);
                        System.arraycopy(bInt, 0, b, 1, 4);
                        this.is.readPadded(b, udtOffSet, datalen);
                        if (colInfo.ExtendedId != 11 &amp;&amp; colInfo.ExtendedId != 10) {
                           obj.fromIfx(b);
                        } else {
                           ((IfxSmBlob)obj).fromIfxFP(b);
                        }
                     }
                     break;
                  case 52:
                  case 53:
                     obj.fromLong(this.is.readLongBigint());
                  }

                  if (TraceFlag.isTraceEnabled() &amp;&amp; (type &lt;= 18 || colInfo.ExtendedId == 1 || colInfo.ExtendedId == 5) &amp;&amp; type != 12 &amp;&amp; type != 11) {
                     String s = obj.toString();
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tData: &quot;, s);
                     this.protoTrace.writeTrace(logger, 2, &quot;&quot;);
                  }

                  this.fpRet.addElement(obj);
               }
            }

         }
      } catch (Exception var13) {
         throw this.handleSocketException(var13, this.conn);
      }
   }

   private int cleanUpFPTypeInfo(int count, int type, IfxColumnInfo colInfo) {
      boolean thisIsOutParam = false;
      int argIndex = -1;
      int retIndex = -1;
      if (this.fparam != null) {
         if (count &lt; this.fparam.numberOfOutParams) {
            thisIsOutParam = true;
            argIndex = this.fparam.outParamSequence[count];
         } else {
            retIndex = count - this.fparam.numberOfOutParams;
         }
      }

      if (type == 45) {
         type = 44;
         colInfo.SQLtype = 44;
         colInfo.ExtendedId = 5;
      } else if (type == 43) {
         type = 44;
         colInfo.SQLtype = 44;
         colInfo.ExtendedId = 1;
      } else if (type == 102) {
         type = 44;
         colInfo.SQLtype = 44;
         colInfo.ExtendedId = 10;
      } else if (type == 101) {
         type = 44;
         colInfo.SQLtype = 44;
         colInfo.ExtendedId = 11;
      } else if (this.fparam != null) {
         if (thisIsOutParam) {
            colInfo.ExtendedId = this.fparam.argType[argIndex].xid;
         } else {
            colInfo.ExtendedId = this.fparam.retType[retIndex].xid;
         }
      }

      if (thisIsOutParam) {
         IfxObject obj = (IfxObject)this.fpInput.get(argIndex);
         String name = obj.getExtendedTypeName();
         if (name != null &amp;&amp; name.trim().length() != 0) {
            colInfo.ExtendedName = name;
         }

         if (type == 40 || type == 41) {
            if (obj instanceof IfxRow) {
               type = 22;
               colInfo.SQLtype = 22;
            } else if (obj instanceof IfxCollection) {
               type = 20;
               colInfo.SQLtype = 20;
            }
         }
      }

      if (TraceFlag.isTraceEnabled()) {
         this.protoTrace.writeTrace(logger, 2, &quot;\t\t\t *** New type: &quot;, colInfo.SQLtype);
         this.protoTrace.writeTrace(logger, 2, &quot;\t\t\t *** New xid: &quot;, colInfo.ExtendedId);
         this.protoTrace.writeTrace(logger, 2, &quot;\t\t\t *** New xid name: &quot;, colInfo.ExtendedName);
      }

      return type;
   }

   private void receiveHandle() throws SQLException {
      try {
         if (this.conn.isNamedParametersSupported()) {
            this.routineDbName = this.is.readChar();
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tDbName: &quot;, this.routineDbName);
            }
         }

         this.fpHandle = this.is.readInt();
         if (this.idesc != null) {
            this.idesc.routineDbName = this.routineDbName;
            this.idesc.fpHandle = this.fpHandle;
         }

         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\t\t Handle: &quot;, this.fpHandle);
         }

      } catch (Exception var2) {
         throw this.handleSocketException(var2, this.conn);
      }
   }

   private void receiveFParam() throws SQLException {
      this.totalOutValues = 0;
      this.totalOutParams = 0;
      if (this.fparam == null) {
         throw IfxErrMsg.getSQLException(-79716, &quot;IfxSqli.receiveFParam() fparam is null&quot;, this.conn);
      } else {
         try {
            this.fparam.funcState = this.is.readLong();
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\tFuncState: &quot;, Long.toHexString(this.fparam.funcState));
            }

            this.fparam.request = this.is.readInt();
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\tRequest: &quot;, this.fparam.request);
            }

            byte b = this.is.readByte();
            if (b == 0) {
               this.fparam.isDone = false;
            } else {
               this.fparam.isDone = true;
            }

            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\tisDone: &quot;, this.fparam.isDone);
            }

            if (this.partialFParam) {
               return;
            }

            this.fparam.id = this.is.readInt();
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\tid: &quot;, this.fparam.id);
            }

            this.fparam.row = this.is.readLong();
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\trow: &quot;, this.fparam.row);
            }

            this.fparam.colid = this.is.readInt();
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\tcolid: &quot;, this.fparam.colid);
            }

            this.fparam.nrets = this.is.readShort();
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\tNumber of return values: &quot;, this.fparam.nrets);
            }

            if (this.fparam.nrets &gt; 0) {
               this.fparam.retNull = new boolean[this.fparam.nrets];
               this.fparam.retType = new FPTypeInfo[this.fparam.nrets];
               this.readFPTypeInfo(false, this.fparam.nrets, this.fparam.retNull, this.fparam.retType, &quot;Return&quot;, this.fparam.outParamSequence);
               this.totalOutValues = this.fparam.nrets;
            }

            this.fparam.nargs = this.is.readShort();
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\n\t\tNumber of parameters: &quot;, this.fparam.nargs);
            }

            boolean hasParameterNames = false;
            boolean isUDRUnique = false;
            if (this.conn.isNamedParametersSupported()) {
               int namedFlags = this.is.readSmallInt();
               hasParameterNames = (namedFlags &amp; 1) != 0;
               isUDRUnique = (namedFlags &amp; 2) != 0;
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\tnamed Flags: &quot;, namedFlags);
               }
            }

            if (this.fparam.nargs &gt; 0) {
               this.fparam.argNull = new boolean[this.fparam.nargs];
               this.fparam.argType = new FPTypeInfo[this.fparam.nargs];
               this.fparam.outParamSequence = new int[this.fparam.nargs];
               this.readFPTypeInfo(hasParameterNames, this.fparam.nargs, this.fparam.argNull, this.fparam.argType, &quot;Parameter&quot;, this.fparam.outParamSequence);
            }

            if (this.fparam.hasOutParameter &amp;&amp; !this.conn.isMultipleUdrOutSupported()) {
               ++this.totalOutValues;
               this.totalOutParams = 1;
               this.fparam.outParamSequence[0] = this.fparam.nargs - 1;
            }

            this.fparam.numberOfOutParams = this.totalOutParams;
            this.fparam.colInfoArray = new IfxColumnInfo[this.totalOutValues];
         } catch (Exception var5) {
            throw this.handleSocketException(var5, this.conn);
         }

         this.partialFParam = true;
      }
   }

   private void readFPTypeInfo(boolean hasParameterNames, int count, boolean[] argNull, FPTypeInfo[] typeInfo, String header, int[] outParamSequence) throws SQLException {
      try {
         for(int i = 0; i &lt; count; ++i) {
            typeInfo[i] = new FPTypeInfo();
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\t    &quot; + header + &quot; Type #: &quot; + (i + 1));
            }

            if (hasParameterNames) {
               byte argFlags = this.is.readByte();
               String argName = this.is.readChar();
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t\targument flags: &quot;, (short)argFlags);
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t\targument Name: &quot;, argName);
               }
            }

            byte b = this.is.readByte();
            if (b == 0) {
               argNull[i] = false;
            } else {
               argNull[i] = true;
            }

            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\t\targNull: &quot;, argNull[i]);
            }

            typeInfo[i].type = this.is.readShort();
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\t\ttype: &quot;, typeInfo[i].type);
            }

            typeInfo[i].xid = this.is.readInt();
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\t\txid: &quot;, typeInfo[i].xid);
            }

            if (this.conn.is902()) {
               typeInfo[i].len = this.is.readInt();
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tlength: &quot;, typeInfo[i].len);
               }

               typeInfo[i].precision = this.is.readShort();
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tprecision: &quot;, typeInfo[i].precision);
               }

               typeInfo[i].scale = this.is.readShort();
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tscale: &quot;, typeInfo[i].scale);
               }

               if (this.conn.isMultipleUdrOutSupported() &amp;&amp; header == &quot;Parameter&quot;) {
                  typeInfo[i].mode = this.is.readShort();
                  if (typeInfo[i].mode == 1) {
                     ++this.totalOutValues;
                     ++this.totalOutParams;
                     outParamSequence[this.totalOutParams - 1] = i;
                  }

                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tmode: &quot;, typeInfo[i].mode);
                  }
               }
            }
         }

      } catch (Exception var11) {
         throw this.handleSocketException(var11, this.conn);
      }
   }

   private void sendFParam() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendFParam() called&quot;);
      }

      if (this.fparam == null) {
         throw IfxErrMsg.getSQLException(-79716, &quot;IfxSqli.sendFParam() fparam is null&quot;, this.conn);
      } else {
         try {
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
               this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
               this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_FPARAM&quot;);
            }

            this.os.writeSmallInt((short)104);
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;\t\tfuncState: &quot; + Long.toHexString(this.fparam.funcState));
            }

            this.os.writeLong(this.fparam.funcState);
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;\t\trequest: &quot; + this.fparam.request);
            }

            this.os.writeInt(this.fparam.request);
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\tisDone: &quot;, this.fparam.isDone);
            }

            if (this.fparam.isDone) {
               this.os.writeByte(0);
            } else {
               this.os.writeByte(1);
            }

         } catch (Exception var2) {
            throw this.handleSocketException(var2, this.conn);
         }
      }
   }

   public IfxFParam getFParam() {
      return this.fparam;
   }

   public int executeReadSmBlob(int lofd, byte[] buffer, int nbytes) throws SQLException {
      this.BlobBuffer = buffer;
      this.BlobRequestSize = nbytes;
      this.BlobFd = null;
      this.BlobWriteOffset = 0;
      this.BufferOrStream = 0;
      this.BlobWriteFailure = 0;
      this.amountRW = 0;
      return this.doLoData((short)0, lofd, nbytes, 0);
   }

   public int executeReadSmBlob(int lofd, byte[] buffer, int nbytes, int offset) throws SQLException {
      this.BlobBuffer = buffer;
      this.BlobRequestSize = nbytes;
      this.BlobFd = null;
      this.BlobWriteOffset = 0;
      this.BufferOrStream = 0;
      this.BlobWriteFailure = 0;
      this.amountRW = 0;
      return this.doLoData((short)1, lofd, nbytes, offset);
   }

   public int executeReadSmBlob(int lofd, OutputStream fileFd, int nbytes) throws SQLException {
      this.BlobBuffer = null;
      this.BlobRequestSize = nbytes;
      this.BlobFd = fileFd;
      this.BlobWriteOffset = 0;
      this.BufferOrStream = 1;
      this.amountRW = 0;
      return this.doLoData((short)0, lofd, nbytes, 0);
   }

   private int doLoData(short subCom, int loFd, int dataLength, int off) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: doLoData() called&quot;);
      }

      this.conn.lockSession();

      try {
         this.sendLoData(subCom, loFd, dataLength, off);
         this.receiveMessage();
      } catch (Exception var10) {
         SQLException sqlException = IfxErrMsg.getSQLException(-79716, var10.toString(), this.conn);
         throw IfxErrMsg.setSQLExceptionCause(sqlException, var10);
      } finally {
         this.conn.unlockSession();
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: doLoData() exited&quot;);
      }

      return this.amountRW;
   }

   public int executeWriteSmBlob(int loFd, byte[] buffer) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli:executeWriteSmartBlob(int loFd, byte[] buffer) called&quot;);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli:executeWriteSmBlob(,) exited&quot;);
      }

      return this.executeWriteSmBlob(loFd, buffer, 0, buffer == null ? 0 : buffer.length);
   }

   public int executeWriteSmBlob(int loFd, byte[] buffer, int offset, int length) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli:executeWriteSmartBlob(int loFd, byte[] buffer,int offset, int length) called&quot;);
      }

      int dataLength = length;
      int dataOffset = offset;
      int size = false;
      this.amountRW = 0;
      if (!this.conn.lockSession()) {
         throw IfxErrMsg.getSQLMinorException(-79748, -80033, this.conn);
      } else {
         try {
            this.sendLoData((short)2, loFd, dataLength, 0);

            while(dataLength &gt; 0) {
               try {
                  int size = dataLength &lt; 32000 ? dataLength : 32000;
                  this.os.writeSmallInt((short)size);
                  this.os.writePadded(buffer, dataOffset, size);
                  dataLength -= size;
                  dataOffset += size;
               } catch (Exception var10) {
                  SQLException sqlException = IfxErrMsg.getSQLException(-79716, var10.toString(), this.conn);
                  sqlException = IfxErrMsg.setSQLExceptionCause(sqlException, var10);
                  throw sqlException;
               }
            }

            this.os.flush();
            this.receiveMessage();
         } catch (SQLException var11) {
            this.conn.unlockSession();
            throw var11;
         } catch (Exception var12) {
            this.conn.unlockSession();
            throw this.handleSocketException(var12, this.conn);
         }

         this.conn.unlockSession();
         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 1, &quot;IfxSqli:executeWriteSmBlob(,,,) exited&quot;);
         }

         return this.amountRW;
      }
   }

   public int executeWriteSmBlob(int loFd, InputStream fin, int length) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli:executeWriteSmBlob(int loFd, InputStream fd, int length) called&quot;);
      }

      InputStream fd;
      if (fin instanceof IfxLobInputStream) {
         fd = ((IfxLobInputStream)fin).getStream();
      } else {
         fd = fin;
      }

      int dataLength = length;
      int size = false;
      this.amountRW = 0;
      int readLength = false;
      byte[] buffer = new byte[32000];
      boolean readFault = false;
      if (!this.conn.lockSession()) {
         throw IfxErrMsg.getSQLMinorException(-79748, -80033, this.conn);
      } else {
         try {
            this.sendLoData((short)2, loFd, dataLength, 0);

            while(dataLength &gt; 0) {
               try {
                  int size = dataLength &lt; 32000 ? dataLength : 32000;
                  int readLength = fd.read(buffer, 0, size);
                  if (readLength &lt;= 0) {
                     readFault = true;
                     readLength = size;
                  }

                  this.os.writeSmallInt((short)readLength);
                  this.os.writePadded(buffer, 0, readLength);
                  dataLength -= readLength;
               } catch (Exception var11) {
                  readFault = true;
               }
            }

            this.receiveMessage();
            if (readFault) {
               throw IfxErrMsg.getSQLException(-79752, this.conn);
            }
         } catch (SQLException var12) {
            this.conn.unlockSession();
            throw var12;
         } catch (Exception var13) {
            this.conn.unlockSession();
            throw this.handleSocketException(var13, this.conn);
         }

         this.conn.unlockSession();
         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 1, &quot;IfxSqli:executeWriteSmBlob() exited&quot;);
         }

         return this.amountRW;
      }
   }

   private void sendLoData(short subCom, int loFd, int length, int off) throws SQLException {
      try {
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_LODATA&quot;);
         }

         this.os.writeSmallInt((short)97);
         if (TraceFlag.isTraceEnabled()) {
            if (subCom == 0) {
               this.protoTrace.writeTrace(logger, 2, &quot;\tLO_READ&quot;);
            } else if (subCom == 1) {
               this.protoTrace.writeTrace(logger, 2, &quot;\tLO_READWITHSEEK&quot;);
            } else if (subCom == 2) {
               this.protoTrace.writeTrace(logger, 2, &quot;\tLO_WRITE&quot;);
            }
         }

         this.os.writeSmallInt(subCom);
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\tLO_FD: &quot;, loFd);
         }

         this.os.writeSmallInt((short)loFd);
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\tNo. of Bytes: &quot;, length);
         }

         this.os.writeInt(length);
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\tR_W_BUFSIZE: &quot;, (short)32000);
         }

         this.os.writeSmallInt((short)32000);
         if (subCom == 1) {
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\toffset: &quot;, off);
            }

            this.os.writeLongInt((long)off);
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\twhence:  IfxSmartBlob.LO_SEEK_CUR&quot;);
            }

            this.os.writeSmallInt((short)1);
         }

      } catch (Exception var6) {
         throw this.handleSocketException(var6, this.conn);
      }
   }

   private void receiveLODATA() throws SQLException {
      short optype = 0;
      int fileSize = 0;

      try {
         optype = this.is.readSmallInt();
         fileSize = this.is.readInt();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tOpType : &quot;, optype);
            this.protoTrace.writeTrace(logger, 1, &quot;\tTotal Size : &quot;, fileSize);
         }
      } catch (Exception var8) {
         ;
      }

      if (optype == 2) {
         if (fileSize &lt; 0) {
            this.isamcode = fileSize;
            this.amountRW = -1;
            this.setSQLerrd((short)1, this.isamcode);
            this.addException(IfxErrMsg.getSQLException(-9810, this.conn));
            this.addException(this.isamcode, (String)null);
         } else {
            this.amountRW = fileSize;
         }

      } else if (fileSize &lt; 1) {
         try {
            this.is.readSmallInt();
         } catch (Exception var6) {
            throw this.handleSocketException(var6, this.conn);
         }

         this.amountRW = 0;
      } else {
         byte[] readBuffer = null;
         if (this.BlobRequestSize &gt; fileSize) {
            this.BlobRequestSize = fileSize;
         }

         boolean var4 = false;

         while(this.BlobRequestSize &gt; 0) {
            byte[] readBuffer;
            short size;
            try {
               size = this.is.readSmallInt();
               if (size &lt; 0) {
                  this.amountRW = -1;
                  return;
               }

               readBuffer = new byte[size];
               this.is.readPadded(readBuffer);
            } catch (Exception var9) {
               throw this.handleSocketException(var9, this.conn);
            }

            if (this.BlobWriteFailure == 0) {
               try {
                  this.blobDataWrite(readBuffer, this.BlobWriteOffset, size);
                  this.BlobWriteOffset += size;
               } catch (Exception var7) {
                  this.BlobWriteFailure = 1;
               }

               this.amountRW += size;
               this.BlobRequestSize -= size;
            }
         }

         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tNo. of Bytes Read : &quot;, this.amountRW);
         }

      }
   }

   private void receiveSQFILE() throws SQLException {
      short optype = true;
      byte[] buf = null;
      int bufSize = true;
      long readAmount = 0L;
      int message = true;
      int err = false;
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveSQFILE() called&quot;);
      }

      short optype;
      try {
         optype = this.is.readSmallInt();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\t\tOpType : &quot;, optype);
         }
      } catch (Exception var21) {
         throw this.handleSocketException(var21, this.conn);
      }

      short bufSize;
      short message;
      switch(optype) {
      case 0:
         try {
            short length = this.is.readSmallInt();
            byte[] b = new byte[length];
            this.is.readPadded(b);
            this.copyToFileName = stringUtil.getString(b, this.dbEncoding);
            this.copyToFileMode = this.is.readInt();
            this.copyToFileFlags = this.is.readInt();
            this.copyToFileOffset = this.is.readInt();
            message = this.is.readSmallInt();
         } catch (Exception var20) {
            throw this.handleSocketException(var20, this.conn);
         }

         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\t\tFile Name : &quot;, this.copyToFileName);
            this.protoTrace.writeTrace(logger, 1, &quot;\t\tMode &quot;, this.copyToFileMode);
            this.protoTrace.writeTrace(logger, 1, &quot;\t\tFlags &quot;, this.copyToFileFlags);
            this.protoTrace.writeTrace(logger, 1, &quot;\t\tOffset &quot;, this.copyToFileOffset);
         }

         if (message != 12) {
            this.sendSQFILEError(-408);
         } else {
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_EOT&quot;);
            }

            try {
               this.copyToFileFd = new File(this.copyToFileName);
            } catch (NullPointerException var31) {
               this.copyToFileFd = null;
               this.sendSQFILEError(2);
               break;
            }

            try {
               if ((this.copyToFileFlags &amp; 16) != 0) {
                  if (!this.copyToFileFd.exists()) {
                     this.copyToFileFd = null;
                     this.sendSQFILEError(2);
                     break;
                  }

                  this.copyToFileFd.setReadOnly();
               }

               if ((this.copyToFileFlags &amp; 1) != 0 &amp;&amp; this.copyToFileFd.exists()) {
                  this.copyToFileFd = null;
                  this.sendSQFILEError(17);
               }
            } catch (SecurityException var30) {
               throw this.handleSocketException(var30, this.conn);
            }
         }
         break;
      case 1:
         try {
            message = this.is.readSmallInt();
         } catch (IOException var16) {
            message = 0;
         }

         if (message != 12) {
            this.sendSQFILEError(-408);
         } else {
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_EOT&quot;);
            }

            try {
               if (this.copyToFileFd != null &amp;&amp; this.loFile != null) {
                  this.loFile.close();
               }
            } catch (IOException var15) {
               ;
            }
         }
         break;
      case 2:
         message = false;
         long nbytes = 0L;

         try {
            bufSize = this.is.readSmallInt();
            readAmount = (long)this.is.readInt();
            message = this.is.readSmallInt();
         } catch (Exception var29) {
            this.sendSQFILEError(-408);
            break;
         }

         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\t\tChunk Size &quot;, bufSize);
            this.protoTrace.writeTrace(logger, 1, &quot;\t\tAmount to Read &quot;, readAmount);
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_EOT&quot;);
         }

         if (message != 12) {
            this.sendSQFILEError(-408);
         } else if (this.copyToFileFd == null) {
            this.sendSQFILEError(9);
         } else {
            long totalSize;
            try {
               this.loFile = new RandomAccessFile(this.copyToFileFd, &quot;r&quot;);
               totalSize = this.loFile.length();
            } catch (IOException var28) {
               this.sendSQFILEError(9);
               break;
            }

            if ((long)this.copyToFileOffset &gt; totalSize) {
               this.sendSQFILEError(9);
            } else {
               byte[] buf;
               try {
                  buf = new byte[bufSize];
               } catch (Exception var27) {
                  this.sendSQFILEError(-406);
                  break;
               }

               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
                  this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
               }

               try {
                  this.os.writeSmallInt((short)106);
               } catch (Exception var19) {
                  throw this.handleSocketException(var19, this.conn);
               }

               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_FILE_READ&quot;);
               }

               if (readAmount == -1L) {
                  readAmount = totalSize - (long)this.copyToFileOffset;
               } else {
                  readAmount = totalSize - (long)this.copyToFileOffset &lt; readAmount ? totalSize - (long)this.copyToFileOffset : readAmount;
               }

               try {
                  this.os.writeInt((int)readAmount);
               } catch (Exception var18) {
                  throw this.handleSocketException(var18, this.conn);
               }

               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 1, &quot;\tAmount&quot;, readAmount);
               }

               try {
                  this.loFile.seek((long)this.copyToFileOffset);
               } catch (IOException var26) {
                  this.sendSQFILEError(29);
                  break;
               }

               boolean var3 = false;

               try {
                  while(readAmount &gt; 0L) {
                     nbytes = (long)bufSize &lt; readAmount ? (long)bufSize : readAmount;

                     int size;
                     try {
                        size = this.loFile.read(buf, 0, (int)nbytes);
                     } catch (Exception var22) {
                        break;
                     }

                     this.os.writeSmallInt((short)106);
                     this.os.writeSmallInt((short)size);
                     this.os.writePadded(buf, 0, size);
                     readAmount -= (long)size;
                  }
               } catch (Exception var23) {
                  throw this.handleSocketException(var23, this.conn);
               }

               if (readAmount &gt; 0L) {
                  this.sendSQFILEError(5);
               }
            }
         }
         break;
      case 3:
         if (this.copyToFileFd == null) {
            this.sendSQFILEError(9);
         } else {
            label258: {
               short err = 0;

               try {
                  this.loFile = new RandomAccessFile(this.copyToFileFd, &quot;rw&quot;);
                  if ((this.copyToFileFlags &amp; 2) != 0) {
                     if (this.copyToFileOffset != 0) {
                        this.loFile.seek((long)this.copyToFileOffset);
                     } else {
                        this.loFile.seek(this.loFile.length());
                     }
                  }
               } catch (Exception var24) {
                  this.sendSQFILEError(13);
                  break label258;
               }

               try {
                  while((message = this.is.readSmallInt()) == 107) {
                     bufSize = this.is.readSmallInt();
                     byte[] buffer = new byte[bufSize];
                     this.is.readPadded(buffer);
                     if ((this.copyToFileFlags &amp; 128) != 0) {
                        this.loFile.writeChars(new String(buffer));
                     } else {
                        this.loFile.write(buffer, 0, bufSize);
                     }
                  }
               } catch (IOException var25) {
                  err = true;
                  break label258;
               }

               try {
                  if (message == 13) {
                     err = this.is.readSmallInt();
                  }

                  if (err != 0) {
                     this.sendSQFILEError(err);
                  } else {
                     long TotalSize = this.loFile.length();
                     if (TraceFlag.isTraceEnabled()) {
                        this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_FILE_WRITE&quot;);
                        this.protoTrace.writeTrace(logger, 1, &quot;\t\tTotal Size:&quot; + TotalSize);
                     }

                     this.os.writeSmallInt((short)107);
                     this.os.writeInt((int)TotalSize);
                  }
               } catch (IOException var17) {
                  throw this.handleSocketException(var17, this.conn);
               }
            }
         }
      }

      if (TraceFlag.isTraceEnabled()) {
         this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
         this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
      }

      this.flip();
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveSQFILE() exit&quot;);
      }

   }

   public void executeProtocols(byte[] protocols) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeProtocols() called&quot;);
      }

      if (!this.conn.lockSession()) {
         throw IfxErrMsg.getSQLMinorException(-79748, -80033, this.conn);
      } else {
         try {
            this.sendProtocols(protocols);
            this.receiveMessage();
         } catch (SQLException var3) {
            this.conn.unlockSession();
            throw var3;
         } catch (Exception var4) {
            this.conn.unlockSession();
            throw this.handleSocketException(var4, this.conn);
         }

         this.conn.unlockSession();
         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeProtocols() exited&quot;);
         }

      }
   }

   private void sendProtocols(byte[] protocols) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendProtocols() called&quot;);
      }

      if (protocols != null &amp;&amp; protocols.length != 0) {
         try {
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
               this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
               this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_PROTOCOLS&quot;);
               this.protoTrace.writeTrace(logger, 2, &quot;\t\tSize: &quot; + protocols.length);
               this.protoTrace.writeTrace(logger, 2, &quot;\t\tData:&quot;);
               this.protoTrace.writeTrace(logger, 2, protocols, &#39;H&#39;);
            }

            this.os.writeSmallInt((short)126);
            this.os.writeSmallInt((short)protocols.length);
            this.os.writePadded(protocols);
            this.os.flush();
         } catch (Exception var3) {
            throw this.handleSocketException(var3, this.conn);
         }

         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendProtocols() exited&quot;);
         }

      } else {
         throw IfxErrMsg.getSQLException(-79716, this.conn);
      }
   }

   private void receiveProtocols() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveProtocols() called&quot;);
      }

      short datalen;
      try {
         datalen = this.is.readSmallInt();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tSize: &quot;, datalen);
         }
      } catch (Exception var4) {
         throw this.handleSocketException(var4, this.conn);
      }

      try {
         this.serverProtocol = new byte[datalen];
         int strtab = this.is.readPadded(this.serverProtocol);
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tData:&quot;);
            this.protoTrace.writeTrace(logger, 2, this.serverProtocol, &#39;H&#39;);
         }
      } catch (Exception var5) {
         throw this.handleSocketException(var5, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveProtocols() exited&quot;);
      }

   }

   public byte[] getProtocols() {
      return this.serverProtocol;
   }

   private void sendSQFILEError(int error) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
         this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
         this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_ERR&quot;);
         this.protoTrace.writeTrace(logger, 1, &quot;\tSQL error : &quot; + error);
         this.protoTrace.writeTrace(logger, 1, &quot;\tISAM/RSAM error : 0&quot;);
         this.protoTrace.writeTrace(logger, 1, &quot;\tOffset  : 0&quot;);
         this.protoTrace.writeTrace(logger, 1, &quot;\tError message  : 0&quot;);
      }

      try {
         this.os.writeSmallInt((short)13);
         this.os.writeSmallInt((short)error);
         this.os.writeSmallInt((short)0);
         this.os.writeSmallInt((short)0);
         if (this.conn.isRemove64KLimitSupported()) {
            this.os.writeSmallInt((short)0);
         }

         this.os.writeSmallInt((short)0);
      } catch (IOException var3) {
         throw this.handleSocketException(var3, this.conn);
      }
   }

   private void sendPut(IfxPreparedStatement pstmt) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendPut() called&quot;);
      }

      IfxResultSetMetaData putRsmd = (IfxResultSetMetaData)((IfxResultSetMetaData)pstmt.getOutPutMetaData());
      if (pstmt.executeBatchInProgress) {
         this.executeBatchInProgress = true;
      }

      try {
         if (!pstmt.cursorOpen) {
            this.sendQuery(pstmt, false, false, (IfxResultSetMetaData)null);
         } else {
            this.sendStatementID();
         }

         byte[] bData;
         if (!putRsmd.hasVariableLengthColumns &amp;&amp; putRsmd.textByteColumnCount &lt;= 0) {
            byte[] rowArray = null;
            bData = pstmt.getAllRows();

            byte[] rowArray;
            while((rowArray = pstmt.getNextRowBatch(bData)) != null) {
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 1, &quot;\tFixed Row Size:&quot;);
               }

               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_PUT&quot;);
               }

               this.os.writeSmallInt((short)17);
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 1, &quot;\t\tTupleSize: &quot;, this.desc.getTupleSize());
               }

               if (!this.conn.isUSVER()) {
                  if (TraceFlag.isTraceEnabled()) {
                     this.trace.writeTrace(logger, 2, &quot;os.writeSmallInt(tupleSize)&quot;);
                  }

                  this.os.writeSmallInt(this.desc.getTupleSize());
               } else {
                  if (TraceFlag.isTraceEnabled()) {
                     this.trace.writeTrace(logger, 2, &quot;os.writeInt(tupleSize)&quot;);
                  }

                  this.os.writeInt(this.getTupleSize());
               }

               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\tCount: &quot;, pstmt.getNumRowsCurrBatch());
               }

               if (this.conn.isXPSVER8_40()) {
                  this.os.writeInt(pstmt.getNumRowsCurrBatch());
               } else {
                  this.os.writeSmallInt((short)pstmt.getNumRowsCurrBatch());
               }

               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tData: &quot;);
                  this.protoTrace.writeTrace(logger, 2, rowArray, 0, &#39;B&#39;, rowArray.length);
               }

               this.os.write(rowArray);
               if (this.executeBatchInProgress) {
                  this.receiveMessage();
                  this.sendStatementID();
               }
            }
         } else {
            if (putRsmd.textByteColumnCount &gt; 0 &amp;&amp; TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;\tRow with Text/Bytes Columns&quot;);
            }

            if (putRsmd.hasVariableLengthColumns) {
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 1, &quot;\tvar-size rows&quot;);
               }

               this.sendType((IfxResultSetMetaData)pstmt.getOutPutMetaData(), (short)0, true);
            }

            for(int i = 0; i &lt; pstmt.getBatchCount(); ++i) {
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_PUT&quot;);
               }

               this.os.writeSmallInt((short)17);
               bData = pstmt.getNextRow();
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 1, &quot;\t\tTupleSize: &quot;, bData.length);
               }

               if (!this.conn.isUSVER()) {
                  if (TraceFlag.isTraceEnabled()) {
                     this.trace.writeTrace(logger, 2, &quot;os.writeSmallInt((short) bData.length)&quot;);
                  }

                  this.os.writeSmallInt((short)bData.length);
               } else {
                  if (TraceFlag.isTraceEnabled()) {
                     this.trace.writeTrace(logger, 2, &quot;os.writeInt( bData.length)&quot;);
                  }

                  this.os.writeInt(bData.length);
               }

               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\tCount: &quot;, 1);
               }

               if (this.conn.isXPSVER8_40()) {
                  this.os.writeInt(1);
               } else {
                  this.os.writeSmallInt((short)1);
               }

               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tData: &quot;);
                  this.protoTrace.writeTrace(logger, 2, bData, 0, &#39;B&#39;, bData.length);
               }

               this.os.writePadded(bData);

               for(int j = i * putRsmd.textByteColumnCount; j &lt; i * putRsmd.textByteColumnCount + putRsmd.textByteColumnCount; ++j) {
                  if (TraceFlag.isTraceEnabled()) {
                     this.trace.writeTrace(logger, 2, &quot;i: &quot; + i + &quot; j: &quot; + j + &quot; textByteColumnCount: &quot; + putRsmd.textByteColumnCount);
                     this.trace.writeTrace(logger, 2, &quot;BlobArraySize: &quot; + pstmt.getIfxBlobArraySize());
                  }

                  IfxBlob BlobObject = pstmt.getIfxBlobAt(j);
                  if (BlobObject != null) {
                     if (BlobObject.isBlobByteType()) {
                        this.sendBytesBlob(this.os, BlobObject.getBlobBuffer());
                     } else {
                        this.sendStreamBlob(this.os, BlobObject.getBlobInputStream(), BlobObject.getBlobLength());
                     }
                  }
               }

               if (((IfxResultSetMetaData)pstmt.getOutPutMetaData()).usingIMPEXP()) {
                  this.receiveMessage();
               }

               if (this.executeBatchInProgress &amp;&amp; this.os.getBytesSentSinceLastEOT() &gt;= (this.conn.isXPSVER8_40() ? 32767 : this.conn.getMaxFetchBufSize())) {
                  this.receiveMessage();
                  this.sendStatementID();
                  if (putRsmd.hasVariableLengthColumns) {
                     if (TraceFlag.isTraceEnabled()) {
                        this.protoTrace.writeTrace(logger, 1, &quot;\tvar-size rows&quot;);
                     }

                     this.sendType((IfxResultSetMetaData)pstmt.getOutPutMetaData(), (short)0, true);
                  }
               }
            }
         }
      } catch (SQLException var7) {
         throw var7;
      } catch (Exception var8) {
         throw this.handleSocketException(var8, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendPut() exited&quot;);
      }

   }

   String parseDbName(Statement stmt) {
      String token = null;
      String dbName = null;

      try {
         String sql = ((IfxStatement)stmt).commandString;
         StringTokenizer tok = new StringTokenizer(sql, &quot; &quot;);
         token = tok.nextToken();
         if (token.equalsIgnoreCase(&quot;DATABASE&quot;)) {
            dbName = tok.nextToken();
         } else if (token.equalsIgnoreCase(&quot;CREATE&quot;)) {
            token = tok.nextToken();
            if (token.equalsIgnoreCase(&quot;DATABASE&quot;)) {
               String tok1 = tok.nextToken();
               if (tok1.equalsIgnoreCase(&quot;IF&quot;)) {
                  for(int i = 0; i &lt; 3; ++i) {
                     tok1 = tok.nextToken();
                  }
               }

               dbName = tok1;
            }
         }
      } catch (Exception var8) {
         dbName = null;
      }

      if (dbName != null &amp;&amp; dbName.endsWith(&quot;;&quot;)) {
         dbName = dbName.substring(0, dbName.length() - 1);
      }

      return dbName;
   }

   public int incRefCount(byte[] locator) throws SQLException {
      return 0;
   }

   public int decRefCount(byte[] locator) throws SQLException {
      return 0;
   }

   protected void setIsReleased(boolean val) {
      this.isReleased = val;
   }

   public int getStatementID() {
      return this.statementID;
   }

   void initiateTransaction() throws SQLException {
      if (!this.conn.inXATransaction() &amp;&amp; this.conn.db_use_log &amp;&amp; !this.conn.AnsiDb &amp;&amp; this.TxStmt != 1 &amp;&amp; this.conn.TxState == 1) {
         this.sendBegin();
         this.receiveMessage();
         this.conn.setTxBeginState();
      }

      if (this.conn.AnsiDb &amp;&amp; !this.conn.autoCommit &amp;&amp; !this.conn.inXATransaction()) {
         this.conn.TxState = 2;
      }

   }

   public IfxResultSetMetaData executeDescribeInput() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeDescribeInput() called&quot;);
      }

      this.conn.lockSession();

      try {
         this.sendCIDescribe();
         this.receiveMessage();
      } catch (SQLException var6) {
         throw var6;
      } catch (Exception var7) {
         throw this.handleSocketException(var7, this.conn);
      } finally {
         this.conn.unlockSession();
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeDescribeInput() exited&quot;);
      }

      return this.idesc;
   }

   private void sendCIDescribe() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendCIDescribe() called&quot;);
      }

      try {
         this.sendStatementID();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_CIDESCRIBE&quot;);
         }

         this.os.writeSmallInt((short)124);
      } catch (Exception var2) {
         throw this.handleSocketException(var2, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendExecute() exited&quot;);
      }

   }

   private void receiveIDescribe() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveIDescribe() called&quot;);
      }

      this.recvIDescribe(false);
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IDescribe packet received&quot;);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveIDescribe() exited&quot;);
      }

   }

   private void recvIDescribe(boolean isFastPath) throws SQLException {
      int nparameters = false;
      boolean var3 = false;

      try {
         int nparameters = this.is.readSmallInt();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\t# of parameters: &quot;, nparameters);
         }

         this.idesc = new IfxResultSetMetaData(nparameters, this.conn);
         boolean hasParameterNames = false;
         boolean isUDRUnique = false;
         int numberArguments = -1;
         short i;
         if (this.conn.isNamedParametersSupported() &amp;&amp; nparameters != 0) {
            i = this.is.readSmallInt();
            hasParameterNames = (i &amp; 1) != 0;
            isUDRUnique = (i &amp; 2) != 0;
            if (!isFastPath &amp;&amp; hasParameterNames) {
               numberArguments = this.is.readSmallInt();
            }

            this.idesc.namedFlags = i;
            this.idesc.numArgsRoutine = numberArguments;
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\tnamed Flags: &quot;, i);
               this.protoTrace.writeTrace(logger, 2, &quot;\t\tnumberArguments: &quot;, numberArguments);
            }
         }

         if (nparameters &gt; 0) {
            for(i = 1; i &lt;= nparameters; ++i) {
               if (hasParameterNames) {
                  byte argFlags = this.is.readByte();
                  String argName = this.is.readChar();
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\targument flags: &quot;, (short)argFlags);
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\targument Name: &quot;, argName);
                  }

                  this.idesc.setArgumentFlags(i, argFlags);
                  this.idesc.setArgumentName(i, argName);
               }

               short shortVal = this.is.readSmallInt();
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tParameter type: &quot;, shortVal);
               }

               this.idesc.setIfxColumnType(i, shortVal);
               int intVal = this.is.readInt();
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tParameter Extended Id: &quot;, intVal);
               }

               this.idesc.setColumnExtendedId(i, intVal);
               String stringData = this.is.readChar();
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tOwner name: &quot; + stringData);
               }

               this.idesc.setExtendedOwnerName(i, stringData);
               stringData = this.is.readChar();
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tExtended Type Name: &quot; + stringData);
               }

               this.idesc.setExtendedName(i, stringData);
               shortVal = this.is.readSmallInt();
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tReference: &quot;, shortVal);
               }

               this.idesc.setReference(i, shortVal);
               shortVal = this.is.readSmallInt();
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tAlignment: &quot;, shortVal);
               }

               this.idesc.setAlignment(i, shortVal);
               intVal = this.is.readInt();
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tSource type: &quot;, intVal);
               }

               this.idesc.setSourceType(i, intVal);
               intVal = this.is.readInt();
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tLength: &quot;, intVal);
               }

               this.idesc.setEncodedLength(i, intVal);
               int type = this.idesc.getIfxColumnType(i);
               if (type == 5 || type == 8) {
                  intVal = IfxTypes.IfxTypeToDecDigits(this.idesc.getIfxColumnType(i), this.idesc.getColumnExtendedId(i), this.idesc.getEncodedLength(i));
                  this.idesc.setDecimalDigits(i, intVal);
                  intVal = IfxTypes.IfxTypeToRightDecimal(this.idesc.getIfxColumnType(i), this.idesc.getColumnExtendedId(i), this.idesc.getEncodedLength(i));
                  this.idesc.setRightDecimal(i, intVal);
               }

               if (isFastPath) {
                  shortVal = this.is.readSmallInt();
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tParameter mode: &quot;, intVal);
                  }

                  this.idesc.setMode(i, shortVal);
               }
            }
         }

      } catch (SQLException var12) {
         throw var12;
      } catch (Exception var13) {
         throw this.handleSocketException(var13, this.conn);
      }
   }

   private void receiveSGKDescribe() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveSGKDescribe() called&quot;);
      }

      int nfields = false;
      int intVal = false;
      String strtab = null;
      Object var8 = null;

      short nfields;
      try {
         this.SGK_statementType = this.is.readSmallInt();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tStatement Type: &quot;, this.statementType);
         }

         this.SGK_statementID = this.is.readSmallInt();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tStatement ID: &quot;, this.statementID);
         }

         int intVal = this.is.readInt();
         this.setSQLerrd((short)3, intVal);
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tEstimated Cost: &quot;, intVal);
         }

         int tupleSize = this.is.readSmallInt();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tTuplesize: &quot;, tupleSize);
         }

         nfields = this.is.readSmallInt();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\t# of fields: &quot;, nfields);
         }

         this.SGK_desc = new IfxResultSetMetaData(nfields, this.conn);
         this.SGK_desc.setTupleSize((short)tupleSize);
         int stringTableSize;
         if (this.conn.is4ByteOffsetSupported()) {
            stringTableSize = this.is.readInt();
         } else {
            stringTableSize = this.is.readSmallInt();
         }

         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tString table: &quot;, stringTableSize);
         }

         this.SGK_TxStmt = 0;
         if (this.statementType == 34) {
            this.SGK_TxStmt = 1;
         } else if (this.statementType == 35 || this.statementType == 36) {
            this.SGK_TxStmt = 2;
         }

         if (nfields &gt; 0) {
            int[] fieldIndex = new int[nfields];

            for(short i = 1; i &lt;= nfields; ++i) {
               if (this.conn.is4ByteOffsetSupported()) {
                  fieldIndex[i - 1] = this.is.readInt();
               } else {
                  fieldIndex[i - 1] = this.is.readSmallInt();
               }

               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t    Field Index: &quot;, fieldIndex[i - 1]);
               }

               short shortVal;
               if (this.conn.isUSVER()) {
                  intVal = this.is.readInt();
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tColumn Start Pos: &quot;, intVal);
                  }

                  this.SGK_desc.setColumnStartPosition(i, intVal);
               } else {
                  shortVal = this.is.readSmallInt();
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tColumn Start Pos: &quot;, shortVal);
                  }

                  this.SGK_desc.setColumnStartPosition(i, shortVal);
               }

               shortVal = this.is.readSmallInt();
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tColumn type: &quot;, shortVal);
               }

               this.SGK_desc.setIfxColumnType(i, shortVal);
               if (this.conn.isUSVER()) {
                  intVal = this.is.readInt();
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tColumn Extended Id: &quot;, intVal);
                  }

                  this.SGK_desc.setColumnExtendedId(i, intVal);
                  String stringData = this.is.readChar(this.dbEncoding);
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tOwner name: &quot; + stringData);
                  }

                  this.SGK_desc.setExtendedOwnerName(i, stringData);
                  stringData = this.is.readChar();
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tExtended name: &quot; + stringData);
                  }

                  this.SGK_desc.setExtendedName(i, stringData);
                  shortVal = this.is.readSmallInt();
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tReference: &quot;, shortVal);
                  }

                  this.SGK_desc.setReference(i, shortVal);
                  shortVal = this.is.readSmallInt();
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tAlignment: &quot;, shortVal);
                  }

                  this.SGK_desc.setAlignment(i, shortVal);
                  intVal = this.is.readInt();
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tSource type: &quot;, intVal);
                  }

                  this.SGK_desc.setSourceType(i, intVal);
                  intVal = this.is.readInt();
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tLength: &quot;, intVal);
                  }

                  this.SGK_desc.setEncodedLength(i, intVal);
               } else {
                  shortVal = this.is.readSmallInt();
                  if (TraceFlag.isTraceEnabled()) {
                     this.protoTrace.writeTrace(logger, 2, &quot;\t\t\tLength: &quot;, shortVal);
                  }

                  this.SGK_desc.setEncodedLength(i, shortVal);
               }
            }

            this.SGK_desc.setTextByteColumnCount();
         }

         if (stringTableSize &gt; 0) {
            byte[] b = new byte[stringTableSize];
            this.is.readPadded(b);
            strtab = this.conn.ifxtojava.IfxToJavaChar(b, this.dbEncoding, this.conn.encoption);
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\tData in String table: &quot;, strtab);
            }
         }

         this.SGK_rowColumn = new IfxRowColumn(this.conn, this.SGK_desc, 100);
      } catch (SQLException var12) {
         throw var12;
      } catch (Exception var13) {
         throw this.handleSocketException(var13, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;Describe packet received&quot;);
      }

      if (strtab != null) {
         String colName = null;
         StringTokenizer itok = new StringTokenizer(strtab, &quot;\u0000&quot;);

         for(short i = 0; i &lt; nfields; ++i) {
            if (itok.hasMoreTokens()) {
               colName = itok.nextToken();
               this.SGK_desc.setColumnName(i + 1, colName);
            } else {
               this.SGK_desc.setColumnName(i + 1, (String)null);
            }
         }
      }

      if (this.conn != null) {
         this.SGK_desc.setDelimIdent(this.conn.isDelimIdentSet());
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;SGKDescribe packet received&quot;);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveSGKDescribe() exited&quot;);
      }

   }

   private void receiveSGKTuple() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveSGKTuple() called&quot;);
         this.trace.writeTrace(logger, 2, &quot;    totalTupleSize = &quot; + this.SGK_totalTupleSize);
         this.trace.writeTrace(logger, 2, &quot;    totalTuples = &quot; + this.SGK_totalTuples);
      }

      try {
         short warn = this.is.readSmallInt();
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 2, &quot;\t\tWarning: &quot;, warn);
         }

         int size;
         if (this.conn.isUSVER()) {
            size = this.is.readInt();
         } else {
            size = this.is.readSmallInt();
         }

         if (this.SGK_rowColumn == null) {
            throw IfxErrMsg.getSQLException(-79716, &quot;No SGK_DESCRIBE&quot;, this.conn);
         }

         if (size &gt; 0) {
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\tTuple Size :&quot;, size);
            }

            this.SGK_rowColumn.readTuple(this.is, this.SGK_totalTupleSize, size);
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\tTuple data: &quot;);
               this.protoTrace.writeTrace(logger, 2, this.SGK_rowColumn.getTupleData(), this.SGK_totalTupleSize, &#39;B&#39;, size);
            }

            this.SGK_totalTupleSize += size;
            if (++this.SGK_totalTuples &gt;= this.SGK_offsetVector.size()) {
               this.SGK_offsetVector.setSize(this.SGK_totalTuples + 100);
               this.SGK_offsetVector.setElementAt(Integer.valueOf(0), 0);
            }

            this.SGK_offsetVector.setElementAt(this.SGK_totalTupleSize, this.SGK_totalTuples);
            if (TraceFlag.isTraceEnabled()) {
               this.trace.writeTrace(logger, 2, &quot;IfxSqli:receiveSGKTuple(): tuple size = &quot; + size);
               this.trace.writeTrace(logger, 2, &quot;IfxSqli:receiveSGKTuple(): totalTupleSize = &quot; + this.SGK_totalTupleSize);
               this.trace.writeTrace(logger, 2, &quot;IfxSqli:receiveSGKTuple(): totalTuples = &quot; + this.SGK_totalTuples);
            }
         }
      } catch (SQLException var3) {
         throw var3;
      } catch (Exception var4) {
         throw this.handleSocketException(var4, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveSGKTuple() exited&quot;);
      }

   }

   private String acceptPrivateServerChallenge() {
      try {
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;S-&gt;C&quot;);
         }

         int msg = this.is.readSmallInt();
         if (msg == 129) {
            int fileXNameLength = this.is.readSmallInt();
            byte[] fileNameMessage = new byte[fileXNameLength];
            this.is.readPadded(fileNameMessage, 0, fileXNameLength);
            String fileXName = this.conn.ifxtojava.IfxToJavaChar(fileNameMessage, this.conn.encoption);
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_CHALLENGE&quot;);
               this.protoTrace.writeTrace(logger, 1, &quot;\tfileXNameLength=&quot; + fileXNameLength);
               if (fileXNameLength &gt; 0) {
                  this.protoTrace.writeTrace(logger, 1, &quot;\tfileXName=&quot; + fileXName);
               }
            }

            FileInputStream fInStream = new FileInputStream(fileXName);
            DataInputStream fileXInput = new DataInputStream(fInStream);
            String fileYName = fileXInput.readLine();
            byte[] intZbuf = new byte[256];
            fileXInput.read(intZbuf, 0, 256);
            fileXInput.close();
            fInStream.close();
            FileOutputStream fOutStream = new FileOutputStream(fileYName);
            fOutStream.write(intZbuf);
            fOutStream.close();
            this.receiveEOT();
            if (this.sqliTrace != null) {
               this.sqliTrace.recordS2C();
            }

            return fileYName;
         } else {
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;\t*** Unknown error message: &quot; + msg + &quot; ***\n&quot;);
            }

            this.setError(-408);
            return null;
         }
      } catch (SQLException var10) {
         this.addException(var10);
         return null;
      } catch (Exception var11) {
         this.addException(IfxErrMsg.getSQLException(-79716, this.conn));
         return null;
      }
   }

   private boolean sendPrivateServerResponse(String fileYName) {
      try {
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_RESPONSE&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;\tfileYNameLength=&quot; + fileYName.length());
            if (fileYName.length() &gt; 0) {
               this.protoTrace.writeTrace(logger, 1, &quot;\tfileYName=&quot; + fileYName);
            }
         }

         this.os.writeSmallInt((short)130);
         this.os.writeSmallInt((short)fileYName.length());
         byte[] b = this.conn.javatoifx.JavaToIfxChar(fileYName, this.conn.encoption);
         this.os.writePadded(b, 2, b.length - 2);
         this.flip();
         this.clearExceptions();
         int msg = this.is.readSmallInt();
         if (msg == 127) {
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
               this.protoTrace.writeTrace(logger, 1, &quot;S-&gt;C&quot;);
               this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_ACCEPT&quot;);
            }

            msg = this.is.readSmallInt();
            if (msg == 12) {
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_EOT&quot;);
               }

               return true;
            }
         } else if (msg == 56) {
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
               this.protoTrace.writeTrace(logger, 1, &quot;S-&gt;C&quot;);
               this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_EXIT&quot;);
            }
         } else if (msg == 12) {
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
               this.protoTrace.writeTrace(logger, 1, &quot;S-&gt;C&quot;);
               this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_EOT&quot;);
            }
         } else if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;S-&gt;C&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;\t*** Unknown error message: &quot; + msg + &quot; ***\n&quot;);
         }

         return false;
      } catch (Exception var4) {
         if (var4 instanceof SQLException) {
            this.addException((SQLException)var4);
         } else {
            this.addException(IfxErrMsg.getSQLException(-79716, this.conn));
         }

         return false;
      }
   }

   public boolean handlePrivateServerExchange() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: handlePrivateServerExchange() called&quot;);
      }

      try {
         this.sendACK();
         this.flip();
      } catch (Exception var3) {
         throw this.handleSocketException(var3, this.conn);
      }

      this.clearExceptions();
      String fileYName = this.acceptPrivateServerChallenge();
      if (fileYName == null) {
         return false;
      } else {
         boolean flag = this.sendPrivateServerResponse(fileYName);
         if (this.sqliTrace != null) {
            this.sqliTrace.recordS2C();
         }

         return flag;
      }
   }

   public void handlePAMAuthentication(String pamClientClassName) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: handlePAMAuthentication() called&quot;);
      }

      IfmxPAM userPAMInterface = null;

      Class[] var5;
      try {
         if (pamClientClassName != null) {
            Class&lt;?&gt; c = Class.forName(pamClientClassName);
            boolean interfaceFound = false;
            var5 = c.getInterfaces();
            int var6 = var5.length;

            for(int var7 = 0; var7 &lt; var6; ++var7) {
               Class&lt;?&gt; c2 = var5[var7];
               if (c2.isAssignableFrom(IfmxPAM.class)) {
                  interfaceFound = true;
                  break;
               }
            }

            if (!interfaceFound) {
               throw IfxErrMsg.getSQLException(-79884, this.conn);
            }

            userPAMInterface = (IfmxPAM)c.newInstance();
         }
      } catch (ClassNotFoundException var10) {
         throw IfxErrMsg.getSQLException(-79883, this.conn);
      } catch (Exception var11) {
         throw this.handleSocketException(var11, this.conn);
      }

      boolean done = false;
      IfxPAMChallenge challengeMessage = null;
      var5 = null;

      try {
         this.sendACK();
         this.flip();
      } catch (Exception var9) {
         throw this.handleSocketException(var9, this.conn);
      }

      while(!this.userPAMAuthorized &amp;&amp; !done) {
         challengeMessage = this.readPAMChallengeMessage();
         if (this.userPAMAuthorized) {
            done = true;
         } else if (challengeMessage == null) {
            done = true;
         } else {
            boolean responseRequired;
            switch(challengeMessage.getChallengeType()) {
            case 3:
            case 4:
               responseRequired = false;
               break;
            default:
               responseRequired = true;
            }

            if (userPAMInterface == null) {
               throw IfxErrMsg.getSQLException(-79898, this.conn, new Object[]{&quot;IFX_PAM_CLASS&quot;});
            }

            IfxPAMResponse responseMessage = userPAMInterface.IfxPAM(challengeMessage);
            if (responseMessage.getTerminateConnection()) {
               this.sendExit();
               done = true;
            } else if (responseRequired) {
               this.sendPAMResponseMessage(responseMessage);
            }
         }
      }

      if (!this.userPAMAuthorized) {
         throw IfxErrMsg.getSQLException(-79885, this.conn);
      } else {
         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 1, &quot;IfxSqli: handlePAMAuthentication() exiting&quot;);
         }

      }
   }

   private IfxPAMChallenge readPAMChallengeMessage() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: readPAMChallengeMessage() called&quot;);
      }

      byte[] message = new byte[513];
      IfxPAMChallenge returnValue = null;
      this.clearExceptions();

      try {
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
            this.protoTrace.writeTrace(logger, 1, &quot;S-&gt;C&quot;);
         }

         int msg = this.is.readSmallInt();
         switch(msg) {
         case 56:
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_EXIT&quot;);
            }

            this.sendExit();
            break;
         case 127:
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_ACCEPT&quot;);
            }

            this.userPAMAuthorized = true;
            this.receiveEOT();
            break;
         case 129:
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_CHALLENGE&quot;);
            }

            short messageStyle = this.is.readSmallInt();
            short messageLength = this.is.readSmallInt();
            this.is.readPadded(message, 0, messageLength);
            returnValue = new IfxPAMChallenge(this.conn.ifxtojava.IfxToJavaChar(message, this.conn.encoption), messageStyle);
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;\tMessageType=&quot; + messageStyle);
               this.protoTrace.writeTrace(logger, 1, &quot;\tMessageLength=&quot; + messageLength);
               if (messageLength &gt; 0) {
                  this.protoTrace.writeTrace(logger, 1, &quot;\tMessage=&quot; + returnValue.getChallenge());
               }
            }

            this.receiveEOT();
            break;
         default:
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;\t*** Unknown error message: &quot; + msg + &quot; ***\n&quot;);
            }

            this.setError(-408);
         }
      } catch (SQLException var6) {
         this.addException(var6);
      } catch (Exception var7) {
         this.addException(IfxErrMsg.getSQLException(var7, -79716, this.conn));
      }

      if (this.exception != null) {
         throw this.exception;
      } else {
         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 1, &quot;IfxSqli: readPAMChallengeMessage() exited&quot;);
         }

         return returnValue;
      }
   }

   private void sendPAMResponseMessage(IfxPAMResponse r) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendPAMResponseMessage() called&quot;);
      }

      String responseString = r.getResponse();
      short msgLen = 0;
      if (responseString != null) {
         if (responseString.length() &gt; 512) {
            throw IfxErrMsg.getSQLException(-79886, this.conn);
         }

         msgLen = (short)responseString.length();
      }

      if (TraceFlag.isTraceEnabled()) {
         this.protoTrace.writeTrace(logger, 1, &quot;&quot;);
         this.protoTrace.writeTrace(logger, 1, &quot;C-&gt;S&quot;);
         this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_RESPONSE&quot;);
         this.protoTrace.writeTrace(logger, 2, &quot;\t\tMESSAGE LENGTH: &quot; + msgLen);
         this.protoTrace.writeTrace(logger, 2, &quot;\t\tData:&quot;);
         if (r.challengeResponse != null &amp;&amp; r.challengeResponse.length() != 0) {
            this.protoTrace.writeTrace(logger, 2, r.challengeResponse);
         } else {
            this.protoTrace.writeTrace(logger, 2, &quot;&lt;null&gt;&quot;);
         }
      }

      try {
         this.os.writeSmallInt((short)130);
         this.os.writeSmallInt(msgLen);
         if (msgLen != 0) {
            byte[] b = this.conn.javatoifx.JavaToIfxChar(r.challengeResponse, this.conn.encoption);
            this.os.writePadded(b, 2, b.length - 2);
         }

         this.sendEOT();
      } catch (Exception var5) {
         throw this.handleSocketException(var5, this.conn);
      }
   }

   public IfxResultSetMetaData executeFPDescribe(String signature, boolean isProc, String procName, int numargs) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeFPDescribe() called&quot;);
      }

      if (!this.conn.lockSession()) {
         throw IfxErrMsg.getSQLMinorException(-79748, -80033, this.conn);
      } else {
         try {
            this.sendCFPDescribe(signature, isProc, procName, numargs);
            this.receiveMessage();
         } catch (Exception var6) {
            this.conn.unlockSession();
            if (var6 instanceof SQLException) {
               throw (SQLException)var6;
            }

            throw this.handleSocketException(var6, this.conn);
         }

         this.conn.unlockSession();
         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 1, &quot;IfxSqli: executeDescribeInput() exited&quot;);
         }

         return this.idesc;
      }
   }

   private void sendCFPDescribe(String signature, boolean isProc, String procName, int numargs) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendCFPDescribe() called&quot;);
      }

      try {
         byte[] dbBytes;
         if (this.conn.isNamedParametersSupported()) {
            byte[] dbBytes = null;
            int handleIx = signature.indexOf(94);
            if (handleIx &gt; 0) {
               dbBytes = this.os.getJavaToIfxChar(signature.substring(0, handleIx));
            } else {
               dbBytes = this.os.getJavaToIfxChar(procName);
            }

            this.os.writeSmallInt((short)131);
            if (handleIx &gt; 0) {
               this.os.writeByte(1);
               this.os.writeChar(dbBytes);
               int handle = Integer.parseInt(signature.substring(handleIx + 1));
               this.os.writeInt(handle);
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\tisRoutineById:  1&quot;);
                  this.protoTrace.writeTrace(logger, 2, &quot;\tDbName: &quot; + signature.substring(0, handleIx));
                  this.routineDbName = signature.substring(0, handleIx);
                  this.protoTrace.writeTrace(logger, 2, &quot;\thandle id: &quot; + handle);
               }
            } else {
               this.os.writeByte(0);
               if (isProc) {
                  this.os.writeSmallInt((short)0);
               } else {
                  this.os.writeSmallInt((short)1);
               }

               this.os.writeChar(dbBytes);
               this.os.writeInt(numargs);
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t Procedure: &quot; + (isProc ? &quot;true&quot; : &quot;false&quot;));
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t Name     : &quot; + procName);
                  this.protoTrace.writeTrace(logger, 2, &quot;\t\t NumArgs  : &quot; + numargs);
               }
            }
         } else {
            dbBytes = this.os.getJavaToIfxChar(procName);
            this.os.writeSmallInt((short)131);
            if (isProc) {
               this.os.writeSmallInt((short)0);
            } else {
               this.os.writeSmallInt((short)1);
            }

            this.os.writeChar(dbBytes);
            this.os.writeInt(numargs);
            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 2, &quot;\t\t Procedure: &quot; + (isProc ? &quot;true&quot; : &quot;false&quot;));
               this.protoTrace.writeTrace(logger, 2, &quot;\t\t Name     : &quot; + procName);
               this.protoTrace.writeTrace(logger, 2, &quot;\t\t NumArgs  : &quot; + numargs);
            }
         }

         this.sendEOT();
      } catch (Exception var8) {
         if (var8 instanceof SQLException) {
            throw (SQLException)var8;
         }

         throw this.handleSocketException(var8, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendExecute() exited&quot;);
      }

   }

   private void receiveIFPDescribe() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveIFPDescribe() called&quot;);
      }

      try {
         this.recvIDescribe(true);
      } catch (SQLException var2) {
         this.addException(var2);
      } catch (Exception var3) {
         this.addException(IfxErrMsg.getSQLException(-79716, this.conn));
      }

      if (this.exception != null) {
         throw this.exception;
      } else {
         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 1, &quot;IFPDescribe packet received&quot;);
         }

         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 1, &quot;IfxSqli: receiveIFPDescribe() exited&quot;);
         }

      }
   }

   public boolean getNextSGKRow() throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: getNextSGKRow() called&quot;);
      }

      int tcount = this.SGK_totalTuples - (this.SGK_curRow + 1);
      int tupleCount = this.SGK_totalTuples;
      if (tcount == 0) {
         return false;
      } else {
         ++this.SGK_curRow;
         this.SGK_curOffset = ((Integer)this.SGK_offsetVector.get(this.SGK_curRow)).intValue();
         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 1, &quot;SGK_curRow = &quot; + this.SGK_curRow);
            this.trace.writeTrace(logger, 1, &quot;SGK_currOffset = &quot; + this.SGK_curOffset);
         }

         this.SGK_rowColumn.setOffsetInTuple(this.SGK_curOffset);
         if (TraceFlag.isTraceEnabled()) {
            this.trace.writeTrace(logger, 1, &quot;IfxSqli: getNextSGKRow() exited&quot;);
         }

         return true;
      }
   }

   private void sendSGKPrepare(IfxStatement stmt) throws SQLException {
      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendSGKPrepare() called&quot;);
      }

      try {
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\tSQ_SGKPREPARE&quot;);
         }

         this.os.writeSmallInt((short)134);
         if (TraceFlag.isTraceEnabled()) {
            this.protoTrace.writeTrace(logger, 1, &quot;\t\treturnGeneratedKey: &quot; + stmt.SGK_returnGeneratedKeys);
         }

         this.os.writeSmallInt(stmt.SGK_returnGeneratedKeys);
         int nkeys;
         int i;
         if (stmt.SGK_returnGeneratedKeys == 2) {
            nkeys = 0;
            if (stmt.SGK_indexes != null) {
               nkeys = stmt.SGK_indexes.length;
            }

            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;\t\t# keys: &quot; + nkeys);
            }

            this.os.writeSmallInt((short)nkeys);

            for(i = 0; i &lt; nkeys; ++i) {
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 1, &quot;\t\t\tindex: &quot; + stmt.SGK_indexes[i]);
               }

               this.os.writeSmallInt((short)stmt.SGK_indexes[i]);
            }
         } else if (stmt.SGK_returnGeneratedKeys == 3) {
            nkeys = 0;
            if (stmt.SGK_names != null) {
               nkeys = stmt.SGK_names.length;
            }

            if (TraceFlag.isTraceEnabled()) {
               this.protoTrace.writeTrace(logger, 1, &quot;\t\t# keys: &quot; + nkeys);
            }

            this.os.writeSmallInt((short)nkeys);

            for(i = 0; i &lt; nkeys; ++i) {
               if (TraceFlag.isTraceEnabled()) {
                  this.protoTrace.writeTrace(logger, 1, &quot;\t\t\tname: &quot; + stmt.SGK_names[i]);
               }

               this.os.writeChar(this.os.getJavaToIfxChar(stmt.SGK_names[i]));
            }
         }
      } catch (Exception var4) {
         throw this.handleSocketException(var4, this.conn);
      }

      if (TraceFlag.isTraceEnabled()) {
         this.trace.writeTrace(logger, 1, &quot;IfxSqli: sendSGKPrepare() exited&quot;);
      }

   }

   public int getNumberOfFetches() {
      return this.numberOfFetches;
   }

   protected int getNumberOfTuplesReceived() {
      return this.numberOfTuplesReceived;
   }

   private SQLException handleSocketException(Exception e, IfxSqliConnect conn) {
      if (conn != null) {
         conn.isOpen = false;
         conn.socketTimedOut = true;
      }

      return e instanceof SQLException ? (SQLException)e : IfxErrMsg.getSQLException(e, -79716, conn);
   }

   private void checkFastPathExp(Vector&lt;IfxObject&gt; exVector, ResultSetMetaData pmd) throws SQLException {
      int paramCount;
      if (this.conn.isNamedParametersSupported() &amp;&amp; pmd != null) {
         paramCount = pmd.getColumnCount();
      } else if (exVector != null) {
         paramCount = exVector.size();
      } else {
         paramCount = 0;
      }

      for(int i = 0; i &lt; paramCount; ++i) {
         IfxObject ival = null;
         if (i &lt; exVector.size()) {
            ival = (IfxObject)exVector.get(i);
         }

         if (ival == null) {
            int ord = i % paramCount + 1;
            if (pmd != null &amp;&amp; ((IfxResultSetMetaData)pmd).hasDefaultValue(ord)) {
               return;
            }

            throw IfxErrMsg.getSQLException(-79823, ((IfxResultSetMetaData)pmd).getArgumentName(ord), this.conn);
         }
      }

   }

   private byte[] getJavaToIfxCharBytes(String s) throws IOException, SQLException {
      return this.conn.isRemove64KLimitSupported() ? this.os.getJavaToIfx4BytesChar(s, this.dbEncoding) : this.os.getJavaToIfxChar(s, this.dbEncoding);
   }

   public int getPutErrRowCount() {
      return this.putErrRowCount;
   }

   public void clearPutErrRowCount() {
   }
}
</pre>
            </div> <!-- /container -->
        </div><!-- /row-->
    </div><!-- /container main-->


<div style="text-align: left; font-size: small; color: gray; font-style: italic;">Page generated: 18/09/2019, 6:17:00 p.m.</div>
    <script src="resources/js/jquery-1.10.1.min.js"></script>
    <script src="resources/js/jquery-migrate-1.4.1.min.js"></script>
    <script src="resources/js/bootstrap.min.js"></script>

    <script type="text/javascript" src="resources/libraries/jquery-ui/jquery.ui.widget.js"></script>
    <script type="text/javascript" src="resources/libraries/snippet/jquery.snippet.min.js"></script>
    <script type="text/javascript" src="resources/libraries/snippet/jquery.snippet.java-properties.js"></script>
    <script type="text/javascript" src="resources/libraries/snippet/jquery.snippet.java-manifest.js"></script>
    <script type="text/javascript" src="resources/libraries/sausage/jquery.sausage.min.js"></script>

    <script type="text/javascript">
        var script   = document.createElement("script");
        script.type  = "text/javascript";
            script.src   = "resources/js/navbar.js";
        document.body.appendChild(script);
    </script>

    <script type="text/javascript">
        $(window).on("hashchange", function () {
            window.scrollTo(window.scrollX, window.scrollY - 50);
        });
        function offsetAnchor() {
            if(location.hash.length !== 0) {
                window.scrollTo(window.scrollX, window.scrollY - 50);
            }
        }
        window.setTimeout(function() {
            offsetAnchor();
        }, 1);
        $(document).ready(function(){
            $("pre").snippet("java",{style:"ide-eclipse", showNum:true,boxFill:"#ffeeb9", box: "7167" });

            $("<div id='7167-inlines' class='inline-source-hint-group'/>").appendTo('ol.snippet-num li:nth-child(7167)');


$("<a name='50475072' class='windup-file-location'></a><div class='inline-source-comment green tag-classloader'><div class='inline-comment'><div class='inline-comment-heading'><strong class='notification info'>Dynamic class instantiation</strong><a title='View Rule: environment-dependent-calls-01000' href='windup_ruleproviders.html#environment-dependent-calls-01000'><span class='glyphicon glyphicon-link rule-link floatRight'></span></a></div><div class='inline-comment-body'><p>The class is dynamically loaded within application. During the migration, multiple classes that are provided on classpath by a different server may not be present anymore.<\/p><p>Please review the class-loading mechanisms and ensure that the dynamically loaded class is available in JBoss EAP.<\/p><ul><li><a href='https://access.redhat.com/solutions/361343' target='_blank'>Article about Classloading in JBoss EAP 6</a></li><li><a href='https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/development_guide/#class_loading_and_modules' target='_blank'>Class Loading and Modules in JBoss EAP 7</a></li><li><a href='https://access.redhat.com/documentation/en-US/JBoss_Enterprise_Application_Platform/6.4/html-single/Development_Guide/index.html#chap-Class_Loading_and_Modules' target='_blank'>Class Loading and Modules in JBoss EAP 6</a></li></ul></div></div></div>").appendTo('#7167-inlines');


            $('code[class]').each(function(){
                 var codeSyntax = ($(this).attr('class'));
                 if(codeSyntax) {
                    $(this).parent().snippet(codeSyntax,{style:'ide-eclipse', menu:false, showNum:false});
                 }
            });
            $(window).sausage({ page: 'li.box' });
            $(window).resize(function () {
                $('div.sausage-set').css('top', parseInt($('#main-navbar').css("height")));
            });

            $(window).load(function () {
                $('div.sausage-set').css('top', parseInt($('#main-navbar').css("height")));
            });
        });

        function qs(key) {
            key = key.replace(/[*+?^$.\[\]{}()|\\\/]/g, "\\$&"); // escape RegEx meta chars
            var match = location.search.match(new RegExp("[?&]"+key+"=([^&]+)(&|$)"));
            return match && decodeURIComponent(match[1].replace(/\+/g, " "));
        }

        $(document).ready(function() {
            var defaultProjectID = 21667888;
            var selectedProject = qs("project");
            if (!selectedProject)
                selectedProject = defaultProjectID;

            $(".project-specific").each(function(index, element) {
                var currentProject = $(element).data("project-id");

                if (currentProject == selectedProject)
                    $(element).show();
                else
                    $(element).remove();
            });
            $("#main-navbar").show();
        });
    </script>
    <script>$(document).ready(function(){$('[data-toggle="tooltip"]').tooltip();});</script>
</body>
</html>
